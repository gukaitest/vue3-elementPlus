import{C as j,V as O,aH as F,W as T,r as S,a as A,aU as w,b6 as B,D as K,$ as E,Z as N,l as $}from"./index-q4uhLKit.js";function U(a){const{loading:l,startLoading:y,endLoading:d}=j(),{bool:M,setBool:p}=O(),{apiFn:_,apiParams:u,transformer:P,immediate:m=!0,getColumnChecks:b,getColumns:v}=a,n=F(T({...u})),h=S(a.columns()),k=S([]),g=S(b(a.columns())),C=A(()=>v(h.value,g.value));function z(){h.value=a.columns();const c=new Map(g.value.map(e=>[e.prop,e.checked])),i=b(h.value);g.value=i.map(e=>({...e,checked:c.get(e.prop)??e.checked}))}async function f(){var t;y();const c=D(n),i=await _(c),e=P(i);k.value=e.data,p(e.data.length===0),await((t=a.onFetched)==null?void 0:t.call(a,e)),d()}function D(c){const i={};return Object.entries(c).forEach(([e,t])=>{t!=null&&(i[e]=t)}),i}function r(c){Object.assign(n,c)}function L(){Object.assign(n,T(u))}return m&&f(),{loading:l,empty:M,data:k,columns:C,columnChecks:g,reloadColumns:z,getData:f,searchParams:n,updateSearchParams:r,resetSearchParams:L}}function H(a){return w({url:"/systemManage/getRoleList",method:"get",params:a})}function V(){return w({url:"/systemManage/getAllRoles",method:"get"})}function X(a){return w({url:"/systemManage/getUserList",method:"get",params:a})}function q(){return w({url:"/systemManage/getMenuList/v2",method:"get"})}function Z(){return w({url:"/systemManage/getAllPages",method:"get"})}function J(){return w({url:"/systemManage/getMenuTree",method:"get"})}function Q(a){const l=B(),y=K(),d=A(()=>y.isMobile),{apiFn:M,apiParams:p,immediate:_}=a,u="__selection__",P="__expand__",m="__index__",{loading:b,empty:v,data:n,columns:h,columnChecks:k,reloadColumns:g,getData:C,searchParams:z,updateSearchParams:f,resetSearchParams:D}=U({apiFn:M,apiParams:p,columns:a.columns,transformer:e=>{const{records:t=[],current:s=1,size:x=10,total:o=0}=e.data||{},G=x<=0?10:x;return{data:t.map((I,R)=>({...I,index:(s-1)*G+R+1})),pageNum:s,pageSize:G,total:o}},getColumnChecks:e=>{const t=[];return e.forEach(s=>{s.type==="selection"?t.push({prop:u,label:E("common.check"),checked:!0}):s.type==="expand"?t.push({prop:P,label:E("common.expandColumn"),checked:!0}):s.type==="index"?t.push({prop:m,label:E("common.index"),checked:!0}):t.push({prop:s.prop,label:s.label,checked:!0})}),t},getColumns:(e,t)=>{const s=new Map;return e.forEach(o=>{o.type==="selection"?s.set(u,o):o.type==="expand"?s.set(P,o):o.type==="index"?s.set(m,o):s.set(o.prop,o)}),t.filter(o=>o.checked).map(o=>s.get(o.prop))},onFetched:async e=>{const{pageNum:t,pageSize:s,total:x}=e;c({currentPage:t,pageSize:s,total:x})},immediate:_}),r=F({currentPage:1,pageSize:10,pageSizes:[10,15,20,25,30],"current-change":e=>(r.currentPage=e,f({current:e,size:r.pageSize}),C(),!0),"size-change":e=>(r.currentPage=1,r.pageSize=e,f({current:r.currentPage,size:e}),C(),!0)}),L=A(()=>({...r,pagerCount:d.value?3:9}));function c(e){Object.assign(r,e)}async function i(e=1){c({currentPage:e}),f({current:e,size:r.pageSize}),await C()}return l.run(()=>{N(()=>y.locale,()=>{g()})}),$(()=>{l.stop()}),{loading:b,empty:v,data:n,columns:h,columnChecks:k,reloadColumns:g,pagination:r,mobilePagination:L,updatePagination:c,getData:C,getDataByPage:i,searchParams:z,updateSearchParams:f,resetSearchParams:D}}function ee(a,l){const{bool:y,setTrue:d,setFalse:M}=O(),p=S("add");function _(){p.value="add",d()}const u=S(null);function P(n){p.value="edit";const h=a.value.find(k=>k.id===n)||null;u.value=T(h),d()}const m=S([]);async function b(){var n;(n=window.$message)==null||n.success(E("common.deleteSuccess")),m.value=[],await l()}async function v(){var n;(n=window.$message)==null||n.success(E("common.deleteSuccess")),await l()}return{drawerVisible:y,openDrawer:d,closeDrawer:M,operateType:p,handleAdd:_,editingData:u,handleEdit:P,checkedRowKeys:m,onBatchDeleted:b,onDeleted:v}}export{ee as a,q as b,Z as c,J as d,H as e,V as f,X as g,Q as u};
