import{_ as be}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Chx9bFdT.js";import{c as z,b as he,g as ve,h as Ee}from"./auth-uPG7GYUs.js";import{u as oe,e as se,a as ye,b as Ve}from"./business-BJugQa59.js";import{r as $,a as W,$ as l,V as Z,W as we,d as ee,X as Q,Y as re,Z as ke,c as G,o as b,w as t,f as a,B as ue,h as e,p as de,q as me,a0 as Ne,b as F,F as M,z as I,a1 as Ce,a2 as ie,a3 as pe,s as ce,E as Y,g as q,t as j,a4 as De,a5 as Re,a6 as Ue,a7 as xe,a8 as Se,a9 as le,N as fe,R as te,aa as Pe,e as K,ab as Ge,ac as Te,ad as Oe,ae as Be,af as Fe,J as Me,ag as Ie,ah as ne,ai as ze,aj as $e}from"./index-q4uhLKit.js";import{u as ge,a as _e}from"./form-BMdG7JkN.js";import{_ as je,a as Ae}from"./round-refresh-CazVu48s.js";function Ke(){return z.Get("/systemManage/getAllRoles")}function Le(i){return z.Get("/systemManage/getUserList",{params:i})}function We(i){return z.Post("/systemManage/addUser",i)}function Ye(i){return z.Post("/systemManage/updateUser",i)}function qe(i){return z.Delete("/systemManage/deleteUser",{id:i})}function Xe(i){return z.Delete("/systemManage/batchDeleteUser",{ids:i})}function He(i){const _="__selection__",h="__expand__",N="__index__",P=$((C=>{const f=[];return C.forEach(v=>{v.type==="selection"?f.push({prop:_,label:l("common.check"),checked:!0}):v.type==="expand"?f.push({prop:h,label:l("common.expandColumn"),checked:!0}):v.type==="index"?f.push({prop:N,label:l("common.index"),checked:!0}):f.push({prop:v.prop,label:v.label,checked:!0})}),f})(i())),s=W(()=>{const C=i(),f=new Map;return C.forEach(p=>{p.type==="selection"?f.set(_,p):p.type==="expand"?f.set(h,p):p.type==="index"?f.set(N,p):f.set(p.prop,p)}),P.value.filter(p=>p.checked).map(p=>f.get(p.prop))});return{columnChecks:P,columns:s}}function Je(i,_){const{bool:h,setTrue:N,setFalse:V}=Z(),{bool:P,setTrue:s,setFalse:C}=Z(),{bool:f,setTrue:v,setFalse:p}=Z(),R=$("add"),c=y=>i.value.find(w=>w.id===y)||null;function r(){R.value="add",N()}const E=$(null);function D(y){R.value="edit",E.value=we(c(y)),N()}const x=$([]);async function O(){var y,w;v();try{const S=x.value.map(g=>c(g)).filter(Boolean);await((y=_.batchDelete)==null?void 0:y.call(_,S)),(w=window.$message)==null||w.success(l("common.deleteSuccess")),x.value=[]}finally{p()}}async function B(y){var S,g;s();const w=c(y);if(w)try{await((S=_.delete)==null?void 0:S.call(_,w)),(g=window.$message)==null||g.success(l("common.deleteSuccess")),x.value=[]}finally{C()}}return{drawerVisible:h,openDrawer:N,closeDrawer:V,operateType:R,handleAdd:r,editingData:E,handleEdit:D,checkedRowKeys:x,deleting:P,handleDelete:B,batchDeleting:f,handleBatchDelete:O}}const Ze=ee({name:"UserOperateDrawer",__name:"user-operate-drawer",props:Q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Q(["submitted"],["update:visible"]),setup(i,{emit:_}){const h=i,N=_,V=re(i,"visible"),{formRef:P,validate:s,restoreValidation:C}=ge(),{defaultRequiredRule:f}=_e(),v=W(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[h.operateType]),{loading:p,reset:R,send:c,form:r,updateForm:E}=he(g=>h.operateType==="add"?We(g):Ye(g),{initialForm:{userName:"",userGender:void 0,nickName:"",userPhone:"",userEmail:"",userRoles:[],status:void 0},resetAfterSubmiting:!0}),D={userName:f,status:f},{data:x,loading:O}=ve(Ke,[V],{initialData:[],middleware(g,u){return V.value?u():void 0}}),B=W(()=>{const g=x.value.map(k=>({label:k.roleName,value:k.roleCode}));return[...r.value.userRoles.map(k=>({label:k,value:k})),...g]});function y(){h.operateType==="edit"&&h.rowData?E(h.rowData):h.operateType==="add"&&R()}function w(){V.value=!1}async function S(){var g;await s(),await c(),(g=window.$message)==null||g.success(l("common.updateSuccess")),w(),N("submitted")}return ke(V,()=>{V.value&&(C(),y())}),(g,u)=>{const k=me,n=de,d=Ce,o=Ne,T=pe,X=ie,H=ue,A=Y,J=ce,U=De;return b(),G(U,{modelValue:V.value,"onUpdate:modelValue":u[7]||(u[7]=m=>V.value=m),title:v.value,"display-directive":"show",size:360},{footer:t(()=>[a(J,{size:16},{default:t(()=>[a(A,{onClick:w},{default:t(()=>[q(j(e(l)("common.cancel")),1)]),_:1}),a(A,{type:"primary",loading:e(p),onClick:S},{default:t(()=>[q(j(e(l)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(H,{ref_key:"formRef",ref:P,model:e(r),rules:D,"label-position":"top"},{default:t(()=>[a(n,{label:e(l)("page.manage.user.userName"),prop:"userName"},{default:t(()=>[a(k,{modelValue:e(r).userName,"onUpdate:modelValue":u[0]||(u[0]=m=>e(r).userName=m),placeholder:e(l)("page.manage.user.form.userName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.userGender"),prop:"userGender"},{default:t(()=>[a(o,{modelValue:e(r).userGender,"onUpdate:modelValue":u[1]||(u[1]=m=>e(r).userGender=m)},{default:t(()=>[(b(!0),F(M,null,I(e(oe),m=>(b(),G(d,{key:m.value,value:m.value,label:e(l)(m.label)},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.nickName"),prop:"nickName"},{default:t(()=>[a(k,{modelValue:e(r).nickName,"onUpdate:modelValue":u[2]||(u[2]=m=>e(r).nickName=m),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.userPhone"),prop:"userPhone"},{default:t(()=>[a(k,{modelValue:e(r).userPhone,"onUpdate:modelValue":u[3]||(u[3]=m=>e(r).userPhone=m),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.userEmail"),prop:"email"},{default:t(()=>[a(k,{modelValue:e(r).userEmail,"onUpdate:modelValue":u[4]||(u[4]=m=>e(r).userEmail=m),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.userStatus"),prop:"status"},{default:t(()=>[a(o,{modelValue:e(r).status,"onUpdate:modelValue":u[5]||(u[5]=m=>e(r).status=m)},{default:t(()=>[(b(!0),F(M,null,I(e(se),m=>(b(),G(d,{key:m.value,value:m.value,label:e(l)(m.label)},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.userRole"),prop:"roles"},{default:t(()=>[a(X,{modelValue:e(r).userRoles,"onUpdate:modelValue":u[6]||(u[6]=m=>e(r).userRoles=m),multiple:"",loading:e(O),placeholder:e(l)("page.manage.user.form.userRole")},{default:t(()=>[(b(!0),F(M,null,I(B.value,({label:m,value:ae})=>(b(),G(T,{key:ae,label:m,value:ae},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Qe=ee({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["search"],["update:model"]),setup(i,{emit:_}){const h=_,{formRef:N,validate:V,restoreValidation:P}=ge(),s=re(i,"model"),C={...s.value},f=W(()=>{const{patternRules:R}=_e();return{userEmail:R.email,userPhone:R.phone}});async function v(){await P(),Object.assign(s.value,C)}async function p(){await V(),h("search")}return(R,c)=>{const r=me,E=de,D=Se,x=pe,O=ie,B=je,y=Y,w=Ae,S=ce,g=xe,u=ue,k=Ue,n=Re,d=fe;return b(),G(d,{class:"card-wrapper"},{default:t(()=>[a(n,null,{default:t(()=>[a(k,{title:e(l)("common.search"),name:"user-search"},{default:t(()=>[a(u,{ref_key:"formRef",ref:N,model:s.value,rules:f.value,"label-position":"right","label-width":80},{default:t(()=>[a(g,{gutter:24},{default:t(()=>[a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.userName"),prop:"userName"},{default:t(()=>[a(r,{modelValue:s.value.userName,"onUpdate:modelValue":c[0]||(c[0]=o=>s.value.userName=o),placeholder:e(l)("page.manage.user.form.userName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.userGender"),prop:"userGender"},{default:t(()=>[a(O,{modelValue:s.value.userGender,"onUpdate:modelValue":c[1]||(c[1]=o=>s.value.userGender=o),placeholder:e(l)("page.manage.user.form.userGender"),clearable:""},{default:t(()=>[(b(!0),F(M,null,I(e(le)(e(oe)),({label:o,value:T})=>(b(),G(x,{key:T,label:o,value:T},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.nickName"),prop:"nickName"},{default:t(()=>[a(r,{modelValue:s.value.nickName,"onUpdate:modelValue":c[2]||(c[2]=o=>s.value.nickName=o),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.userPhone"),prop:"userPhone"},{default:t(()=>[a(r,{modelValue:s.value.userPhone,"onUpdate:modelValue":c[3]||(c[3]=o=>s.value.userPhone=o),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.userEmail"),prop:"userEmail"},{default:t(()=>[a(r,{modelValue:s.value.userEmail,"onUpdate:modelValue":c[4]||(c[4]=o=>s.value.userEmail=o),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.userGender"),prop:"userStatus"},{default:t(()=>[a(O,{modelValue:s.value.status,"onUpdate:modelValue":c[5]||(c[5]=o=>s.value.status=o),placeholder:e(l)("page.manage.user.form.userStatus"),clearable:""},{default:t(()=>[(b(!0),F(M,null,I(e(le)(e(se)),({label:o,value:T})=>(b(),G(x,{key:T,label:o,value:T},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:12,md:24,sm:24},{default:t(()=>[a(S,{class:"w-full justify-end",alignment:"end"},{default:t(()=>[a(y,{onClick:v},{icon:t(()=>[a(B,{class:"text-icon"})]),default:t(()=>[q(" "+j(e(l)("common.reset")),1)]),_:1}),a(y,{type:"primary",plain:"",onClick:p},{icon:t(()=>[a(w,{class:"text-icon"})]),default:t(()=>[q(" "+j(e(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),ea={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},aa={class:"flex items-center justify-between"},la={class:"h-[calc(100%-50px)]"},ta={class:"mt-20px flex justify-end"};function L(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!ze(i)}const na=ee({name:"alova_user",__name:"index",setup(i){const _=$({status:void 0,userName:void 0,userGender:void 0,nickName:void 0,userPhone:void 0,userEmail:void 0}),{loading:h,data:N,refresh:V,reload:P,page:s,pageSize:C,pageCount:f,send:v,remove:p,total:R}=Ee((n,d)=>Le({..._.value,current:n,size:d}),{data:({records:n})=>n,watchingStates:[_.value],debounce:[1e3]}),c=(n=1)=>{s.value=n,v(s.value,C.value)},r=n=>{C.value=n,v(s.value,n)},{drawerVisible:E,operateType:D,editingData:x,handleAdd:O,handleEdit:B,handleDelete:y,handleBatchDelete:w,checkedRowKeys:S}=Je(N,{async delete(n){await qe(n.id),p(n)},async batchDelete(n){await Xe(n.map(({id:d})=>d)),p(...n)}});function g(n){B(n)}const{columnChecks:u,columns:k}=He(()=>[{type:"selection",width:48},{prop:"userName",label:l("page.manage.user.userName"),minWidth:100},{prop:"userGender",label:l("page.manage.user.userGender"),width:100,formatter:n=>{if(n.userGender===void 0)return"";const d={1:"primary",2:"danger"},o=l(ye[n.userGender]);return a(te,{type:d[n.userGender]},L(o)?o:{default:()=>[o]})}},{prop:"nickName",label:l("page.manage.user.nickName"),minWidth:100},{prop:"userPhone",label:l("page.manage.user.userPhone"),width:120},{prop:"userEmail",label:l("page.manage.user.userEmail"),minWidth:200},{prop:"status",label:l("page.manage.user.userStatus"),width:100,formatter:n=>{if(n.status===void 0)return"";const d={1:"success",2:"warning"},o=l(Ve[n.status]);return a(te,{type:d[n.status]},L(o)?o:{default:()=>[o]})}},{prop:"operate",label:l("common.operate"),width:130,formatter:n=>{let d;return a("div",{class:"flex-center gap-8px"},[a(Y,{type:"primary",plain:!0,size:"small",onClick:()=>g(n.id)},L(d=l("common.edit"))?d:{default:()=>[d]}),a(Pe,{title:l("common.confirmDelete"),onConfirm:()=>y(n.id)},{reference:()=>{let o;return a(Y,{type:"danger",plain:!0,size:"small"},L(o=l("common.delete"))?o:{default:()=>[o]})}})])}}]);return(n,d)=>{const o=be,T=Oe,X=Te,H=Ie,A=fe,J=Fe;return b(),F("div",ea,[a(Qe,{model:_.value,"onUpdate:model":d[0]||(d[0]=U=>_.value=U),onSearch:c},null,8,["model"]),a(A,{class:"sm:flex-1-hidden card-wrapper","body-class":"ht50"},{header:t(()=>[K("div",aa,[K("p",null,j(e(l)("page.manage.user.title")),1),a(o,{columns:e(u),"onUpdate:columns":d[1]||(d[1]=U=>ne(u)?u.value=U:null),"disabled-delete":e(S).length===0,loading:e(h),onAdd:e(O),onDelete:e(w),onRefresh:e(V)},null,8,["columns","disabled-delete","loading","onAdd","onDelete","onRefresh"])])]),default:t(()=>[K("div",la,[Ge((b(),G(X,{height:"100%",border:"",class:"sm:h-full",data:e(N),"row-key":"id",onSelectionChange:d[2]||(d[2]=U=>S.value=U)},{default:t(()=>[(b(!0),F(M,null,I(e(k),U=>(b(),G(T,Be({key:U.prop,ref_for:!0},U),null,16))),128))]),_:1},8,["data"])),[[J,e(h)]]),K("div",ta,[e(R)?(b(),G(H,{key:0,layout:"total,prev,pager,next,sizes","current-page":e(s),total:e(R),"page-size":e(C),"page-sizes":[10,15,20,25,30],"page-count":e(f),onCurrentChange:c,onSizeChange:r},null,8,["current-page","total","page-size","page-count"])):Me("",!0)])]),a(Ze,{visible:e(E),"onUpdate:visible":d[3]||(d[3]=U=>ne(E)?E.value=U:null),"operate-type":e(D),"row-data":e(x),onSubmitted:e(P)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}}),ia=$e(na,[["__scopeId","data-v-1d21a4df"]]);export{ia as default};
