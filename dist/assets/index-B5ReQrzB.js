import"./index-kbpQbVgE.js";import{r as v,Z as S,i as B,aN as A,b as E,o as y,d as T,aH as R,a as V,e as b,f as d,aO as G,w as _,g as D,t as H,E as Z,a3 as q,a2 as J,J as O,h as Q,aP as F,aQ as K,ag as W,aL as Y,aj as M,c as N,aR as ee,aS as ae}from"./index-DRbpN7Ko.js";import{i as P,L as te}from"./installCanvasRenderer-DRoOyF6r.js";import{f as oe}from"./product-C9AIiMsr.js";import"./tslib.es6-CaDBovzY.js";const le=Object.assign({name:"BaseChart"},{__name:"base-chart",props:{option:{type:Object,required:!0},theme:{type:[String,Object],default:null},loading:{type:Boolean,default:!1},width:{type:String,default:"100%"},height:{type:String,default:"100%"}},emits:["chart-init"],setup(x,{expose:p,emit:u}){const s=x,n=u,g=v(null);let a=null;const r=()=>{g.value&&(a&&a.dispose(),a=P(g.value,s.theme),a.setOption(s.option),n("chart-init",a),s.loading?a.showLoading():a.hideLoading())},f=()=>{a&&a.resize()};return S(()=>s.option,h=>{a&&a.setOption(h)},{deep:!0}),S(()=>s.theme,h=>{a&&(a.dispose(),a=P(g.value,h),a.setOption(s.option))}),S(()=>s.loading,h=>{a&&(h?a.showLoading():a.hideLoading())}),B(()=>{r(),window.addEventListener("resize",f)}),A(()=>{a&&(a.dispose(),a=null),window.removeEventListener("resize",f)}),p({chartInstance:a}),(h,w)=>(y(),E("div",{ref_key:"chartEl",ref:g,style:{width:"500px",height:"500px"}},null,512))}}),ne={class:"header"},se={class:"controls"},re={class:"chart-container"},ie={key:0,class:"loading-overlay"},ce={class:"pagination-container"},de=T({__name:"use-echart",setup(x){const p=v(!1),u=v(!0),s=v("sampled"),n=v([]),g=v([]),a=v(""),r=R({pageNo:1,pageSize:1e3,total:51}),f=async()=>{var e,t;u.value=!0;try{const i=await oe({search:a.value,pageNo:r.pageNo,pageSize:r.pageSize});return console.log("res",i),n.value=((e=i==null?void 0:i.data)==null?void 0:e.products)||[],r.total=((t=i==null?void 0:i.data)==null?void 0:t.total)||0,n.value}catch(i){return console.error("获取产品数据失败",i),[]}finally{u.value=!1}},h=V(()=>p.value?"dark":"light"),w=V(()=>{const e=p.value;let t=[],i=[];if(s.value==="aggregated"){const c=new Map;console.log("productsData.value",n.value),n.value.forEach(o=>{c.has(o.category)||c.set(o.category,{category:o.category,totalStock:0,count:0});const l=c.get(o.category);l.totalStock+=o.stock,l.count+=1}),c.forEach((o,l)=>{t.push(l),i.push(Math.round(o.totalStock/o.count))})}else if(s.value==="all")console.log("XXXXXXXX  productsData.value",n.value),t=g.value.map(c=>c.product_name),i=g.value.map(c=>c.stock);else{const o=Math.max(1,Math.floor(n.value.length/500));for(let l=0;l<n.value.length;l+=o)t.push(n.value[l].product_name),i.push(n.value[l].stock)}return{backgroundColor:e?"#121212":"#fff",tooltip:{trigger:"axis",backgroundColor:e?"rgba(40, 40, 40, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:e?"#555":"#ddd",textStyle:{color:e?"#eee":"#333"},axisPointer:{type:"shadow",shadowStyle:{color:e?"rgba(150, 150, 150, 0.1)":"rgba(150, 150, 150, 0.05)"}},formatter(c){const o=c[0].data;if(s.value==="aggregated")return`${c[0].name}<br/>平均库存: ${o}`;const l=n.value.find(k=>k.product_name===c[0].name);return l?`
          <strong>${l.product_name}</strong><br/>
          类别: ${l.category}<br/>
          库存: ${l.stock}<br/>
          价格: ¥${l.price}<br/>
          更新时间: ${new Date(l.updated_at).toLocaleDateString()}
        `:""}},grid:{left:"3%",right:"4%",bottom:"15%",top:"10%",containLabel:!0},xAxis:{type:"category",data:t,axisLabel:{interval:0,rotate:45,color:e?"#aaa":"#666",fontSize:10},axisLine:{lineStyle:{color:e?"#444":"#ddd"}}},yAxis:{type:"value",name:"库存量",nameTextStyle:{color:e?"#aaa":"#666"},axisLine:{lineStyle:{color:e?"#444":"#ddd"}},axisLabel:{color:e?"#aaa":"#666"},splitLine:{lineStyle:{color:e?"#333":"#eee"}}},dataZoom:[{type:"inside",start:0,end:1},{type:"slider",show:!0,start:0,end:100,bottom:"5%",height:20,backgroundColor:e?"#333":"#f5f7fa",borderColor:e?"#555":"#ddd",textStyle:{color:e?"#ccc":"#666"},handleStyle:{color:e?"#555":"#ddd",borderColor:e?"#777":"#bbb"}}],series:[{name:"库存量",type:"bar",data:i,itemStyle:{color:new te(0,0,0,1,[{offset:0,color:"#5470c6"},{offset:1,color:"#83a0ed"}]),borderRadius:[2,2,0,0]},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(84, 112, 198, 0.5)"}},large:!0,largeThreshold:1e3,progressive:200,progressiveThreshold:3e3,progressiveChunkMode:"mod"}]}}),z=()=>{document.documentElement.classList.toggle("dark",p.value)},$=()=>{u.value=!u.value},C=()=>n.value,L=()=>{console.log("refreshData"),u.value=!0,setTimeout(()=>{f(),g.value=C(),u.value=!1},1e3)},U=e=>{console.log("page:",e),r.pageNo=e,f()},X=e=>{console.log("size:",e),r.pageSize=e,f()};return S(s,e=>{e==="all"&&(g.value=C())}),B(()=>{z(),L()}),(e,t)=>{const i=G,c=Z,o=q,l=J,k=le,I=K,j=W;return y(),E("div",{class:Y(["dashboard",[{dark:p.value}]])},[b("div",ne,[t[6]||(t[6]=b("h1",null,"产品库存数据可视化",-1)),b("div",se,[d(i,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=m=>p.value=m),"active-text":"暗色模式","inactive-text":"亮色模式",onChange:z},null,8,["modelValue"]),d(c,{type:"primary",onClick:$},{default:_(()=>[D(H(u.value?"隐藏加载":"显示加载"),1)]),_:1}),d(c,{onClick:L},{default:_(()=>t[5]||(t[5]=[D("刷新数据")])),_:1}),d(l,{modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=m=>s.value=m),placeholder:"显示模式",style:{width:"150px"}},{default:_(()=>[d(o,{label:"全部数据",value:"all"}),d(o,{label:"分类聚合",value:"aggregated"}),d(o,{label:"随机采样",value:"sampled"})]),_:1},8,["modelValue"]),d(l,{modelValue:r.pageSize,"onUpdate:modelValue":t[2]||(t[2]=m=>r.pageSize=m),placeholder:"每页数量",style:{width:"120px"}},{default:_(()=>[d(o,{label:"100条",value:100}),d(o,{label:"1000条",value:1e3}),d(o,{label:"3000条",value:3e3})]),_:1},8,["modelValue"])])]),b("div",re,[d(k,{ref:"chartRef",option:w.value,theme:h.value,loading:u.value,height:"500px"},null,8,["option","theme","loading"]),u.value?(y(),E("div",ie,[d(I,{class:"is-loading",size:36},{default:_(()=>[d(Q(F))]),_:1})])):O("",!0)]),b("div",ce,[d(j,{"current-page":r.pageNo,"onUpdate:currentPage":[t[3]||(t[3]=m=>r.pageNo=m),U],"page-size":r.pageSize,"onUpdate:pageSize":[t[4]||(t[4]=m=>r.pageSize=m),X],total:r.total,"page-sizes":[100,1e3,3e3],layout:"prev, pager, next, sizes, total",class:"pagination-background"},null,8,["current-page","page-size","total"])])],2)}}}),ue=M(de,[["__scopeId","data-v-b28ab2c2"]]),pe=T({name:"personal-content_echarts-optimization",__name:"index",setup(x){const p=v("first"),u=(s,n)=>{console.log(s,n)};return(s,n)=>{const g=ue,a=ee,r=ae;return y(),N(r,{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=f=>p.value=f),class:"demo-tabs",onTabClick:u},{default:_(()=>[d(a,{label:"echarts优化",name:"first"},{default:_(()=>[p.value==="first"?(y(),N(g,{key:0})):O("",!0)]),_:1})]),_:1},8,["modelValue"])}}}),_e=M(pe,[["__scopeId","data-v-2fef7e1a"]]);export{_e as default};
