import{_ as pi}from"./web-site-link.vue_vue_type_script_setup_true_lang-DGBv_I_A.js";import{V as _i}from"./vchart-all-Cl_6LLSO.js";import{d as lt,r as _e,aE as It,a as Le,i as Gt,aN as wi,Z as Kt,b as Ve,o as Ke,O as rt,bB as Rt,f as E,aK as Dt,ae as Ft,F as et,G as Hi,w as we,N as Ti,h as U,z as vt,c as gt,s as Pi}from"./index-C6tnI6Xh.js";import{l as Ne,t as Ct,m as Si,n as bi,o as Ii,p as ge,q as st,H as Ee,r as Ri,s as Xe,u as Di,w as Fi,x as Li,y as Ai,z as xi,A as Ki,E as Mi,F as Mt,J as Et,K as ft,M as Oe,N as ee,R as Ei,O as Oi,Q as Ni,U as Bi,V as zi,W as Vi,X as ki,Y as ji,Z as Wi,_ as He,$ as Ui,a0 as qi,a1 as yt,a2 as Qt,a3 as wt,a4 as dt,a5 as Ot,a6 as Me,a7 as xe,a8 as Gi,a9 as at,aa as mt,ab as tt,ac as Jt,ad as Qi,ae as Nt,af as Bt,ag as zt,ah as $t,ai as Yt,aj as Xt,ak as Zt,al as ei,am as ti,an as ii,ao as oi,ap as ri,aq as si,ar as li,as as ni,at as ai,au as di,av as Ji,aw as Ye,ax as nt,ay as Vt,az as $i,aA as Yi,aB as Xi,I as Zi,T as eo,aC as to,G as io,aD as oo,aE as ro,h as Ht,aF as so,k as it,D as ot}from"./index-A-iWJHs4.js";import{j as Be,e as Ce,i as O,I as ht,B as lo}from"./linear-scale-C88aT2VD.js";import"./index-CH7TBCPE.js";import"./get-Dx-ARM-V.js";import"./isSymbol-Dzdcm9yF.js";function no(R,e,t,i,r,o){const l=o.columnHeaderLevelCount,s=[],a=[];for(let u=0;u<t.length;u++)i.includes(t[u])||a.push(r[u]);for(let u=0;u<i.length;u++)if(!t.includes(i[u])){const c={col:R,row:l+u};s.push(c)}let n=o.getParentCellId(R,e),d=o.getRowHeaderCellAddressByCellId(n);const h=[];for(d&&h.push(d);n;)n=o.getParentCellId(d.col,d.row),n&&(d=o.getRowHeaderCellAddressByCellId(n),h.push(d));return{addCellPositionsRowDirection:s,removeCellPositionsRowDirection:a,updateCellPositionsRowDirection:h}}function ao(R,e,t,i,r,o){const l=o.columnHeaderLevelCount,s=[],a=[];for(let v=0;v<t.length;v++)i.includes(t[v])||a.push(r[v]);for(let v=0;v<i.length;v++)if(!t.includes(i[v])){const f={col:R,row:l+v};s.push(f)}let n=o.getParentCellId(R,e),d=o.getRowHeaderCellAddressByCellId(n);const h=[];for(d&&h.push(d);n;)n=o.getParentCellId(d.col,d.row),n&&(d=o.getRowHeaderCellAddressByCellId(n),h.push(d));const u=[],c=[];if(o.rowHierarchyType==="grid-tree"&&o.cornerSetting.titleOnDimension==="column"&&o.rowHeaderLevelCount!==o._cornerHeaderCellIds[0].length)if(o.rowHeaderLevelCount>o._cornerHeaderCellIds[0].length)for(let v=o._cornerHeaderCellIds[0].length;v<o.rowHeaderLevelCount;v++)u.push({col:v,row:e});else for(let v=o.rowHeaderLevelCount;v<o._cornerHeaderCellIds[0].length;v++)c.push({col:v,row:e});return{addCellPositionsRowDirection:s,removeCellPositionsRowDirection:a,updateCellPositionsRowDirection:h,addCellPositionsColumnDirection:u,removeCellPositionsColumnDirection:c}}function ho(R,e,t,i,r,o){const l=o.rowHeaderLevelCount,s=[],a=[];for(let v=0;v<t.length;v++)i.includes(t[v])||a.push(r[v]);for(let v=0;v<i.length;v++)if(!t.includes(i[v])){const f={col:l+v,row:e};s.push(f)}let n=o.getParentCellId(R,e),d=o.getRowHeaderCellAddressByCellId(n);const h=[];for(d&&h.push(d);d&&n;)n=o.getParentCellId(d.col,d.row),n&&(d=o.getRowHeaderCellAddressByCellId(n),h.push(d));const u=[],c=[];if(o.columnHierarchyType==="grid-tree"&&o.cornerSetting.titleOnDimension==="row"&&o.columnHeaderLevelCount!==o._cornerHeaderCellIds.length)if(o.columnHeaderLevelCount>o._cornerHeaderCellIds.length)for(let v=o._cornerHeaderCellIds.length;v<o.columnHeaderLevelCount;v++)u.push({col:R,row:v});else for(let v=o.columnHeaderLevelCount;v<o._cornerHeaderCellIds.length;v++)c.push({col:R,row:v});return{addCellPositionsColumnDirection:s,removeCellPositionsColumnDirection:a,updateCellPositionsColumnDirection:h,addCellPositionsRowDirection:u,removeCellPositionsRowDirection:c}}const kt={startInTotal:0,afterSpanLevel:0};class ze{constructor(e,t,i,r){var o,l,s,a,n,d,h,u,c,v,f,H,g,m,w,C,_,p,S;this.colIndex=0,this._showHeader=!0,this.columnHeaderObjs=[],this.rowHeaderObjs=[],this._cornerHeaderCellFullPathIds=[],this._columnHeaderCellFullPathIds=[],this._rowHeaderCellFullPathIds=[],this._rowHeaderCellFullPathIds_FULL=[],this._cornerHeaderCellIds=[],this._columnHeaderCellIds=[],this._rowHeaderCellIds=[],this._rowHeaderCellIds_FULL=[],this._columnWidths=[],this.columnPaths=[],this._headerObjects=[],this._headerObjectMap={},this._indicators=[],this.indicatorsAsCol=!0,this.hideIndicatorName=!1,this._showRowHeader=!0,this._showColumnHeader=!0,this._indicatorShowType="column",this.rowHierarchyTextStartAlignment=!1,this.rowDimensionKeys=[],this.colDimensionKeys=[],this.indicatorKeys=[],this.indicatorDimensionKey=Ne,this._rowHeaderExtensionTree={},this._extensionRowDimensionKeys=[],this.fullRowDimensionKeys=[],this.leftRowSeriesNumberColumnCount=0,this.rightRowSeriesNumberColumnCount=0,this._useGetBodyCache=!1,this._getBodyCache=new Map,this._useHeaderPathCache=!1,this._colHeaderPathCache=new Map,this._rowHeaderPathCache=new Map,this.sharedVar=e.layoutNodeId,this._table=e,e.options.rowHierarchyType==="tree"&&(this.extensionRows=e.options.extensionRows),this.dataset=t,this._largeCellRangeCache=[],this._CellHeaderPathMap=new Map,this.rowTree=e.internalProps.rowTree,this.columnTree=e.internalProps.columnTree,this.rowsDefine=(o=e.internalProps.rows)!==null&&o!==void 0?o:[],this.columnsDefine=(l=e.internalProps.columns)!==null&&l!==void 0?l:[],this.indicatorsDefine=(s=e.internalProps.indicators)!==null&&s!==void 0?s:[],this.indicatorTitle=e.options.indicatorTitle,this.indicatorsAsCol=(a=e.options.indicatorsAsCol)===null||a===void 0||a,this.hideIndicatorName=(n=e.options.hideIndicatorName)!==null&&n!==void 0&&n,this.showRowHeader=(d=e.options.showRowHeader)===null||d===void 0||d,this.showColumnHeader=(h=e.options.showColumnHeader)===null||h===void 0||h,this.rowHeaderTitle=e.options.rowHeaderTitle,this.columnHeaderTitle=e.options.columnHeaderTitle,this.rowHierarchyType=(u=e.options.rowHierarchyType)!==null&&u!==void 0?u:"grid",this.columnHierarchyType=(c=e.options.columnHierarchyType)!==null&&c!==void 0?c:"grid",this.rowExpandLevel=(v=e.options.rowExpandLevel)!==null&&v!==void 0?v:1,this.columnExpandLevel=(f=e.options.columnExpandLevel)!==null&&f!==void 0?f:1,this.rowHierarchyIndent=(H=e.options.rowHierarchyIndent)!==null&&H!==void 0?H:20,this.rowHierarchyTextStartAlignment=e.options.rowHierarchyTextStartAlignment,this.cornerSetting=Object.assign({titleOnDimension:"column",forceShowHeader:!1},e.options.corner),t&&(this.rowTree=t.rowHeaderTree,this.columnTree=t.colHeaderTree),(g=this.indicatorsDefine)===null||g===void 0||g.forEach(T=>{typeof T=="string"?this.indicatorKeys.push(T):this.indicatorKeys.push(T.indicatorKey)}),this.columnDimensionTree=i,this.rowDimensionTree=r,this.colDimensionKeys=this.columnDimensionTree.dimensionKeysIncludeVirtual.valueArr(),this.rowDimensionKeys=this.rowDimensionTree.dimensionKeysIncludeVirtual.valueArr(),this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(this.rowDimensionKeys),this.resetRowHeaderLevelCount(),this._table.isPivotChart()&&(this.hasTwoIndicatorAxes=this.indicatorsDefine.some(T=>{var b,A;if(T.chartSpec&&T.chartSpec.series&&T.chartSpec.series.length>1){const F=(A=(b=T.chartSpec.axes)!==null&&b!==void 0?b:this._table.pivotChartAxes)!==null&&A!==void 0?A:[];if(!F.length||F.every(N=>N.orient!==(this.indicatorsAsCol?"top":"right")||N.visible!==!1))return!0}return!1})),this.resetColumnHeaderLevelCount(),this._generateColHeaderIds(),this.colIndex=0,this._generateRowHeaderIds(),this._rowHeaderCellFullPathIds_FULL=Ct(this._rowHeaderCellFullPathIds_FULL),e.options.rowHierarchyType==="tree"&&((m=this.extensionRows)===null||m===void 0?void 0:m.length)>=1&&(this.generateExtensionRowTree(),this.extensionRows.forEach(T=>{const b=[];T.rows.forEach(A=>{typeof A=="string"?b.push(A):b.push(A.dimensionKey)}),this._extensionRowDimensionKeys.push(b),this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(b)})),this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length);let P,y=this.columnDimensionTree.dimensionKeysIncludeVirtual.valueArr();!this.dataset||this._table.isPivotChart()||((C=(w=this.dataset.records)===null||w===void 0?void 0:w.length)!==null&&C!==void 0?C:0)!==0||this.dataset.customColTree||(y=this.columnsDefine.map(T=>typeof T=="string"?T:T.dimensionKey),this.indicatorsAsCol&&y.push(this.indicatorDimensionKey)),y=this.columnHeaderTitle?[""].concat(y):y;let I=[];if(this.rowHierarchyType==="tree"&&((_=this.extensionRows)===null||_===void 0?void 0:_.length)>=1){const T=[];T.push(this.rowDimensionKeys[0]),this._extensionRowDimensionKeys.forEach(b=>{T.push(b[0])}),I=this.extensionRows.reduce((b,A)=>b.concat(A.rows),[]),P=this.rowHeaderTitle?[""].concat(T):T}else P=this.rowDimensionTree.dimensionKeysIncludeVirtual.valueArr(),!this.dataset||this._table.isPivotChart()||((S=(p=this.dataset.records)===null||p===void 0?void 0:p.length)!==null&&S!==void 0?S:0)!==0||this.dataset.customRowTree||(P=this.rowsDefine.map(T=>typeof T=="string"?T:T.dimensionKey),this.indicatorsAsCol||P.push(this.indicatorDimensionKey)),P=this.rowHeaderTitle?[""].concat(P):P;this.cornerHeaderObjs=this._addCornerHeaders(y,P,this.columnsDefine.concat(...this.rowsDefine,...I)),this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce((T,b)=>(T[b.id]=b,T),{}),this.indicatorsAsCol&&!this.hideIndicatorName?this._indicatorShowType="column":this.indicatorsAsCol||this.hideIndicatorName?this._indicatorShowType="none":this._indicatorShowType="row",this.generateCellIdsConsiderHideHeader(),this.setPagination(e.options.pagination),this._table.isPivotChart()&&(this._chartItemSpanSize=0,this._chartItemBandSize=0,this._indicators.find(T=>{var b,A,F,N,x,M,L,K;!((b=T==null?void 0:T.style)===null||b===void 0)&&b.padding&&(this._chartPadding=T.style.padding),!((A=T.chartSpec)===null||A===void 0)&&A.barWidth&&typeof T.chartSpec.barWidth=="number"&&(this._chartItemSpanSize=(F=T.chartSpec)===null||F===void 0?void 0:F.barWidth);const J=(x=(N=T.chartSpec)===null||N===void 0?void 0:N.axes)===null||x===void 0?void 0:x.find($=>$.type==="band");return J!=null&&J.bandSize&&(this._chartItemBandSize=J==null?void 0:J.bandSize,this._chartPaddingInner=(M=Be(J.paddingInner)?J.paddingInner[0]:J.paddingInner)!==null&&M!==void 0?M:0,this._chartPaddingOuter=(L=Be(J.paddingOuter)?J.paddingOuter[0]:J.paddingOuter)!==null&&L!==void 0?L:0),this._chartItemSpanSize>0||((K=T.chartSpec.series)===null||K===void 0||K.find($=>($.barWidth&&typeof $.barWidth=="number"&&(this._chartItemSpanSize=$.barWidth),this._chartItemSpanSize>0)),!1)})),this.handleRowSeriesNumber(e.internalProps.rowSeriesNumber),this.setColumnWidths()}handleRowSeriesNumber(e){var t,i;e&&(Array.isArray(e)?this.rowSeriesNumberColumn=e.map(r=>{var o,l;return{id:"",title:r.title,define:r,cellType:(o=r.cellType)!==null&&o!==void 0?o:"text",headerType:(l=r.cellType)!==null&&l!==void 0?l:"text",width:r.width,style:r.style,format:r.format,field:r.field,icon:r.icon}}):this.rowSeriesNumberColumn=[{id:"",title:e.title,define:e,cellType:(t=e.cellType)!==null&&t!==void 0?t:"text",headerType:(i=e.cellType)!==null&&i!==void 0?i:"text",style:e.style,width:e.width,format:e.format,field:"",icon:e.icon,isChildNode:!1}],this.leftRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter(r=>!0),this.rightRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter(r=>!1),this.leftRowSeriesNumberColumnCount=this.leftRowSeriesNumberColumn.length,this.rightRowSeriesNumberColumnCount=this.rightRowSeriesNumberColumn.length)}_generateColHeaderIds(){var e,t,i,r,o,l,s,a;if(((e=this.columnDimensionTree.tree.children)===null||e===void 0?void 0:e.length)>=1)if(this.columnHierarchyType==="grid-tree")this._addHeadersForGridTreeMode(this._columnHeaderCellFullPathIds,0,this.columnDimensionTree.tree.children,[],this.columnDimensionTree.totalLevel,this._getColumnHeaderTreeExpandedMaxLevelCount(),!0,this.columnsDefine,this.columnHeaderObjs,!1);else{let n=0;if(this.dataset&&!this._table.isPivotChart()&&((i=(t=this.dataset.records)===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:0)===0&&!this.dataset.customColTree&&!this.dataset.customRowTree&&this.indicatorsAsCol&&this._getColumnHeaderTreeExpandedMaxLevelCount()<this.columnHeaderLevelCount){n=this.columnHeaderLevelCount-this._getColumnHeaderTreeExpandedMaxLevelCount();for(let d=0;d<n;d++)this._columnHeaderCellFullPathIds.unshift([])}this._addHeaders(this._columnHeaderCellFullPathIds,n,this.columnDimensionTree.tree.children,[],this.columnHeaderObjs)}if(this.columnHeaderTitle){this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length);const n=++this.sharedVar.seqId,d=Array(this.colCount-this.rowHeaderLevelCount-this.rightFrozenColCount).fill(n);this._columnHeaderCellFullPathIds.unshift(d);const h={id:n,title:typeof this.columnHeaderTitle.title=="string"?this.columnHeaderTitle.title:this.columnsDefine.reduce((u,c)=>typeof c=="string"?u:u+(u?`/${c.title}`:`${c.title}`),""),field:void 0,headerType:(o=(r=this.columnHeaderTitle)===null||r===void 0?void 0:r.headerType)!==null&&o!==void 0?o:"text",style:(l=this.columnHeaderTitle)===null||l===void 0?void 0:l.headerStyle,define:{id:n,disableHeaderHover:!!(!((s=this.columnHeaderTitle)===null||s===void 0)&&s.disableHeaderHover),disableHeaderSelect:!!(!((a=this.columnHeaderTitle)===null||a===void 0)&&a.disableHeaderSelect)}};this.columnHeaderObjs.push(h),this._headerObjects[n]=h}}_generateRowHeaderIds(){var e,t,i,r,o,l,s,a,n,d;if(((e=this.rowDimensionTree.tree.children)===null||e===void 0?void 0:e.length)>=1)if(this.rowHierarchyType==="tree")this._addHeadersForTreeMode(this._rowHeaderCellFullPathIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,!0,this.rowsDefine,this.rowHeaderObjs);else if(this.rowHierarchyType==="grid-tree")this._addHeadersForGridTreeMode(this._rowHeaderCellFullPathIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,this._getRowHeaderTreeExpandedMaxLevelCount(),!0,this.rowsDefine,this.rowHeaderObjs,!0);else{let h=0;if(this.dataset&&!this._table.isPivotChart()&&((i=(t=this.dataset.records)===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:0)===0&&!this.dataset.customColTree&&!this.dataset.customRowTree&&!this.indicatorsAsCol&&this._getRowHeaderTreeExpandedMaxLevelCount()<this.rowHeaderLevelCount){h=this.rowHeaderLevelCount-this._getRowHeaderTreeExpandedMaxLevelCount();for(let u=0;u<h;u++)this._rowHeaderCellFullPathIds_FULL.unshift([])}this._addHeaders(this._rowHeaderCellFullPathIds_FULL,h,this.rowDimensionTree.tree.children,[],this.rowHeaderObjs)}if(this.rowHeaderTitle){this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length);const h=++this.sharedVar.seqId,u=Array((o=(r=this._rowHeaderCellFullPathIds_FULL[0])===null||r===void 0?void 0:r.length)!==null&&o!==void 0?o:this.rowDimensionTree.tree.size).fill(h);this._rowHeaderCellFullPathIds_FULL.unshift(u);const c={id:h,title:typeof this.rowHeaderTitle.title=="string"?this.rowHeaderTitle.title:this.rowsDefine.reduce((v,f)=>typeof f=="string"?v:v+(v?`/${f.title}`:`${f.title}`),""),field:void 0,headerType:(s=(l=this.rowHeaderTitle)===null||l===void 0?void 0:l.headerType)!==null&&s!==void 0?s:"text",style:(a=this.rowHeaderTitle)===null||a===void 0?void 0:a.headerStyle,define:{id:h,disableHeaderHover:!!(!((n=this.rowHeaderTitle)===null||n===void 0)&&n.disableHeaderHover),disableHeaderSelect:!!(!((d=this.rowHeaderTitle)===null||d===void 0)&&d.disableHeaderSelect)}};this.rowHeaderObjs.push(c),this._headerObjects[h]=c}}_getRowHeaderTreeExpandedMaxLevelCount(){return this.rowHierarchyType==="tree"?1:this.rowHierarchyType==="grid-tree"?this.cornerSetting.titleOnDimension==="row"?this.rowDimensionTree.totalLevel:this.indicatorsAsCol?this.rowDimensionTree.expandedMaxLevel:this.rowDimensionTree.expandedMaxLevel+1:this.rowDimensionTree.totalLevel}_getColumnHeaderTreeExpandedMaxLevelCount(){return this.columnHierarchyType==="grid-tree"?this.cornerSetting.titleOnDimension==="column"?this.columnDimensionTree.totalLevel:this.indicatorsAsCol===!1?this.columnDimensionTree.expandedMaxLevel:this.columnDimensionTree.expandedMaxLevel+1:this.columnDimensionTree.totalLevel}_addHeaders(e,t,i,r,o){const l=this;e[t]||function(s){const a=e[s]=[];if(l.colIndex===0)return a;const n=e[s-1];for(let d=0;d<(n==null?void 0:n.length);d++)a[d]=n[d]}(t);for(let s=0;s<i.length;s++){const a=i[s];Si(a,e,o,r,t,this)}}_addHeadersForTreeMode(e,t,i,r,o,l,s,a){const n=this;e[t]||function(d){const h=e[d]=[];if(n.colIndex===0)return h;const u=e[d-1];for(let c=0;c<(u==null?void 0:u.length);c++)h[c]=u[c]}(t);for(let d=0;d<i.length;d++){const h=i[d];bi(h,e,a,r,t,o,l,s,this)}}_addHeadersForGridTreeMode(e,t,i,r,o,l,s,a,n,d){const h=this;e[t]||function(u){const c=e[u]=[];if(h.colIndex===0)return c;const v=e[u-1];for(let f=0;f<(v==null?void 0:v.length);f++)c[f]=v[f]}(t);for(let u=0;u<i.length;u++){const c=i[u];Ii(c,e,n,r,t,o,l,s,a,d,this.indicatorsAsCol,this)}}_addCornerHeaders(e,t,i){var r,o,l,s,a,n,d,h,u,c;this._cornerHeaderCellFullPathIds=[];const v=[],f=this.columnHierarchyType==="grid-tree"&&this._getColumnHeaderTreeExpandedMaxLevelCount()||this.columnHeaderLevelCount,H=this.rowHierarchyType==="grid-tree"&&this._getRowHeaderTreeExpandedMaxLevelCount()||this.rowHeaderLevelCount;if(this.cornerSetting.titleOnDimension==="all")if(this.indicatorsAsCol){if(e)for(let g=0;g<f;g++){const m=e[g],w=++this.sharedVar.seqId,C=i.find(p=>typeof p!="string"&&p.dimensionKey===m),_={id:w,title:m===this.indicatorDimensionKey?this.indicatorTitle:C?C.title:m==="axis"?"":m,field:m,style:this.cornerSetting.headerStyle,headerType:(r=this.cornerSetting.headerType)!==null&&r!==void 0?r:"text",showSort:C==null?void 0:C.showSortInCorner,sort:C==null?void 0:C.sort,define:{showSort:C==null?void 0:C.showSortInCorner,sort:C==null?void 0:C.sort,dimensionKey:m,id:w,value:m,headerEditor:this.cornerSetting.headerEditor,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:C==null?void 0:C.cornerDropDownMenu,headerIcon:C==null?void 0:C.cornerHeaderIcon,pivotInfo:{value:(o=C==null?void 0:C.title)!==null&&o!==void 0?o:"",dimensionKey:m,isPivotCorner:!0},description:C==null?void 0:C.cornerDescription};v[w]=_,this._headerObjects[w]=_,this._cornerHeaderCellFullPathIds[g]||(this._cornerHeaderCellFullPathIds[g]=[]);for(let p=0;p<H;p++)this._cornerHeaderCellFullPathIds[g][p]=w}if(t)for(let g=0;g<H;g++){const m=t[g],w=++this.sharedVar.seqId,C=i.find(p=>typeof p!="string"&&p.dimensionKey===m),_={id:w,title:m===this.indicatorDimensionKey?this.indicatorTitle:C?C.title:m==="axis"?"":m,field:m,style:this.cornerSetting.headerStyle,headerType:(l=this.cornerSetting.headerType)!==null&&l!==void 0?l:"text",showSort:C==null?void 0:C.showSortInCorner,sort:C==null?void 0:C.sort,define:{showSort:C==null?void 0:C.showSortInCorner,sort:C==null?void 0:C.sort,dimensionKey:m,id:w,value:m,headerEditor:this.cornerSetting.headerEditor,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:C==null?void 0:C.cornerDropDownMenu,headerIcon:C==null?void 0:C.cornerHeaderIcon,pivotInfo:{value:(s=C==null?void 0:C.title)!==null&&s!==void 0?s:"",dimensionKey:m,isPivotCorner:!0},description:C==null?void 0:C.cornerDescription};v[w]=_,this._headerObjects[w]=_,this._cornerHeaderCellFullPathIds[this._cornerHeaderCellFullPathIds.length-1]||(this._cornerHeaderCellFullPathIds[this._cornerHeaderCellFullPathIds.length-1]=[]),this._cornerHeaderCellFullPathIds[this._cornerHeaderCellFullPathIds.length-1][g]=w}}else{if(t)for(let g=0;g<H;g++){const m=t[g],w=++this.sharedVar.seqId,C=i.find(p=>typeof p!="string"&&p.dimensionKey===m),_={id:w,title:m===this.indicatorDimensionKey?this.indicatorTitle:C?C.title:m==="axis"?"":m,field:m,style:this.cornerSetting.headerStyle,headerType:(a=this.cornerSetting.headerType)!==null&&a!==void 0?a:"text",showSort:C==null?void 0:C.showSortInCorner,sort:C==null?void 0:C.sort,define:{showSort:C==null?void 0:C.showSortInCorner,sort:C==null?void 0:C.sort,dimensionKey:m,id:w,value:m,headerEditor:this.cornerSetting.headerEditor,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:C==null?void 0:C.cornerDropDownMenu,headerIcon:C==null?void 0:C.cornerHeaderIcon,pivotInfo:{value:(n=C==null?void 0:C.title)!==null&&n!==void 0?n:"",dimensionKey:m,isPivotCorner:!0},description:C==null?void 0:C.cornerDescription};v[w]=_,this._headerObjects[w]=_;for(let p=0;p<f;p++)this._cornerHeaderCellFullPathIds[p]||(this._cornerHeaderCellFullPathIds[p]=[]),this._cornerHeaderCellFullPathIds[p][g]=w}if(e)for(let g=0;g<f;g++){const m=e[g],w=++this.sharedVar.seqId,C=i.find(p=>typeof p!="string"&&p.dimensionKey===m),_={id:w,title:m===this.indicatorDimensionKey?this.indicatorTitle:C?C.title:m==="axis"?"":m,field:m,style:this.cornerSetting.headerStyle,headerType:(d=this.cornerSetting.headerType)!==null&&d!==void 0?d:"text",showSort:C==null?void 0:C.showSortInCorner,sort:C==null?void 0:C.sort,define:{showSort:C==null?void 0:C.showSortInCorner,sort:C==null?void 0:C.sort,dimensionKey:m,id:w,value:m,headerEditor:this.cornerSetting.headerEditor,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:C==null?void 0:C.cornerDropDownMenu,headerIcon:C==null?void 0:C.cornerHeaderIcon,pivotInfo:{value:(h=C==null?void 0:C.title)!==null&&h!==void 0?h:"",dimensionKey:m,isPivotCorner:!0},description:C==null?void 0:C.cornerDescription};v[w]=_,this._headerObjects[w]=_,this._cornerHeaderCellFullPathIds[g][this._cornerHeaderCellFullPathIds[g].length-1]=w}}else if(this.cornerSetting.titleOnDimension==="row"||this.cornerSetting.titleOnDimension==="column"){const g=((u=this.cornerSetting)===null||u===void 0?void 0:u.titleOnDimension)==="row"?t:e;g&&g.forEach((m,w)=>{var C,_;const p=++this.sharedVar.seqId,S=i.find(y=>typeof y!="string"&&y.dimensionKey===m),P={id:p,title:m===this.indicatorDimensionKey?this.indicatorTitle:S?S.title:m==="axis"?"":m,field:m,style:this.cornerSetting.headerStyle,headerType:(C=this.cornerSetting.headerType)!==null&&C!==void 0?C:"text",showSort:S==null?void 0:S.showSortInCorner,sort:S==null?void 0:S.sort,define:{showSort:S==null?void 0:S.showSortInCorner,sort:S==null?void 0:S.sort,dimensionKey:m,id:p,value:m,headerCustomRender:this.cornerSetting.customRender,headerCustomLayout:this.cornerSetting.customLayout,headerEditor:this.cornerSetting.headerEditor,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:S==null?void 0:S.cornerDropDownMenu,headerIcon:S==null?void 0:S.cornerHeaderIcon,pivotInfo:{value:(_=S==null?void 0:S.title)!==null&&_!==void 0?_:"",dimensionKey:m,isPivotCorner:!0},description:S==null?void 0:S.cornerDescription};if(v[p]=P,this._headerObjects[p]=P,this.cornerSetting.titleOnDimension==="column"){this._cornerHeaderCellFullPathIds[w]||(this._cornerHeaderCellFullPathIds[w]=[]);for(let y=0;y<this.rowHeaderLevelCount;y++)this._cornerHeaderCellFullPathIds[w][y]=p}else if(this.cornerSetting.titleOnDimension==="row")for(let y=0;y<this.columnHeaderLevelCount;y++)this._cornerHeaderCellFullPathIds[y]||(this._cornerHeaderCellFullPathIds[y]=[]),this._cornerHeaderCellFullPathIds[y][w]=p})}else{const g=++this.sharedVar.seqId,m={id:g,title:"",field:"维度名称",style:this.cornerSetting.headerStyle,headerType:(c=this.cornerSetting.headerType)!==null&&c!==void 0?c:"text",define:{dimensionKey:"维度名称",id:g,headerCustomRender:this.cornerSetting.customRender,headerCustomLayout:this.cornerSetting.customLayout,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect}};v[g]=m,this._headerObjects[g]=m;for(let w=0;w<this.columnHeaderLevelCount;w++)for(let C=0;C<this.rowHeaderLevelCount;C++)this._cornerHeaderCellFullPathIds[w]||(this._cornerHeaderCellFullPathIds[w]=[]),this._cornerHeaderCellFullPathIds[w][C]=g}return v}generateExtensionRowTree(){this.extensionRows.forEach((e,t)=>{const i=this._rowHeaderCellFullPathIds_FULL;this._rowHeaderCellFullPathIds_FULL=[],i.forEach((r,o)=>{const l=r[r.length-1];let s,a;if(this.colIndex=0,typeof e.rowTree=="function"){const d=this.findFullCellIds(r);s=e.rowTree(d.map(h=>({dimensionKey:this._headerObjects[h].field,value:this._headerObjects[h].title})))}else s=Ce(e.rowTree);this._rowHeaderExtensionTree[l]?(this._rowHeaderExtensionTree[l].reset(this._rowHeaderExtensionTree[l].tree.children),a=this._rowHeaderExtensionTree[l]):(a=new ge(s??[],this.sharedVar,this.rowHierarchyType,void 0),this._rowHeaderExtensionTree[l]=a);const n=[];this._addHeadersForTreeMode(n,0,a.tree.children,[],a.totalLevel,!0,e.rows,this.rowHeaderObjs);for(let d=0;d<n[0].length;d++)this._rowHeaderCellFullPathIds_FULL.push(r.concat(n[0][d]))})})}setColumnWidths(){var e,t,i;const r=new Array(this.colCount).fill(void 0);if(this.leftRowSeriesNumberColumnCount&&(r[0]=this.leftRowSeriesNumberColumn[0]),this.showHeader&&this.showRowHeader)if(this.rowHeaderTitle&&(r[0+this.leftRowSeriesNumberColumnCount]={}),this.rowHierarchyType==="tree"){const o=this.rowDimensionKeys[0];if(o){const l=(e=this.rowsDefine)===null||e===void 0?void 0:e.find(s=>typeof s!="string"&&s.dimensionKey===o);l&&(r[0+(this.rowHeaderTitle?1:0)+this.leftRowSeriesNumberColumnCount]={width:l.width,minWidth:l.minWidth,maxWidth:l.maxWidth})}(t=this._extensionRowDimensionKeys)===null||t===void 0||t.forEach((l,s)=>{var a;const n=l[0];if(n){const d=(a=this.extensionRows[s].rows)===null||a===void 0?void 0:a.find(h=>typeof h!="string"&&h.dimensionKey===n);d&&(r[s+1+(this.rowHeaderTitle?1:0)+this.leftRowSeriesNumberColumnCount]={width:d.width,minWidth:d.minWidth,maxWidth:d.maxWidth})}})}else(this.rowDimensionTree.totalLevel>0?this.rowDimensionTree.dimensionKeysIncludeVirtual.valueArr():this.rowsDefine.map(o=>typeof o=="string"?o:o.dimensionKey)).forEach((o,l)=>{var s;const a=(s=this.rowsDefine)===null||s===void 0?void 0:s.find(n=>typeof n!="string"&&n.dimensionKey===o);a&&(r[l+(this.rowHeaderTitle?1:0)+this.leftRowSeriesNumberColumnCount]={width:a.width,minWidth:a.minWidth,maxWidth:a.maxWidth})});if(this.indicatorsAsCol)for(let o=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount;o<this.colCount;o++){const l=this.getBody(o,this.columnHeaderLevelCount);r[o]={width:l==null?void 0:l.width,minWidth:l==null?void 0:l.minWidth,maxWidth:l==null?void 0:l.maxWidth}}else{let o,l,s,a=0;(i=this._indicators)===null||i===void 0||i.forEach((n,d)=>{var h,u;typeof n.width=="number"?a=Math.max(n.width,a):n.width==="auto"&&(s=!0),typeof n.minWidth=="number"&&(l=Math.max(n.minWidth,(h=l)!==null&&h!==void 0?h:0)),typeof n.maxWidth=="number"&&(o=Math.min(n.maxWidth,(u=o)!==null&&u!==void 0?u:Number.MAX_VALUE))}),a=a>0?a:s?"auto":void 0,r.fill({width:a,minWidth:l,maxWidth:o},this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount,this.colCount-this.rightFrozenColCount)}this._columnWidths=r}get columnWidths(){return this._columnWidths}getColumnWidthDefined(e){return this._columnWidths[e]}get showHeader(){return this._showHeader}set showHeader(e){this._showHeader=e}get showColumnHeader(){return this._showColumnHeader}set showColumnHeader(e){this._showColumnHeader=e}get showRowHeader(){return this._showRowHeader}set showRowHeader(e){this._showRowHeader=e}get columnHeaderTitle(){return this._columnHeaderTitle}set columnHeaderTitle(e){this._columnHeaderTitle=e}get rowHeaderTitle(){return this._rowHeaderTitle}set rowHeaderTitle(e){this._rowHeaderTitle=e}getHeaderFieldKey(e,t){}getCellLocation(e,t){return this.isCornerHeader(e,t)?"cornerHeader":this.isColumnHeader(e,t)?"columnHeader":this.isRowHeader(e,t)?"rowHeader":"body"}isHeader(e,t){return e>=this.leftRowSeriesNumberColumnCount&&e<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount||t>=0&&t<this.columnHeaderLevelCount||e>=this.colCount-this.rightHeaderColCount||t>=this.rowCount-this.bottomHeaderRowCount}isCornerHeader(e,t){return e>=0&&e<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount&&t>=0&&t<this.columnHeaderLevelCount}isColumnHeader(e,t){return e>=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount&&t>=0&&t<this.columnHeaderLevelCount}isRowHeader(e,t){return e>=this.leftRowSeriesNumberColumnCount&&e<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount&&t>=this.columnHeaderLevelCount}isFrozen(e,t){return this.isFrozenColumn(e)||this.isRightFrozenColumn(e)||this.isBottomFrozenRow(t)||this.isFrozenRow(t)||this.isSeriesNumberInBody(e,t)||this.isSeriesNumberInHeader(e,t)}isFrozenColumn(e,t){if(O(t)){if(e>=0&&e<this.frozenColCount&&t>=this.frozenRowCount&&t<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&e>=0&&e<this.frozenColCount)return!0;return!1}isRightFrozenColumn(e,t){if(O(t)){if(e>=this.colCount-this.rightFrozenColCount&&t>=this.frozenRowCount&&t<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&e>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(e,t){if(O(t)){if(t>=0&&t<this.frozenRowCount&&e>=this.frozenColCount&&e<this.colCount-this.rightFrozenColCount)return!0}else if(t=e,this.frozenRowCount>0&&t>=0&&t<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(e,t){if(O(t)){if(t>=this.rowCount-this.bottomFrozenRowCount&&e>=this.frozenColCount&&e<this.colCount-this.rightFrozenColCount)return!0}else if(t=e,this.bottomFrozenRowCount>0&&t>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftTopCorner(e,t){return e>=0&&e<this.frozenColCount&&t>=0&&t<this.frozenRowCount}isLeftBottomCorner(e,t){return e>=0&&e<this.frozenColCount&&t>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(e,t){return e>=this.colCount-this.rightFrozenColCount&&t>=0&&t<this.frozenRowCount}isRightBottomCorner(e,t){return e>=this.colCount-this.rightFrozenColCount&&t>=this.rowCount-this.bottomFrozenRowCount}getColumnHeaderRange(){return{start:{col:this.rowHeaderLevelCount,row:0},end:{col:this.colCount-1,row:this.columnHeaderLevelCount-1}}}getRowHeaderRange(){return{start:{col:0,row:this.columnHeaderLevelCount},end:{col:this.rowHeaderLevelCount-1,row:this.rowCount-1}}}getCornerHeaderRange(){return{start:{col:0,row:0},end:{col:this.rowHeaderLevelCount-1,row:this.columnHeaderLevelCount-1}}}getBodyRange(){return{start:{col:this.rowHeaderLevelCount,row:this.columnHeaderLevelCount},end:{col:this.colCount-1,row:this.rowCount-1}}}resetCellIds(){}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get headerLevelCount(){return this.columnHeaderLevelCount}resetColumnHeaderLevelCount(){var e,t,i,r,o,l,s,a,n,d,h;if(this.showHeader&&this.showColumnHeader){if(this._table.isPivotChart()&&this.indicatorsAsCol&&!(!((t=(e=this.dataset)===null||e===void 0?void 0:e.colKeys)===null||t===void 0)&&t.length)&&((r=(i=this.columnDimensionTree)===null||i===void 0?void 0:i.tree)===null||r===void 0?void 0:r.level)===0&&!this.hasTwoIndicatorAxes)return void(this.columnHeaderLevelCount=0);let u=this._getColumnHeaderTreeExpandedMaxLevelCount();return this.indicatorsAsCol&&this.hideIndicatorName&&this.colDimensionKeys[this.colDimensionKeys.length-1]===this.indicatorDimensionKey&&u--,u===0&&this.dataset&&!(!((o=this.dataset.customColTree)===null||o===void 0)&&o.length)?this.cornerSetting.titleOnDimension==="row"&&this.cornerSetting.forceShowHeader?u=1:this._table.isPivotChart()||((s=(l=this.dataset.records)===null||l===void 0?void 0:l.length)!==null&&s!==void 0?s:0)!==0||this.cornerSetting.titleOnDimension!=="column"&&this.cornerSetting.titleOnDimension!=="all"||(u=(a=this.columnsDefine.length)!==null&&a!==void 0?a:0):!this.dataset||this._table.isPivotChart()||((d=(n=this.dataset.records)===null||n===void 0?void 0:n.length)!==null&&d!==void 0?d:0)!==0||this.dataset.customColTree||this.cornerSetting.titleOnDimension!=="column"&&this.cornerSetting.titleOnDimension!=="all"||(u=(h=this.columnsDefine.length)!==null&&h!==void 0?h:0,!this.hideIndicatorName&&this.indicatorsAsCol&&u++),this.columnHeaderTitle&&(u+=1),this._table.isPivotChart()&&this.indicatorsAsCol&&!this.hasTwoIndicatorAxes&&st(this.indicatorsDefine)&&(u-=1),void(this.columnHeaderLevelCount=u)}this.columnHeaderLevelCount=this.indicatorsAsCol?this.hideIndicatorName?0:1:0}resetRowHeaderLevelCount(){var e,t,i,r,o,l,s,a;if(this.showHeader&&this.showRowHeader){if(this.rowHierarchyType==="tree"){const h=(t=(e=this.extensionRows)===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0;return this.rowHeaderTitle?void(this.rowHeaderLevelCount=2+h):void(this.rowHeaderLevelCount=1+h)}const n=this._getRowHeaderTreeExpandedMaxLevelCount();let d=n;return d===0&&this.dataset&&!(!((i=this.dataset.customRowTree)===null||i===void 0)&&i.length)?this.cornerSetting.titleOnDimension==="column"&&this.cornerSetting.forceShowHeader?d=1:this._table.isPivotChart()||((o=(r=this.dataset.records)===null||r===void 0?void 0:r.length)!==null&&o!==void 0?o:0)!==0||this.cornerSetting.titleOnDimension!=="row"&&this.cornerSetting.titleOnDimension!=="all"||(d=(l=this.rowsDefine.length)!==null&&l!==void 0?l:0):!this.dataset||this._table.isPivotChart()||((a=(s=this.dataset.records)===null||s===void 0?void 0:s.length)!==null&&a!==void 0?a:0)!==0||this.dataset.customRowTree||this.cornerSetting.titleOnDimension!=="row"&&this.cornerSetting.titleOnDimension!=="all"||(d=this.rowsDefine.length,this.hideIndicatorName||this.indicatorsAsCol||d++),!this.indicatorsAsCol&&this.hideIndicatorName&&this.rowDimensionKeys[this.rowDimensionKeys.length-1]===this.indicatorDimensionKey&&(d=n-1),this.rowHeaderTitle&&(d+=1),void(this.rowHeaderLevelCount=d)}this.rowHeaderLevelCount=this.indicatorsAsCol||this.hideIndicatorName?0:1}get columnHeaderLevelCount(){return this._columnHeaderLevelCount}set columnHeaderLevelCount(e){this._columnHeaderLevelCount=e}get rowHeaderLevelCount(){return this._rowHeaderLevelCount}set rowHeaderLevelCount(e){this._rowHeaderLevelCount=e}get colCount(){var e,t,i;return(this._getColumnHeaderTreeExpandedMaxLevelCount()>0||this._table.isPivotChart()||((e=this.dataset.records)===null||e===void 0?void 0:e.length)>0||this.dataset.records&&!Array.isArray(this.dataset.records)?(i=(t=this._columnHeaderCellIds[0])===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:this.columnDimensionTree.tree.size:0)+this.rowHeaderLevelCount+this.rightHeaderColCount+this.leftRowSeriesNumberColumnCount}get rowCount(){var e,t,i,r;return((this._table.records||this.dataset.records)&&(!Array.isArray(this._table.records)||this._table.records.length>0)&&((e=this._indicators)===null||e===void 0?void 0:e.length)>0&&!(!((t=this._rowHeaderCellIds)===null||t===void 0)&&t.length)?1:(r=(i=this._rowHeaderCellIds)===null||i===void 0?void 0:i.length)!==null&&r!==void 0?r:0)+this.columnHeaderLevelCount+this.bottomHeaderRowCount}get bodyRowSpanCount(){return this.rowDimensionTree.tree.size}get bottomFrozenRowCount(){if(!this._table.isPivotChart())return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0;if(this.indicatorKeys.length>=1&&st(this.indicatorsDefine)){const e=this._table.pivotChartAxes.find(t=>t.orient==="bottom");return(e==null?void 0:e.visible)===!1?0:(this.indicatorsAsCol,1)}return 0}get rightFrozenColCount(){if(!this._table.isPivotChart())return this._table.internalProps.rightFrozenColCount?this.colCount-this.rowHeaderLevelCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:this.colCount-this.rowHeaderLevelCount:0;const e=this._table.pivotChartAxes.find(t=>t.orient==="right");return(e==null?void 0:e.visible)===!1||this.indicatorsAsCol?0:this.hasTwoIndicatorAxes?1:0}get bodyRowCount(){return this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount}get headerObjects(){return this._headerObjects}get columnObjects(){return this._indicators}getCellId(e,t){var i,r,o,l,s;if(t>=0&&e>=0){if(this.isSeriesNumber(e,t))return"";if(this.isCornerHeader(e,t))return(i=this._cornerHeaderCellIds[t])===null||i===void 0?void 0:i[e-this.leftRowSeriesNumberColumnCount];if(this.isColumnHeader(e,t))return(r=this._columnHeaderCellIds[t])===null||r===void 0?void 0:r[e-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount];if(this.isRowHeader(e,t))return(o=this._rowHeaderCellIds[t-this.columnHeaderLevelCount])===null||o===void 0?void 0:o[e-this.leftRowSeriesNumberColumnCount];if(this.isRightFrozenColumn(e,t))return(l=this._rowHeaderCellIds[t-this.columnHeaderLevelCount])===null||l===void 0?void 0:l[this.rowHeaderLevelCount-1];if(this.isBottomFrozenRow(e,t))return(s=this._columnHeaderCellIds[this.columnHeaderLevelCount-1])===null||s===void 0?void 0:s[e-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount]}}getHeader(e,t){var i;if(this.isSeriesNumberInHeader(e,t))return this.getSeriesNumberHeader(e,t);const r=this.getCellId(e,t);return(i=this._headerObjectMap[r])!==null&&i!==void 0?i:{id:void 0,field:"",headerType:"text",define:void 0}}getHeaderField(e,t){var i,r;const o=this.getCellId(e,t);return((i=this._headerObjectMap[o])===null||i===void 0?void 0:i.field)||((r=this.getBody(e,t))===null||r===void 0?void 0:r.field)}getHeaderCellAdressById(e){for(let t=0;t<this._columnHeaderCellIds.length;t++){const i=this._columnHeaderCellIds[t];for(let r=0;r<i.length;r++)if(i[r]===e)return{col:r+this._table.frozenColCount,row:t}}for(let t=0;t<this._rowHeaderCellIds.length;t++){const i=this._rowHeaderCellIds[t];for(let r=0;r<i.length;r++)if(i[r]===e)return{col:r,row:t+this._table.frozenRowCount}}for(let t=0;t<this._cornerHeaderCellIds.length;t++){const i=this._cornerHeaderCellIds[t];for(let r=0;r<i.length;r++)if(i[r]===e)return{col:r,row:t}}}getHeaderCellAddressByField(e){const t=this.headerObjects.find(i=>i&&i.field===e);return t&&this.getHeaderCellAdressById(t.id)}getBody(e,t){var i,r,o,l,s,a,n,d,h,u;const c=this.getBodyWidthCache(e,t);if(c)return c;if(this.isSeriesNumber(e,t)){const g=this.getSeriesNumberBody(e,t);return this.setBodyWidthCache(e,t,g),g}const v=this.getCellHeaderPaths(e,t);if(this.indicatorsAsCol){const g=(r=(i=v.colHeaderPaths)===null||i===void 0?void 0:i.find(w=>w.indicatorKey))===null||r===void 0?void 0:r.indicatorKey,m=O(g)&&(s=(l=(o=this._indicators)===null||o===void 0?void 0:o.find(w=>w.indicatorKey===g))!==null&&l!==void 0?l:this._indicators[0])!==null&&s!==void 0?s:{id:"",field:void 0,indicatorKey:void 0,cellType:"text",define:void 0};return this.setBodyWidthCache(e,t,m),m}const f=(n=(a=v.rowHeaderPaths)===null||a===void 0?void 0:a.find(g=>g.indicatorKey))===null||n===void 0?void 0:n.indicatorKey,H=O(f)&&(u=(h=(d=this._indicators)===null||d===void 0?void 0:d.find(g=>g.indicatorKey===f))!==null&&h!==void 0?h:this._indicators[0])!==null&&u!==void 0?u:{id:"",field:void 0,indicatorKey:void 0,cellType:"text",define:void 0};return this.setBodyWidthCache(e,t,H),H}getCellRange(e,t){var i,r;const o={start:{col:e,row:t},end:{col:e,row:t}};if(!this.isHeader(e,t)||e===-1||t===-1||this.isRightFrozenColumn(e,t)||this.isBottomFrozenRow(e,t))return o;if(this._table.isPivotChart()){if(this.isLeftBottomCorner(e,t))return{start:{col:0,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.frozenColCount-1,row:this.rowCount-1}};if(this.isRightTopCorner(e,t))return{start:{col:this.colCount-this.rightFrozenColCount,row:0},end:{col:this.colCount-1,row:this.frozenRowCount-1}};if(this.isRightBottomCorner(e,t))return{start:{col:this.colCount-this.rightFrozenColCount,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.colCount-1,row:this.rowCount-1}}}for(let l=0;l<this._largeCellRangeCache.length;l++){const s=this._largeCellRangeCache[l];if(e>=s.start.col&&e<=s.end.col&&t>=s.start.row&&t<=s.end.row)return s}if(this.isHeader(e,t)&&e!==-1&&t!==-1){const l=this.getCellId(e,t);for(let s=e-1;s>=0&&l===this.getCellId(s,t);s--)o.start.col=s;for(let s=e+1;s<((i=this.colCount)!==null&&i!==void 0?i:0)&&l===this.getCellId(s,t);s++)o.end.col=s;for(let s=t-1;s>=0&&l===this.getCellId(e,s);s--)o.start.row=s;for(let s=t+1;s<((r=this.rowCount)!==null&&r!==void 0?r:0)&&!(l!==this.getCellId(e,s)||this.isSeriesNumberInHeader(e,t)&&s>=this.columnHeaderLevelCount);s++)o.end.row=s}return(o.end.col-o.start.col>100||o.end.row-o.start.row>100)&&this._largeCellRangeCache.push(o),o}isCellRangeEqual(e,t,i,r){const o=this.getCellRange(e,t),l=this.getCellRange(i,r);return o.start.col===l.start.col&&o.end.col===l.end.col&&o.start.row===l.start.row&&o.end.row===l.end.row}getBodyIndexByRow(e){return e<this.columnHeaderLevelCount||e>=this.rowCount-this.bottomHeaderRowCount?-1:e-this.columnHeaderLevelCount}get bottomHeaderRowCount(){return this._table.isPivotChart()?this.bottomFrozenRowCount:0}get rightHeaderColCount(){return this._table.isPivotChart()?this.rightFrozenColCount:0}getBodyIndexByCol(e){return e<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount||e>=this.colCount-this.rightHeaderColCount?-1:e-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount}getRecordStartRowByRecordIndex(e){return this.columnHeaderLevelCount+e}getRecordShowIndexByCell(e,t){}getCellHeaderPathsWithTreeNode(e,t){for(let s=0;s<this._largeCellRangeCache.length;s++){const a=this._largeCellRangeCache[s];if(e>=a.start.col&&e<=a.end.col&&t>=a.start.row&&t<=a.end.row)break}let i=this.getColHeaderPathCache(e,t),r=this.getRowHeaderPathCache(e,t);const o=this.getBodyIndexByCol(e),l=this.getBodyIndexByRow(t)+this.currentPageStartIndex;if(!i&&t>=0&&o>=0){if(i=[],this.columnHierarchyType==="grid-tree"){const s=[];this._columnHeaderCellFullPathIds.map(n=>{s.push(n[o])});const a=this.getTreePathByCellIds(s);i.push(...a)}else i=this.columnDimensionTree.getTreePath(o,this.showHeader&&this.showColumnHeader?t-(this.columnHeaderTitle?1:0):this.columnDimensionTree.totalLevel);this.setColHeaderPathCache(e,t,i)}if(!r&&e>=0&&l>=0){if(r=[],this.rowHierarchyType==="tree"){const s=this._rowHeaderCellFullPathIds[l];let a=this.rowDimensionTree,n=0;for(;a;){const d=[];let h=s[n];for(d.push(h);;){const c=this._headerObjectMap[h];if(!(c!=null&&c.parentCellId))break;d.unshift(c.parentCellId),h=c.parentCellId}const u=this.getTreePathByCellIds(d);r.push(...u),a=this._rowHeaderExtensionTree[s[n]],n++}}else if(this.rowHierarchyType==="grid-tree"){const s=this._rowHeaderCellFullPathIds[l],a=this.getTreePathByCellIds(s);r.push(...a)}else r=this.rowDimensionTree.getTreePath(l,this.showHeader&&this.showRowHeader?e-(this.rowHeaderTitle?1:0)-this.leftRowSeriesNumberColumnCount:this.rowDimensionTree.totalLevel);this.setRowHeaderPathCache(e,t,r)}return{colHeaderPaths:i,rowHeaderPaths:r,cellLocation:this.getCellLocation(e,t)}}getTreePathByCellIds(e){const t=[];for(let i=0;i<e.length;i++){const r=e[i];if(i>0&&r===e[i-1])continue;const o=this._headerObjects[r];o!=null&&o.define&&t.push(o.define)}return t}getCellHeaderPaths(e,t){var i,r;const o=this.getCellHeaderPathsWithTreeNode(e,t),l={colHeaderPaths:[],rowHeaderPaths:[],cellLocation:o.cellLocation};return(i=o.colHeaderPaths)===null||i===void 0||i.forEach(s=>{var a,n,d;const h={};h.dimensionKey=s.dimensionKey,h.indicatorKey=s.indicatorKey,h.value=(d=(a=s.value)!==null&&a!==void 0?a:(n=this.getIndicatorInfoByIndicatorKey(s.indicatorKey))===null||n===void 0?void 0:n.title)!==null&&d!==void 0?d:"",h.virtual=s.virtual,l.colHeaderPaths.push(h)}),(r=o.rowHeaderPaths)===null||r===void 0||r.forEach(s=>{var a,n,d;if(s.dimensionKey!=="axis"){const h={};h.dimensionKey=s.dimensionKey,h.indicatorKey=s.indicatorKey,h.value=(d=(a=s.value)!==null&&a!==void 0?a:(n=this.getIndicatorInfoByIndicatorKey(s.indicatorKey))===null||n===void 0?void 0:n.title)!==null&&d!==void 0?d:"",h.virtual=s.virtual,l.rowHeaderPaths.push(h)}}),l}getIndicatorInfoByIndicatorKey(e){var t;return(t=this.indicatorsDefine)===null||t===void 0?void 0:t.find(i=>typeof i!="string"&&!!e&&i.indicatorKey===e)}findFullCellIds(e){const t=[];for(let i=0;i<e.length;i++){let r=e[i];for(t.push(r);;){const o=this._headerObjectMap[r];if(!(o!=null&&o.parentCellId))break;t.unshift(o.parentCellId),r=o.parentCellId}}return t}getHeaderDimension(e,t){var i,r,o;if(this.isHeader(e,t)){const l=this.getHeader(e,t);return(r=(i=this.rowsDefine)===null||i===void 0?void 0:i.find(s=>typeof s!="string"&&s.dimensionKey===l.field))!==null&&r!==void 0?r:(o=this.columnsDefine)===null||o===void 0?void 0:o.find(s=>typeof s!="string"&&s.dimensionKey===l.field)}}isColumnIndicatorHeader(e,t){return this._indicatorShowType==="column"&&t===this.columnHeaderLevelCount-1&&e>=this.rowHeaderLevelCount}isRowIndicatorHeader(e,t){return this._indicatorShowType==="row"&&e===this.rowHeaderLevelCount-1&&t>=this.columnHeaderLevelCount}isIndicatorHeader(e,t){return this.isColumnIndicatorHeader(e,t)||this.isRowIndicatorHeader(e,t)}toggleHierarchyState(e,t){var i,r,o,l,s,a;this.colIndex=0;const n=(this.indicatorsAsCol?this.rowHeaderLevelCount-1:this.rowHeaderLevelCount-2)-this.leftRowSeriesNumberColumnCount,d=this._rowHeaderCellFullPathIds_FULL.slice(0),h=d.map((v,f)=>({col:e,row:f+this.columnHeaderLevelCount})),u=this.getHeader(e,t);if(u.define.hierarchyState=u.define.hierarchyState===Ee.collapse?Ee.expand:Ee.collapse,this.rowDimensionTree.reset(this.rowDimensionTree.tree.children),this.resetRowHeaderLevelCount(),this._rowHeaderCellFullPathIds_FULL=[],this.rowDimensionKeys=this.rowDimensionTree.dimensionKeysIncludeVirtual.valueArr(),this.fullRowDimensionKeys=[],this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(this.rowDimensionKeys),this.rowHierarchyType==="tree"?this._addHeadersForTreeMode(this._rowHeaderCellFullPathIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,!0,this.rowsDefine,this.rowHeaderObjs):this.rowHierarchyType==="grid-tree"&&(this._addHeadersForGridTreeMode(this._rowHeaderCellFullPathIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,this._getRowHeaderTreeExpandedMaxLevelCount(),!0,this.rowsDefine,this.rowHeaderObjs,!0),this.cornerHeaderObjs=this._addCornerHeaders(this.colDimensionKeys,this.rowDimensionKeys,this.columnsDefine.concat(...this.rowsDefine))),this.rowHeaderTitle){const v=++this.sharedVar.seqId,f=Array(this.rowCount-this.columnHeaderLevelCount).fill(v);this._rowHeaderCellFullPathIds_FULL.unshift(f);const H={id:v,title:typeof this.rowHeaderTitle.title=="string"?this.rowHeaderTitle.title:this.rowsDefine.reduce((g,m)=>typeof m=="string"?g:g+(g?`/${m.title}`:`${m.title}`),""),field:void 0,headerType:(r=(i=this.rowHeaderTitle)===null||i===void 0?void 0:i.headerType)!==null&&r!==void 0?r:"text",style:(o=this.rowHeaderTitle)===null||o===void 0?void 0:o.headerStyle,define:{field:"",headerType:"text",cellType:"text",disableHeaderHover:!!(!((l=this.rowHeaderTitle)===null||l===void 0)&&l.disableHeaderHover),disableHeaderSelect:!!(!((s=this.rowHeaderTitle)===null||s===void 0)&&s.disableHeaderSelect)}};this.rowHeaderObjs.push(H),this._headerObjects[v]=H}let c;if(this._rowHeaderCellFullPathIds_FULL=Ct(this._rowHeaderCellFullPathIds_FULL),this.rowHierarchyType==="tree"&&((a=this.extensionRows)===null||a===void 0?void 0:a.length)>=1&&this.generateExtensionRowTree(),this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce((v,f)=>(v[f.id]=f,v),{}),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,this.rowHierarchyType==="tree")c=no(e,t,d.map(v=>v[e-this.leftRowSeriesNumberColumnCount]),this._rowHeaderCellFullPathIds_FULL.map(v=>v[e-this.leftRowSeriesNumberColumnCount]),h,this);else{const v=(this.indicatorsAsCol?this.rowHeaderLevelCount-1:this.rowHeaderLevelCount-2)-this.leftRowSeriesNumberColumnCount;c=ao(e,t,d.map(f=>f[n]),this._rowHeaderCellFullPathIds_FULL.map(f=>f[v]),h,this)}return this.generateCellIdsConsiderHideHeader(),this.setPagination(this.pagination),this.rowHierarchyType==="grid-tree"&&this.setColumnWidths(),c}toggleHierarchyStateForColumnTree(e,t){var i,r,o,l,s;this.colIndex=0;const a=this.indicatorsAsCol?this.columnHeaderLevelCount-2:this.columnHeaderLevelCount-1,n=this._columnHeaderCellFullPathIds.slice(0),d=n[this.columnHeaderLevelCount-1].map((v,f)=>({col:f+this.rowHeaderLevelCount,row:t})),h=this.getHeader(e,t);if(h.define.hierarchyState=h.define.hierarchyState===Ee.collapse?Ee.expand:Ee.collapse,this.columnDimensionTree.reset(this.columnDimensionTree.tree.children),this.resetColumnHeaderLevelCount(),this._columnHeaderCellFullPathIds=[],this.colDimensionKeys=this.columnDimensionTree.dimensionKeysIncludeVirtual.valueArr(),this.columnHierarchyType==="grid-tree"&&(this._addHeadersForGridTreeMode(this._columnHeaderCellFullPathIds,0,this.columnDimensionTree.tree.children,[],this.columnDimensionTree.totalLevel,this._getColumnHeaderTreeExpandedMaxLevelCount(),!0,this.columnsDefine,this.columnHeaderObjs,!1),this.cornerHeaderObjs=this._addCornerHeaders(this.colDimensionKeys,this.rowDimensionKeys,this.columnsDefine.concat(...this.rowsDefine))),this.columnHeaderTitle){const v=++this.sharedVar.seqId,f=Array(this.colCount-this.rowHeaderLevelCount-this.rightFrozenColCount).fill(v);this._columnHeaderCellFullPathIds.unshift(f);const H={id:v,title:typeof this.columnHeaderTitle.title=="string"?this.columnHeaderTitle.title:this.columnsDefine.reduce((g,m)=>typeof m=="string"?g:g+(g?`/${m.title}`:`${m.title}`),""),field:void 0,headerType:(r=(i=this.columnHeaderTitle)===null||i===void 0?void 0:i.headerType)!==null&&r!==void 0?r:"text",style:(o=this.columnHeaderTitle)===null||o===void 0?void 0:o.headerStyle,define:{id:v,disableHeaderHover:!!(!((l=this.columnHeaderTitle)===null||l===void 0)&&l.disableHeaderHover),disableHeaderSelect:!!(!((s=this.columnHeaderTitle)===null||s===void 0)&&s.disableHeaderSelect)}};this.columnHeaderObjs.push(H),this._headerObjects[v]=H}this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce((v,f)=>(v[f.id]=f,v),{}),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0;const u=this.indicatorsAsCol?this.columnHeaderLevelCount-2:this.columnHeaderLevelCount-1,c=ho(e,t,n[a],this._columnHeaderCellFullPathIds[u],d,this);return this.generateCellIdsConsiderHideHeader(),this.columnHierarchyType==="grid-tree"&&this.setColumnWidths(),c}isHeaderForColWidth(e,t){return this.isHeader(e,t)}getHeaderForColWidth(e,t){return this.getHeader(e,t)}getPivotCellAdress(e){var t;if(!Array.isArray(e))return;let i,r,o=this.rowTree,l=this.columnTree;for(let n=0;n<e.length;n++){const d=e[n];if((d.isPivotCorner||!O(d.value))&&n===e.length-1){if(((t=this==null?void 0:this.cornerSetting)===null||t===void 0?void 0:t.titleOnDimension)==="row"){let c=0;return this.rowHierarchyType==="grid"&&(c=this.rowDimensionKeys.indexOf(d.dimensionKey)),c===-1?void 0:{col:(this.rowHeaderTitle?c+1:c)+this.leftRowSeriesNumberColumnCount,row:0}}const u=this.colDimensionKeys.indexOf(d.dimensionKey);return u===-1?void 0:{col:0+this.leftRowSeriesNumberColumnCount,row:this.columnHeaderTitle?u+1:u}}let h=!1;for(let u=0;u<l.length;u++){const c=l[u];if((O(d.dimensionKey)&&c.dimensionKey===d.dimensionKey||O(d.indicatorKey)&&c.indicatorKey===d.indicatorKey)&&c.value===d.value){l=c.children,r=c,h=!0;break}}if(!h)for(let u=0;u<o.length;u++){const c=o[u];if((O(d.dimensionKey)&&c.dimensionKey===d.dimensionKey||O(d.indicatorKey)&&c.indicatorKey===d.indicatorKey)&&c.value===d.value){o=c.children,i=c;break}}}let s=0,a=0;if(i){a=this.columnHeaderLevelCount;const{startInTotal:n,afterSpanLevel:d}=i;return a+=n,s=this.rowHierarchyType==="grid"?(this.rowHeaderTitle?d+1:d)+this.leftRowSeriesNumberColumnCount:0+this.leftRowSeriesNumberColumnCount,{col:s,row:a}}if(r){s=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount;const{startInTotal:n,afterSpanLevel:d}=r;return s+=n,a=this.columnHeaderTitle?d+1:d,{col:s,row:a}}}getPivotDimensionInfo(e,t){var i;const{colHeaderPaths:r,rowHeaderPaths:o}=this.getCellHeaderPaths(e,t),l=[];return r.length?r.forEach((s,a)=>{l.push({dimensionKey:s.dimensionKey,value:s.value,isPivotCorner:!1,indicatorKey:s.indicatorKey})}):o.length?o.forEach((s,a)=>{l.push({dimensionKey:s.dimensionKey,value:s.value,isPivotCorner:!1,indicatorKey:s.indicatorKey})}):this.isCornerHeader(e,t)&&(((i=this==null?void 0:this.cornerSetting)===null||i===void 0?void 0:i.titleOnDimension)==="row"?l.push({dimensionKey:this.rowDimensionKeys[(this.rowHeaderTitle?e-1:e)-this.leftRowSeriesNumberColumnCount],isPivotCorner:!0}):l.push({dimensionKey:this.colDimensionKeys[this.columnHeaderTitle?t-1:t],isPivotCorner:!0})),l}getIndicatorKey(e,t){var i;return(i=this.getBody(e,t))===null||i===void 0?void 0:i.indicatorKey}getParentCellId(e,t){if(t!==0)return this.isColumnHeader(e,t)?this.getCellId(e,t-1):this.isRowHeader(e,t)?this.getCellId(e-1,t):void 0}getRowHeaderCellAddressByCellId(e){let t,i;if(this._rowHeaderCellIds.find((r,o)=>!!r.find((l,s)=>l===e&&(t=s,!0))&&(i=o,!0)),O(t)&&O(i))return{col:t,row:i+this.columnHeaderLevelCount}}canMoveHeaderPosition(e,t){if(this.isSeriesNumberInHeader(t.col,t.row)||this.isSeriesNumberInHeader(e.col,e.row)||this.isCornerHeader(t.col,t.row)||e.col<0||e.row<0||t.col<0||t.row<0)return!1;this.isSeriesNumberInBody(t.col,t.row)&&this.isSeriesNumberInBody(e.col,e.row)&&(e.col=e.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1,t.col=t.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1);const i=this.getCellRange(e.col,e.row);if(this.isColumnHeader(e.col,e.row))return this.getParentCellId(e.col,i.start.row)===this.getParentCellId(t.col,i.start.row);if(this.isRowHeader(e.col,e.row)){if(this.rowHierarchyType!=="tree")return this.getParentCellId(i.start.col,e.row)===this.getParentCellId(i.start.col,t.row);{const r=Ce(this.getCellHeaderPathsWithTreeNode(e.col,e.row).rowHeaderPaths),o=Ce(this.getCellHeaderPathsWithTreeNode(t.col,t.row).rowHeaderPaths);if(r.pop(),o.pop(),r.length<=o.length){if(r.length===o.length)return!r.find((l,s)=>l.dimensionKey!==o[s].dimensionKey||l.value!==o[s].value);if(r.length>0){for(let l=0;l<r.length;l++)if(r[l].startInTotal!==o[l].startInTotal)return!1}return!0}}}return!1}moveHeaderPosition(e,t){if(this.canMoveHeaderPosition(e,t)&&!this.isCellRangeEqual(e.col,e.row,t.col,t.row)){const i=this.getCellRange(e.col,e.row);if(this.isColumnHeader(e.col,e.row)){const r=i.end.col-i.start.col+1;let o;const l=this.getCellRange(t.col,i.start.row);if(o=t.col>=e.col?l.end.col-r+1:l.start.col,o===i.start.col)return null;for(let a=0;a<this._columnHeaderCellFullPathIds.length;a++){const n=this._columnHeaderCellFullPathIds[a].splice(i.start.col-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount,r);n.unshift(o-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columnHeaderCellFullPathIds[a],n)}const s=this._columnWidths.splice(i.start.col-this.leftRowSeriesNumberColumnCount,r);return s.unshift(o-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columnWidths,s),this.columnDimensionTree.movePosition(this.getCellHeaderPathsWithTreeNode(e.col,e.row).colHeaderPaths.length-1,i.start.col-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount,l.start.col-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount),this.columnDimensionTree.reset(this.columnDimensionTree.tree.children),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,{sourceIndex:i.start.col,targetIndex:o,sourceSize:r,targetSize:l.end.col-l.start.col+1,moveType:"column"}}if(this.isRowHeader(e.col,e.row)){let r;const o=this.getCellHeaderPathsWithTreeNode(e.col,e.row).rowHeaderPaths,l=this.getCellHeaderPathsWithTreeNode(t.col,t.row).rowHeaderPaths,s=o[o.length-1],a=l[o.length-1],n=s.size;if(r=t.row>=e.row?a.startInTotal+a.size-n:a.startInTotal,r===i.start.row-this.columnHeaderLevelCount)return null;const d=this._rowHeaderCellIds.splice(i.start.row-this.columnHeaderLevelCount,n);d.unshift(r-this.currentPageStartIndex,0),Array.prototype.splice.apply(this._rowHeaderCellIds,d);const h=this._rowHeaderCellFullPathIds.splice(i.start.row-this.columnHeaderLevelCount,n);h.unshift(r-this.currentPageStartIndex,0),Array.prototype.splice.apply(this._rowHeaderCellFullPathIds,h);const u=this._rowHeaderCellIds_FULL.splice(i.start.row-this.columnHeaderLevelCount+this.currentPageStartIndex,n);u.unshift(r,0),Array.prototype.splice.apply(this._rowHeaderCellIds_FULL,u);const c=this._rowHeaderCellFullPathIds_FULL.splice(i.start.row-this.columnHeaderLevelCount+this.currentPageStartIndex,n);return c.unshift(r,0),Array.prototype.splice.apply(this._rowHeaderCellFullPathIds_FULL,c),this.rowDimensionTree.movePosition(o.length-1,i.start.row-this.columnHeaderLevelCount,r+(t.row>e.row?s.size-1:0)),this.rowDimensionTree.reset(this.rowDimensionTree.tree.children),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,{sourceIndex:i.start.row,targetIndex:r+this.columnHeaderLevelCount,sourceSize:n,targetSize:a.size,moveType:"row"}}}return null}getCellAdressByHeaderPath(e){var t,i,r,o,l,s;let a,n,d=!1,h=!1;if(Array.isArray(e)){if(e.length>this.rowDimensionKeys.length+this.colDimensionKeys.length)return;a=e.filter(_=>this.colDimensionKeys.indexOf(_.dimensionKey)>=0||this.colDimensionKeys.indexOf(this.indicatorDimensionKey)>=0&&_.indicatorKey),n=e.filter(_=>this.rowDimensionKeys.indexOf(_.dimensionKey)>=0||this.rowDimensionKeys.indexOf(this.indicatorDimensionKey)>=0&&_.indicatorKey)}else a=e.colHeaderPaths,n=e.rowHeaderPaths,(e==null?void 0:e.cellLocation)==="body"&&this._table.isPivotTable()&&(h=!0);if(!Array.isArray(a)&&!Array.isArray(n))return;if(a==null||a.sort((_,p)=>{var S,P;return this.colDimensionKeys.indexOf((S=_.dimensionKey)!==null&&S!==void 0?S:this.indicatorDimensionKey)-this.colDimensionKeys.indexOf((P=p.dimensionKey)!==null&&P!==void 0?P:this.indicatorDimensionKey)}),n==null||n.sort((_,p)=>{var S,P;return this.fullRowDimensionKeys.indexOf((S=_.dimensionKey)!==null&&S!==void 0?S:this.indicatorDimensionKey)-this.fullRowDimensionKeys.indexOf((P=p.dimensionKey)!==null&&P!==void 0?P:this.indicatorDimensionKey)}),a==null||a.forEach(_=>{_.isPivotCorner&&(d=!0)}),n==null||n.forEach(_=>{_.isPivotCorner&&(d=!0)}),d){if(this.cornerSetting.titleOnDimension==="all"&&this.indicatorsAsCol&&a.length===0){for(let _=0;_<this.rowDimensionKeys.length;_++)if(((t=n[0])===null||t===void 0?void 0:t.dimensionKey)===this.rowDimensionKeys[_])return{col:_+this.leftRowSeriesNumberColumnCount,row:this.columnHeaderLevelCount-1}}else if(this.cornerSetting.titleOnDimension!=="all"||this.indicatorsAsCol||n.length!==0){if(this.cornerSetting.titleOnDimension==="row"||this.cornerSetting.titleOnDimension==="all"&&!this.indicatorsAsCol){for(let _=0;_<this.rowDimensionKeys.length;_++)if(((r=n[0])===null||r===void 0?void 0:r.dimensionKey)===this.rowDimensionKeys[_])return{col:_+this.leftRowSeriesNumberColumnCount,row:0}}else for(let _=0;_<this.colDimensionKeys.length;_++)if(((o=a[0])===null||o===void 0?void 0:o.dimensionKey)===this.colDimensionKeys[_])return{col:0,row:_}}else for(let _=0;_<this.colDimensionKeys.length;_++)if(((i=a[0])===null||i===void 0?void 0:i.dimensionKey)===this.colDimensionKeys[_])return{col:this.rowHeaderLevelCount-1,row:_}}let u,c,v,f,H=!1;(a==null?void 0:a.length)>=1&&(n==null?void 0:n.length)>=1&&(H=!0);let g,m,w=this.rowTree,C=this.columnTree;if(a)for(let _=0;_<a.length;_++){const p=a[_];for(let S=0;S<C.length;S++){const P=C[S];if(!O(p.indicatorKey)&&P.dimensionKey===p.dimensionKey&&P.value===p.value||O(p.indicatorKey)&&P.indicatorKey===p.indicatorKey&&(O(P.value)&&O(p.value)&&p.value===P.value||!O(P.value)||!O(p.value))){C=P.children,H&&!C?m=P:H||(m=P);break}}}if((n==null?void 0:n.length)>=1)if(this.rowHierarchyType==="tree"){const _=n[n.length-1],p=this.headerObjects.filter(P=>((P==null?void 0:P.field)===_.dimensionKey||(P==null?void 0:P.field)===_.indicatorKey)&&(P==null?void 0:P.title)===_.value).map(P=>P.id),S=this._rowHeaderCellIds.filter(P=>p.indexOf(P[P.length-1])>=0).find(P=>{const y=this.findFullCellIds(P);return y.length===n.length&&y.every(I=>{const T=this._headerObjectMap[I];return n.find(b=>b.dimensionKey===T.field&&b.value===T.title)})});c=this._rowHeaderCellIds.indexOf(S)+this.columnHeaderLevelCount}else for(let _=0;_<n.length;_++){const p=n[_];for(let S=0;S<w.length;S++){const P=w[S];if(!O(p.indicatorKey)&&P.dimensionKey===p.dimensionKey&&P.value===p.value||O(p.indicatorKey)&&P.indicatorKey===p.indicatorKey&&(!O(p.value)||P.value===p.value)){w=P.children,(!H||w&&!w.some(y=>y.dimensionKey==="axis"))&&H||(g=P);break}}}if(h||!H||(g||O(c))&&m){if(g||h){c=this.columnHeaderLevelCount;const{startInTotal:_,afterSpanLevel:p}=(l=g)!==null&&l!==void 0?l:kt;c+=_??0,v=this.rowHierarchyType==="grid"?(this.rowHeaderTitle?p+1:p)+this.leftRowSeriesNumberColumnCount:0}if(m||h){u=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount;const{startInTotal:_,afterSpanLevel:p}=(s=m)!==null&&s!==void 0?s:kt;u+=_??0,f=this.columnHeaderTitle?p+1:p}return O(u)||O(c)?{col:u??v,row:c??f}:void 0}}setChartInstance(e,t,i){var r,o,l,s;const a=this.getCellHeaderPaths(e,t);let n;if(this.indicatorsAsCol){const d=(r=a.colHeaderPaths.find(h=>h.indicatorKey))===null||r===void 0?void 0:r.indicatorKey;n=(o=this._indicators)===null||o===void 0?void 0:o.find(h=>h.indicatorKey===d)}else{const d=(l=a.rowHeaderPaths.find(h=>h.indicatorKey))===null||l===void 0?void 0:l.indicatorKey;n=(s=this._indicators)===null||s===void 0?void 0:s.find(h=>h.indicatorKey===d)}typeof(n==null?void 0:n.chartSpec)!="function"&&n&&(n.chartInstance=i)}getChartInstance(e,t){var i,r,o,l;const s=this.getCellHeaderPaths(e,t);let a;if(this.indicatorsAsCol){const n=(i=s.colHeaderPaths.find(d=>d.indicatorKey))===null||i===void 0?void 0:i.indicatorKey;a=(r=this._indicators)===null||r===void 0?void 0:r.find(d=>d.indicatorKey===n)}else{const n=(o=s.rowHeaderPaths.find(d=>d.indicatorKey))===null||o===void 0?void 0:o.indicatorKey;a=(l=this._indicators)===null||l===void 0?void 0:l.find(d=>d.indicatorKey===n)}return a==null?void 0:a.chartInstance}checkHasChart(){return Ri(this)}getDimension(e,t){var i,r;return t==="column"?(i=this.columnsDefine)===null||i===void 0?void 0:i.find(o=>typeof o!="string"&&o.dimensionKey===e):t==="row"?(r=this.rowsDefine)===null||r===void 0?void 0:r.find(o=>typeof o!="string"&&o.dimensionKey===e):void 0}getAxisConfigInPivotChart(e,t){if((this.isFrozenColumn(e,t)||this.isRightFrozenColumn(e,t))&&Xe(e,t,"row",this)||(this.isFrozenRow(e,t)||this.isBottomFrozenRow(e,t))&&Xe(e,t,"col",this)){const i=Oe.getFunction("getAxisConfigInPivotChart")(e,t,this);return(i==null?void 0:i.visible)===!1?void 0:i}}isEmpty(e,t){return!!this._table.isPivotChart()&&(!!this.isLeftBottomCorner(e,t)||!!this.isRightBottomCorner(e,t)||!!this.isRightTopCorner(e,t))}isAxisCell(e,t){return this._table.isPivotChart()?!!(this.indicatorKeys.length>=1&&st(this.indicatorsDefine)&&(this.isBottomFrozenRow(e,t)&&Xe(e,t,"col",this)||this.isRightFrozenColumn(e,t)&&Xe(e,t,"row",this)||this.isRowHeader(e,t)&&e===this.rowHeaderLevelCount-1&&Xe(e,t,"row",this)||this.hasTwoIndicatorAxes&&this.indicatorsAsCol&&t===this.columnHeaderLevelCount-1&&Xe(e,t,"col",this))):!1}getChartAxes(e,t){if(Di(e,t,this)||this.isAxisCell(e,t))return Fi(e,t,this)}getRawChartSpec(e,t){return Li(e,t,this)}getChartSpec(e,t){return Ai(e,t,this)}isShareChartSpec(e,t){return xi(e,t,this)}getChartDataId(e,t){return Ki(e,t,this)}isNoChartDataRenderNothing(e,t){return Mi(e,t,this)}setPagination(e){var t,i,r,o,l,s,a;if(this.clearCellRangeMap(),this._table.internalProps.useOneRowHeightFillAll=!1,this.pagination=e,this.rowHierarchyType==="grid"&&O((t=this.pagination)===null||t===void 0?void 0:t.perPageCount)&&O((i=this.pagination)===null||i===void 0?void 0:i.currentPage)){this.indicatorsAsCol===!1&&(this.pagination.perPageCount=Math.ceil(this.pagination.perPageCount/this.indicatorKeys.length)*this.indicatorKeys.length);const{perPageCount:n,currentPage:d}=this.pagination;this.currentPageStartIndex=n*(d||0),this.currentPageEndIndex=this.currentPageStartIndex+n,this._rowHeaderCellIds=(r=this._rowHeaderCellIds_FULL)===null||r===void 0?void 0:r.slice(this.currentPageStartIndex,this.currentPageEndIndex),this._rowHeaderCellFullPathIds=(o=this._rowHeaderCellFullPathIds_FULL)===null||o===void 0?void 0:o.slice(this.currentPageStartIndex,this.currentPageEndIndex)}else this.currentPageStartIndex=0,this.currentPageEndIndex=this._rowHeaderCellIds_FULL.length,this._rowHeaderCellIds=(l=this._rowHeaderCellIds_FULL)===null||l===void 0?void 0:l.slice(this.currentPageStartIndex,this.currentPageEndIndex),this._rowHeaderCellFullPathIds=(s=this._rowHeaderCellFullPathIds_FULL)===null||s===void 0?void 0:s.slice(this.currentPageStartIndex,this.currentPageEndIndex);this.pagination&&(this.pagination.totalCount=(a=this._rowHeaderCellIds_FULL)===null||a===void 0?void 0:a.length)}release(){var e;const t=this._table._getActiveChartInstance();t==null||t.release(),(e=this._indicators)===null||e===void 0||e.forEach(i=>{var r;(r=i.chartInstance)===null||r===void 0||r.release()})}getHeadNode(e,t){var i,r,o;let l;const s=this.getCellHeaderPaths(e,t);return s.rowHeaderPaths&&((r=(i=s.rowHeaderPaths)===null||i===void 0?void 0:i.length)!==null&&r!==void 0?r:0)>0?l=(o=s.rowHeaderPaths)===null||o===void 0?void 0:o.slice(0,s.rowHeaderPaths.length):s.colHeaderPaths&&s.colHeaderPaths.length>0&&(l=s.colHeaderPaths.slice(0,s.colHeaderPaths.length)),this.getHeadNodeByRowOrColDimensions(l,e,t)}getHeadNodeByRowOrColDimensions(e,t,i){var r;if(!Array.isArray(e))return;let o,l,s=this.rowTree,a=this.columnTree;if(O(i)&&O(t)&&this.rowHierarchyType==="tree"&&this.extensionRows&&t>=1+this.leftRowSeriesNumberColumnCount){const n=this.getCellId(t-1,i);s=this._rowHeaderExtensionTree[n].tree.children}for(let n=0;n<e.length;n++){const d=e[n];if((d.isPivotCorner||!O(d.value))&&n===e.length-1)return;let h=!1;for(let u=0;u<a.length;u++){const c=a[u];if(O(d.dimensionKey)&&c.dimensionKey===d.dimensionKey&&c.value===d.value||O(d.indicatorKey)&&c.indicatorKey===d.indicatorKey&&(c.value===d.value||!O(d.value)||!O(c.value))){a=c.children,l=c,h=!0;break}}if(!h)for(let u=0;(r=u<(s==null?void 0:s.length))!==null&&r!==void 0&&r;u++){const c=s[u];if(O(d.dimensionKey)&&c.dimensionKey===d.dimensionKey&&c.value===d.value||O(d.indicatorKey)&&c.indicatorKey===d.indicatorKey&&(c.value===d.value||!O(d.value)||!O(c.value))){s=c.children,o=c;break}}}return o||l||void 0}clearCellRangeMap(){this._largeCellRangeCache.length=0,this._CellHeaderPathMap=new Map}getDimensionKeyInChartSpec(e,t){var i,r,o,l,s,a;let n;if(this.indicatorsAsCol===!1)for(let d=0;d<this.indicatorsDefine.length;d++){const h=this.indicatorsDefine[d].chartSpec;if(h&&(n=(i=h.xField)!==null&&i!==void 0?i:(o=(r=h==null?void 0:h.series)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.xField,n))return n}else for(let d=0;d<this.indicatorsDefine.length;d++){const h=this.indicatorsDefine[d].chartSpec;if(h&&(n=(l=h.yField)!==null&&l!==void 0?l:(a=(s=h==null?void 0:h.series)===null||s===void 0?void 0:s[0])===null||a===void 0?void 0:a.yField,n))return n}return null}_generateChartState(){return{vtable_selected:{filter:e=>{var t;return this._table._selectedDataItemsInChart.length>=1?!!this._table._selectedDataItemsInChart.find(i=>{for(const r in i)if(typeof i[r]!="object"&&i[r]!==e[r])return!1;return!0}):!((t=this._table._selectedDimensionInChart)===null||t===void 0)&&t.length?!!this._table._selectedDimensionInChart.every(i=>typeof i.value=="object"||e[i.key]===i.value):!1}},vtable_selected_reverse:{filter:e=>{var t;return this._table._selectedDataItemsInChart.length>=1?!this._table._selectedDataItemsInChart.find(i=>{for(const r in i)if(typeof i[r]!="object"&&i[r]!==e[r])return!1;return!0}):!((t=this._table._selectedDimensionInChart)===null||t===void 0)&&t.length?!this._table._selectedDimensionInChart.every(i=>typeof i.value=="object"||e[i.key]===i.value):!1}}}}updateDataStateToChartInstance(e){var t;if(((t=e==null?void 0:e.getSpec().select)===null||t===void 0?void 0:t.enable)!==!1){e||(e=this._table._getActiveChartInstance());const i=this._generateChartState();this._indicators.forEach(r=>{var o;const l=r.chartInstance;((o=r.chartSpec.select)===null||o===void 0?void 0:o.enable)!==!1&&l.updateState(i)}),e==null||e.updateState(i)}}updateDataStateToActiveChartInstance(e){var t;if(((t=e==null?void 0:e.getSpec().select)===null||t===void 0?void 0:t.enable)!==!1){e||(e=this._table._getActiveChartInstance());const i=this._generateChartState();e==null||e.updateState(i)}}getIndicatorKeyInChartSpec(e,t){const i=this.getRawChartSpec(e,t),r=[];if(i){if(i.series||i.xField||i.yField)return this.indicatorsAsCol===!1?i.series?i.series.forEach(o=>{const l=o.yField;r.push(l)}):r.push(i.yField):i.series?i.series.forEach(o=>{const l=o.xField;r.push(l)}):r.push(i.xField),r;if(i.valueField&&r.push(i.valueField),r.length>=1)return r}return null}getOptimunHeightForChart(e){var t,i,r,o,l;const s=this.getCellHeaderPaths(this.rowHeaderLevelCount,e).rowHeaderPaths;let a,n;for(const h in this.dataset.collectValuesBy)if(this.dataset.collectValuesBy[h].type==="yField"&&!this.dataset.collectValuesBy[h].range){a=(t=this.dataset.collectedValues[h])===null||t===void 0?void 0:t[s.map(u=>u.value).join(this.dataset.stringJoinChar)];break}if(this._chartItemBandSize)n=jt((i=a==null?void 0:a.length)!==null&&i!==void 0?i:0,this._chartItemBandSize,this._chartPaddingInner,this._chartPaddingOuter);else{const h=this._chartItemSpanSize||25;n=((r=a==null?void 0:a.length)!==null&&r!==void 0?r:0)*(h+h/3)}const d=Mt((l=(o=this._chartPadding)!==null&&o!==void 0?o:this._table.theme.bodyStyle.padding)!==null&&l!==void 0?l:0);return n+d[0]+d[2]}getOptimunWidthForChart(e){var t,i,r,o,l;const s=this.getCellHeaderPaths(e,this.columnHeaderLevelCount).colHeaderPaths;let a,n;for(const h in this.dataset.collectValuesBy)if(this.dataset.collectValuesBy[h].type==="xField"&&!this.dataset.collectValuesBy[h].range){a=(t=this.dataset.collectedValues[h])===null||t===void 0?void 0:t[s.map(u=>u.value).join(this.dataset.stringJoinChar)];break}if(this._chartItemBandSize)n=jt((i=a==null?void 0:a.length)!==null&&i!==void 0?i:0,this._chartItemBandSize,this._chartPaddingInner,this._chartPaddingOuter);else{const h=this._chartItemSpanSize||25;n=((r=a==null?void 0:a.length)!==null&&r!==void 0?r:0)*(h+h/3)}const d=Mt((l=(o=this._chartPadding)!==null&&o!==void 0?o:this._table.theme.bodyStyle.padding)!==null&&l!==void 0?l:0);return n+d[1]+d[3]}get leftAxesCount(){if(!this._table.isPivotChart())return 0;const e=this._table.pivotChartAxes.find(t=>t.orient==="left");return(e==null?void 0:e.visible)===!1?0:(this.indicatorsAsCol,1)}get topAxesCount(){if(!this._table.isPivotChart())return 0;const e=this._table.pivotChartAxes.find(t=>t.orient==="top");return(e==null?void 0:e.visible)===!1?0:this.indicatorsAsCol&&this.hasTwoIndicatorAxes?1:0}get rightAxesCount(){return this.rightFrozenColCount}get bottomAxesCount(){return this.bottomFrozenRowCount}getColKeysPath(e,t){const i=this.getCellHeaderPaths(e,t),r=[];return i.colHeaderPaths.length&&i.colHeaderPaths.forEach(o=>{o.dimensionKey&&r.push(o.value)}),r==null?void 0:r.join(this.dataset.stringJoinChar)}getRowKeysPath(e,t){const i=this.getCellHeaderPaths(e,t),r=[];return i.rowHeaderPaths.length&&i.rowHeaderPaths.forEach(o=>{o.dimensionKey&&r.push(o.value)}),r==null?void 0:r.join(this.dataset.stringJoinChar)}getIndicatorInfo(e,t=""){var i;return(i=this.indicatorsDefine)===null||i===void 0?void 0:i.find(r=>typeof r!="string"&&(e?r.indicatorKey===e:!!t&&r.title===t))}getLayoutColumnTree(){const e=[],t=this.columnDimensionTree.tree.children;return Et(e,t),e}getLayoutRowTree(){const e=[],t=this.rowDimensionTree.tree.children;return Et(e,t),e}getLayoutColumnTreeCount(){const e=this.columnDimensionTree.tree.children;return ft(e,this.rowHierarchyType==="tree")}getLayoutRowTreeCount(){var e;const t=this.rowDimensionTree.tree.children;let i=ft(t,this.rowHierarchyType==="tree");return(e=this.extensionRows)===null||e===void 0||e.forEach(r=>{if(typeof r.rowTree!="function"){const o=ft(r.rowTree,!0);i*=o}}),i}resetHeaderTree(){var e,t,i;this.colIndex=0,this._rowHeaderCellFullPathIds_FULL=[],this._columnHeaderCellFullPathIds=[],this._columnHeaderCellIds=[];const r=this.dataset;this.rowTree=r.rowHeaderTree,this.columnTree=r.colHeaderTree;const o=this.rowDimensionTree.tree.children;(e=this.rowTree)===null||e===void 0||e.forEach((l,s)=>{const a=o.find(n=>n.dimensionKey===l.dimensionKey&&n.value===l.value);a&&this._table._syncHierarchyState(a,l)}),this.columnDimensionTree=new ge((t=this.columnTree)!==null&&t!==void 0?t:[],this.sharedVar,this.columnHierarchyType,this.columnHierarchyType!=="grid"?this.columnExpandLevel:void 0),this.rowDimensionTree=new ge((i=this.rowTree)!==null&&i!==void 0?i:[],this.sharedVar,this.rowHierarchyType,this.rowHierarchyType!=="grid"?this.rowExpandLevel:void 0),this.resetColumnHeaderLevelCount(),this._generateColHeaderIds(),this.colIndex=0,this._generateRowHeaderIds(),this._rowHeaderCellFullPathIds_FULL=Ct(this._rowHeaderCellFullPathIds_FULL),this._headerObjectMap=this._headerObjects.reduce((l,s)=>(l[s.id]=s,l),{}),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,this.generateCellIdsConsiderHideHeader(),this.setPagination(this.pagination)}isSeriesNumberInHeader(e,t){return this.leftRowSeriesNumberColumnCount>0&&e>=0&&t>=0&&e<this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount||this.rightRowSeriesNumberColumnCount>0&&t>=0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount&&t<this.headerLevelCount}isSeriesNumberInBody(e,t){return this.leftRowSeriesNumberColumnCount>0&&e>=0&&e<this.leftRowSeriesNumberColumnCount&&t>=this.headerLevelCount||this.rightRowSeriesNumberColumnCount>0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount&&t>=this.headerLevelCount}isSeriesNumber(e,t){return!!(O(e)&&O(t)&&(this.leftRowSeriesNumberColumnCount>0&&e>=0&&t>=0&&e<this.leftRowSeriesNumberColumnCount||this.rightRowSeriesNumberColumnCount>0&&t>=0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount))}getSeriesNumberHeader(e,t){return this.leftRowSeriesNumberColumnCount>0&&e>=0&&e<this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount?Object.assign({},this.leftRowSeriesNumberColumn[e],{style:Object.assign({},this._table.internalProps.theme.cornerHeaderStyle,this._table.internalProps.rowSeriesNumber.headerStyle)}):this.rightRowSeriesNumberColumnCount>0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount&&t<this.headerLevelCount&&t<this.headerLevelCount?this.rightRowSeriesNumberColumn[e-(this.colCount-this.rightRowSeriesNumberColumnCount)]:void 0}getSeriesNumberBody(e,t){return this.leftRowSeriesNumberColumnCount>0&&e>=0&&e<this.leftRowSeriesNumberColumnCount&&t>=this.headerLevelCount?this.leftRowSeriesNumberColumn[e]:this.rightRowSeriesNumberColumnCount>0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount&&t>=this.headerLevelCount?this.rightRowSeriesNumberColumn[e-(this.colCount-this.rightRowSeriesNumberColumnCount)]:void 0}changeTreeNodeTitle(e,t,i){this.getHeadNode(e,t).value=i;const r=this.getCellId(e,t);this._headerObjectMap[r].title=i}changeCornerTitle(e,t,i){if(this.isCornerHeader(e,t)){const r=this.getCellId(e,t);this._headerObjectMap[r].title=i}}generateCellIdsConsiderHideHeader(){var e,t,i,r;if(this._columnHeaderCellIds=this._columnHeaderCellFullPathIds.slice(),!this.showColumnHeader)if(this.indicatorsAsCol&&!this.hideIndicatorName){const o=this.colDimensionKeys.indexOf(Ne),l=this._columnHeaderCellIds.splice(o,1);this._columnHeaderCellIds.splice(0,this._columnHeaderCellIds.length),this._columnHeaderCellIds.push(l[0])}else this._columnHeaderCellIds.splice(0,this._columnHeaderCellIds.length);if(this._rowHeaderCellIds_FULL=this._rowHeaderCellFullPathIds_FULL.slice(),!this.showRowHeader)if(this.indicatorsAsCol||this.hideIndicatorName)this._rowHeaderCellIds_FULL.forEach((o,l)=>{const s=o.slice();s.splice(0,s.length),this._rowHeaderCellIds_FULL[l]=s});else{const o=this.rowDimensionKeys.indexOf(Ne);this._rowHeaderCellIds_FULL.forEach((l,s)=>{const a=l.slice(),n=a.splice(o,1);a.splice(0,a.length),a.push(n[0]),this._rowHeaderCellIds_FULL[s]=a})}if(this._rowHeaderCellIds=this._rowHeaderCellIds_FULL.slice(),this._cornerHeaderCellIds=this._cornerHeaderCellFullPathIds.slice(),this.rowHeaderLevelCount===0||this.columnHeaderLevelCount===0)this._cornerHeaderCellIds=[];else if(this.cornerSetting.titleOnDimension!=="row"||this.showRowHeader){if(this.cornerSetting.titleOnDimension==="column"&&!this.showColumnHeader)if(this.indicatorsAsCol&&!this.hideIndicatorName){const o=this.colDimensionKeys.indexOf(Ne),l=this._cornerHeaderCellIds.splice(o,1);this._cornerHeaderCellIds.splice(0,this._cornerHeaderCellIds.length),this._cornerHeaderCellIds.push(l[0])}else this._cornerHeaderCellIds.splice(0,this._cornerHeaderCellIds.length)}else if(this.indicatorsAsCol||this.hideIndicatorName)this._cornerHeaderCellIds.forEach((o,l)=>{const s=o.slice();s.splice(0,s.length),this._cornerHeaderCellIds[l]=s});else{const o=this.rowDimensionKeys.indexOf(Ne);this._cornerHeaderCellIds.forEach((l,s)=>{const a=l.slice(),n=a.splice(o,1);a.splice(0,a.length),a.push(n[0]),this._cornerHeaderCellIds[s]=a})}if(this.rowHierarchyType==="grid-tree"&&this.cornerSetting.titleOnDimension==="column")this._cornerHeaderCellIds[0].length<this._rowHeaderCellIds[0].length?this._cornerHeaderCellIds.forEach((o,l)=>{const s=o.length;o.length=this._rowHeaderCellIds[0].length,o.fill(o[0],s)}):this._cornerHeaderCellIds[0].length>this._rowHeaderCellIds[0].length&&this._cornerHeaderCellIds.forEach((o,l)=>{o.length=this._rowHeaderCellIds[0].length});else if(this.columnHierarchyType==="grid-tree"&&this.cornerSetting.titleOnDimension==="row")if(((e=this._cornerHeaderCellIds)===null||e===void 0?void 0:e.length)<((t=this._columnHeaderCellIds)===null||t===void 0?void 0:t.length)){const o=this._cornerHeaderCellIds.length;this._cornerHeaderCellIds.length=this._columnHeaderCellIds.length,this._cornerHeaderCellIds.fill(this._cornerHeaderCellIds[0],o)}else((i=this._cornerHeaderCellIds)===null||i===void 0?void 0:i.length)>((r=this._columnHeaderCellIds)===null||r===void 0?void 0:r.length)&&(this._cornerHeaderCellIds.length=this._columnHeaderCellIds.length)}enableUseGetBodyCache(){this._useGetBodyCache=!0,this._getBodyCache.clear()}disableUseGetBodyCache(){this._useGetBodyCache=!1,this._getBodyCache.clear()}enableUseHeaderPathCache(){this._useHeaderPathCache=!0,this._colHeaderPathCache.clear(),this._rowHeaderPathCache.clear()}disableUseHeaderPathCache(){this._useHeaderPathCache=!1,this._colHeaderPathCache.clear(),this._rowHeaderPathCache.clear()}getBodyWidthCache(e,t){if(this._useGetBodyCache&&!this.isHeader(e,t)&&!this.isSeriesNumber(e,t))return this.indicatorsAsCol&&this._getBodyCache.has(e)?this._getBodyCache.get(e):!this.indicatorsAsCol&&this._getBodyCache.has(t)?this._getBodyCache.get(t):void 0}setBodyWidthCache(e,t,i){!this._useGetBodyCache||this.isHeader(e,t)||this.isSeriesNumber(e,t)||(this.indicatorsAsCol?this._getBodyCache.set(e,i):this._getBodyCache.set(t,i))}getColHeaderPathCache(e,t){if(this._useHeaderPathCache&&!this.isHeader(e,t)&&!this.isSeriesNumber(e,t)&&this._colHeaderPathCache.has(e))return this._colHeaderPathCache.get(e)}setColHeaderPathCache(e,t,i){!this._useHeaderPathCache||this.isHeader(e,t)||this.isSeriesNumber(e,t)||this._colHeaderPathCache.set(e,i)}getRowHeaderPathCache(e,t){if(this._useHeaderPathCache&&!this.isHeader(e,t)&&!this.isSeriesNumber(e,t)&&this._rowHeaderPathCache.has(t))return this._rowHeaderPathCache.get(t)}setRowHeaderPathCache(e,t,i){!this._useHeaderPathCache||this.isHeader(e,t)||this.isSeriesNumber(e,t)||this._rowHeaderPathCache.set(t,i)}}function jt(R,e,t,i){t===1&&(t=0);const r=uo(R,t,i),o=e/(1-t);return Math.ceil(r*o)}function uo(R,e,t){let i;return i=R===1?R+2*t:R-e+2*t,R?i>0?i:1:0}class pt{constructor(e,t){this.tree={},this.beforeChangedTree={},this.colFlatKeys={},this.rowFlatKeys={},this.stringJoinChar="\0",this.rowsIsTotal=[],this.colsIsTotal=[],this.dataConfig=e,t&&(this.records=t,typeof window<"u"&&window.performance.now(),this.setRecords(t),typeof window<"u"&&window.performance.now())}changeDataConfig(e){this.dataConfig=e}setRecords(e){this.processRecords()}processRecords(){for(let e=0,t=this.records.length;e<t;e++){const i=this.records[e];this.processRecord(i)}}processRecord(e){var t;const i=[],r=[];for(let o=0,l=this.dataConfig.rows.length;o<l;o++){const s=this.dataConfig.rows[o];e[s]!==void 0&&s!==this.dataConfig.indicatorDimensionKey&&r.push(e[s])}for(let o=0,l=this.dataConfig.columns.length;o<l;o++){const s=this.dataConfig.columns[o];e[s]!==void 0&&s!==this.dataConfig.indicatorDimensionKey&&i.push(e[s])}(t=this.dataConfig.indicators)===null||t===void 0||t.forEach(o=>{const l=e[o];l!==void 0&&(this.dataConfig.indicatorsAsCol?i.push(o):r.push(o));const s=r.join(this.stringJoinChar),a=i.join(this.stringJoinChar);r.length!==0&&(this.rowFlatKeys[s]||(this.rowFlatKeys[s]=1)),i.length!==0&&(this.colFlatKeys[a]||(this.colFlatKeys[a]=1)),i.length===0&&r.length===0||(this.tree[s]||(this.tree[s]={}),l!==void 0&&(this.tree[s][a]={value:l,record:e},this.dataConfig.indicatorsAsCol?i.pop():r.pop()))})}getTreeNode(e=[],t=[],i,r=!0){var o,l,s,a;let n,d;if(typeof e=="string")n=e;else{let h=!1;e.map((u,c)=>{u===i&&(e.splice(c,1),h=!0)}),h&&e.push(i),n=e.join(this.stringJoinChar)}if(typeof t=="string")d=t;else{let h=!1;t.map((u,c)=>{u===i&&(t.splice(c,1),h=!0)}),h&&t.push(i),d=t.join(this.stringJoinChar)}return r?(s=(l=(o=this.tree)===null||o===void 0?void 0:o[n])===null||l===void 0?void 0:l[d])!==null&&s!==void 0?s:void 0:O((a=this.beforeChangedTree[n])===null||a===void 0?void 0:a[d])?{value:this.beforeChangedTree[n][d].value,record:this.beforeChangedTree[n][d].record}:void 0}changeTreeNodeValue(e=[],t=[],i,r){var o,l,s,a,n,d,h;let u,c;if(typeof e=="string")u=e;else{let H=!1;e.map((g,m)=>{g===i&&(e.splice(m,1),H=!0)}),H&&e.push(i),u=e.join(this.stringJoinChar)}if(typeof t=="string")c=t;else{let H=!1;t.map((g,m)=>{g===i&&(t.splice(m,1),H=!0)}),H&&t.push(i),c=t.join(this.stringJoinChar)}const v=(l=(o=this.tree[u])===null||o===void 0?void 0:o[c])===null||l===void 0?void 0:l.value,f=Object.assign({},(a=(s=this.tree[u])===null||s===void 0?void 0:s[c])===null||a===void 0?void 0:a.record);!((d=(n=this.tree[u])===null||n===void 0?void 0:n[c])===null||d===void 0)&&d.record?(this.tree[u][c].record[i]=r,this.tree[u][c].value=r):(this.tree[u]||(this.tree[u]={}),this.tree[u][c]={record:this._buildRecord(e,t,i,r),value:r}),!((h=this.beforeChangedTree[u])===null||h===void 0)&&h[c]||(this.beforeChangedTree[u]={},this.beforeChangedTree[u][c]={record:void 0,value:void 0},this.beforeChangedTree[u][c].record=f,this.beforeChangedTree[u][c].value=v)}_buildRecord(e=[],t=[],i,r){const o={},l=this.dataConfig.rows,s=this.dataConfig.columns;return l.forEach((a,n)=>{a!==this.dataConfig.indicatorDimensionKey&&(o[a]=e[n])}),s.forEach((a,n)=>{a!==this.dataConfig.indicatorDimensionKey&&(o[a]=t[n])}),o[i]=r,this.records.push(o),o}addRecords(e){for(let t=0,i=e.length;t<i;t++){const r=e[t];this.processRecord(r)}this.records.push(e)}changeRecordFieldValue(e,t,i){let r=!1;for(let o=0;o<this.dataConfig.indicators.length;o++)this.dataConfig.indicators[o]===e&&(r=!0);if(!r){for(let o=0,l=this.records.length;o<l;o++){const s=this.records[o];s[e]===t&&(s[e]=i)}this.rowFlatKeys={},this.colFlatKeys={},this.tree={},this.processRecords()}}}function Wt(R,e){let t="";for(let i=0;i<R.length;i++)t+=R[i],i!==R.length-1&&(t+=e);return t}class ut{constructor(e,t,i,r,o,l,s,a,n,d,h,u,c,v){var f,H,g,m,w,C,_,p,S,P,y,I,T,b,A,F,N,x,M,L,K,J,$,ae,de,he,ue,ce,fe,Te,Pe,Se,be,Ie,Re,De,te,se;this.tree={},this.changedTree={},this.colFlatKeys={},this.rowFlatKeys={},this.colKeys=[],this.rowKeys=[],this.colKeys_normal=[],this.rowKeys_normal=[],this.rowOrder="key_a_to_z",this.colOrder="key_a_to_z",this.sorted=!1,this.indicatorStatistics=[],this.stringJoinChar="\0",this.rowsIsTotal=[],this.colsIsTotal=[],this.collectedValues={},this.cacheCollectedValues={},this.totalRecordsTree={},this.registerAggregators(),this.dataConfig=e,this.filterRules=(f=this.dataConfig)===null||f===void 0?void 0:f.filterRules,this.rowHierarchyType=a??"grid",this.columnHierarchyType=n??"grid",this.sortRules=(H=this.dataConfig)===null||H===void 0?void 0:H.sortRules,this.aggregationRules=(g=this.dataConfig)===null||g===void 0?void 0:g.aggregationRules,this.derivedFieldRules=(m=this.dataConfig)===null||m===void 0?void 0:m.derivedFieldRules,this.mappingRules=(w=this.dataConfig)===null||w===void 0?void 0:w.mappingRules,this.calculatedFieldRules=(C=this.dataConfig)===null||C===void 0?void 0:C.calculatedFieldRules,this.calculatedFiledKeys=(p=(_=this.calculatedFieldRules)===null||_===void 0?void 0:_.map(q=>q.key))!==null&&p!==void 0?p:[],this.calculatedFieldDependIndicatorKeys=(P=(S=this.calculatedFieldRules)===null||S===void 0?void 0:S.reduce((q,Y)=>{for(let ie=0;ie<Y.dependIndicatorKeys.length;ie++)q.indexOf(Y.dependIndicatorKeys[ie])===-1&&q.push(Y.dependIndicatorKeys[ie]);return q},[]))!==null&&P!==void 0?P:[],this.totals=(y=this.dataConfig)===null||y===void 0?void 0:y.totals,this.rows=t,this.columns=i,this.indicatorKeys=r,this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys=[...r];for(let q=0;q<this.calculatedFieldDependIndicatorKeys.length;q++)this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys.indexOf(this.calculatedFieldDependIndicatorKeys[q])===-1&&this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys.push(this.calculatedFieldDependIndicatorKeys[q]);if(this.indicatorsAsCol=l,this.indicators=o,this.customColTree=d,this.customRowTree=h,this.hasExtensionRowTree=c,this.parseCustomTreeToMatchRecords=v,this.parseCustomTreeToMatchRecords&&(this.customColTreeDimensionPaths=this.customTreeToDimensionPathArr(this.customColTree,"col"),this.hasExtensionRowTree||(this.customRowTreeDimensionPaths=this.customTreeToDimensionPathArr(this.customRowTree,"row"))),this.colGrandTotalLabel=(b=(T=(I=this.totals)===null||I===void 0?void 0:I.column)===null||T===void 0?void 0:T.grandTotalLabel)!==null&&b!==void 0?b:"总计",this.colSubTotalLabel=(N=(F=(A=this.totals)===null||A===void 0?void 0:A.column)===null||F===void 0?void 0:F.subTotalLabel)!==null&&N!==void 0?N:"小计",this.rowGrandTotalLabel=(L=(M=(x=this.totals)===null||x===void 0?void 0:x.row)===null||M===void 0?void 0:M.grandTotalLabel)!==null&&L!==void 0?L:"总计",this.rowSubTotalLabel=($=(J=(K=this.totals)===null||K===void 0?void 0:K.row)===null||J===void 0?void 0:J.subTotalLabel)!==null&&$!==void 0?$:"小计",this.collectValuesBy=(ae=this.dataConfig)===null||ae===void 0?void 0:ae.collectValuesBy,this.needSplitPositiveAndNegative=u!=null&&u,this.rowsIsTotal=new Array((he=(de=this.rows)===null||de===void 0?void 0:de.length)!==null&&he!==void 0?he:0).fill(!1),this.colsIsTotal=new Array((ce=(ue=this.columns)===null||ue===void 0?void 0:ue.length)!==null&&ce!==void 0?ce:0).fill(!1),((fe=this.totals)===null||fe===void 0?void 0:fe.row)&&this.totals.row.showSubTotals!==!1&&this.totals.row.subTotalsDimensions)for(let q=0,Y=(be=(Se=(Pe=(Te=this.totals)===null||Te===void 0?void 0:Te.row)===null||Pe===void 0?void 0:Pe.subTotalsDimensions)===null||Se===void 0?void 0:Se.length)!==null&&be!==void 0?be:0;q<Y;q++){const ie=this.totals.row.subTotalsDimensions[q],ve=this.rows.indexOf(ie);this.rowsIsTotal[ve]=!0}if(!((Ie=this.totals)===null||Ie===void 0)&&Ie.column&&this.totals.column.showSubTotals!==!1&&this.totals.column.subTotalsDimensions)for(let q=0,Y=(se=(te=(De=(Re=this.totals)===null||Re===void 0?void 0:Re.column)===null||De===void 0?void 0:De.subTotalsDimensions)===null||te===void 0?void 0:te.length)!==null&&se!==void 0?se:0;q<Y;q++){const ie=this.totals.column.subTotalsDimensions[q],ve=this.columns.indexOf(ie);this.colsIsTotal[ve]=!0}this.setRecords(s)}setRecords(e){var t,i,r,o,l,s,a,n,d,h,u,c,v,f,H,g,m,w,C,_,p,S;this.records=e,this.collectedValues={},this.cacheCollectedValues={},this.totalRecordsTree={},this.tree={},this.colFlatKeys={},this.rowFlatKeys={},this.colKeys=[],this.rowKeys=[],this.rowsHasValue=[],this.columnsHasValue=[],this.sorted=!1,e&&(this.records=e,typeof window<"u"&&window.performance.now(),this.processRecords(),this.processCollectedValuesWithSumBy(),this.generateCollectedValuesSortRule(),this.processCollectedValuesWithSortBy(),typeof window<"u"&&window.performance.now(),typeof window<"u"&&window.performance.now(),this.totalStatistics(),typeof window<"u"&&window.performance.now(),this.rowKeys_normal=this.rowKeys.slice(),this.colKeys_normal=this.colKeys.slice(),typeof window<"u"&&window.performance.now(),this.sortKeys(),typeof window<"u"&&window.performance.now(),typeof window<"u"&&window.performance.now(),this.customRowTree?this.rowHeaderTree=this.customRowTree:this.rowHierarchyType==="tree"?this.rowHeaderTree=this.ArrToTree1(this.rowKeys,this.rows.filter((P,y)=>this.rowsHasValue[y]),this.indicatorsAsCol?void 0:this.indicators,((i=(t=this.totals)===null||t===void 0?void 0:t.row)===null||i===void 0?void 0:i.showGrandTotals)||!this.indicatorsAsCol&&this.columns.length===0||this.indicatorsAsCol&&this.rows.length===0,this.rowGrandTotalLabel,(l=(o=(r=this.totals)===null||r===void 0?void 0:r.row)===null||o===void 0?void 0:o.showGrandTotalsOnTop)!==null&&l!==void 0&&l):this.rowHeaderTree=this.ArrToTree(this.rowKeys,this.rows.filter((P,y)=>this.rowsHasValue[y]),this.indicatorsAsCol?void 0:this.indicators,this.rowsIsTotal,((a=(s=this.totals)===null||s===void 0?void 0:s.row)===null||a===void 0?void 0:a.showGrandTotals)||this.indicatorsAsCol&&this.rows.length===0,this.rowGrandTotalLabel,this.rowSubTotalLabel,(h=(d=(n=this.totals)===null||n===void 0?void 0:n.row)===null||d===void 0?void 0:d.showGrandTotalsOnTop)!==null&&h!==void 0&&h,(v=(c=(u=this.totals)===null||u===void 0?void 0:u.row)===null||c===void 0?void 0:c.showSubTotalsOnTop)!==null&&v!==void 0&&v),this.customColTree?this.colHeaderTree=this.customColTree:this.colHeaderTree=this.ArrToTree(this.colKeys,this.columns.filter((P,y)=>this.columnsHasValue[y]),this.indicatorsAsCol?this.indicators:void 0,this.colsIsTotal,((H=(f=this.totals)===null||f===void 0?void 0:f.column)===null||H===void 0?void 0:H.showGrandTotals)||!this.indicatorsAsCol&&this.columns.length===0,this.colGrandTotalLabel,this.colSubTotalLabel,(w=(m=(g=this.totals)===null||g===void 0?void 0:g.column)===null||m===void 0?void 0:m.showGrandTotalsOnLeft)!==null&&w!==void 0&&w,(p=(_=(C=this.totals)===null||C===void 0?void 0:C.column)===null||_===void 0?void 0:_.showSubTotalsOnLeft)!==null&&p!==void 0&&p),typeof window<"u"&&window.performance.now(),!((S=this.dataConfig)===null||S===void 0)&&S.isPivotChart&&this.cacheDeminsionCollectedValues())}registerAggregator(e,t){He[e]=t}registerAggregators(){this.registerAggregator(ee.RECORD,Ei),this.registerAggregator(ee.SUM,Oi),this.registerAggregator(ee.COUNT,Ni),this.registerAggregator(ee.MAX,Bi),this.registerAggregator(ee.MIN,zi),this.registerAggregator(ee.AVG,Vi),this.registerAggregator(ee.NONE,ki),this.registerAggregator(ee.RECALCULATE,ji),this.registerAggregator(ee.CUSTOM,Wi)}processCollectedValuesWithSumBy(){var e,t,i,r,o,l;for(const s in this.collectedValues)if(!((t=(e=this.collectValuesBy)===null||e===void 0?void 0:e[s])===null||t===void 0)&&t.sumBy)for(const a in this.collectedValues[s]){let n;((i=this.collectValuesBy[s])===null||i===void 0?void 0:i.extendRange)==="sum"?(n=Object.values(this.collectedValues[s][a]).reduce((c,v)=>c+v.value(),0),n+=Math.round(n/20)):(n=Object.values(this.collectedValues[s][a]).reduce((c,v)=>v.value()>c?v.value():c,Number.MIN_SAFE_INTEGER),((r=this.collectValuesBy[s])===null||r===void 0?void 0:r.extendRange)==="max"?n+=Math.round(n/20):typeof((o=this.collectValuesBy[s])===null||o===void 0?void 0:o.extendRange)=="number"&&(n=Math.max(n,(l=this.collectValuesBy[s])===null||l===void 0?void 0:l.extendRange)));const d=Object.values(this.collectedValues[s][a]).reduce((c,v)=>v.value()<c?v.value():c,Number.MAX_SAFE_INTEGER);let h,u;this.needSplitPositiveAndNegative&&(h=Object.values(this.collectedValues[s][a]).reduce((c,v)=>v.positiveValue()>c?v.positiveValue():c,Number.MIN_SAFE_INTEGER),u=Object.values(this.collectedValues[s][a]).reduce((c,v)=>v.negativeValue()<c?v.negativeValue():c,Number.MAX_SAFE_INTEGER)),this.collectedValues[s][a]={},this.collectedValues[s][a].max=n,this.collectedValues[s][a].min=d,this.needSplitPositiveAndNegative&&(this.collectedValues[s][a].positiveMax=h,this.collectedValues[s][a].negativeMin=u)}}processCollectedValuesWithSortBy(){var e,t;const i=this;for(const r in this.collectedValues)if(!((t=(e=this.collectValuesBy)===null||e===void 0?void 0:e[r])===null||t===void 0)&&t.sortBy)for(const o in this.collectedValues[r])this.collectedValues[r][o]=this.collectedValues[r][o].sort((l,s)=>{var a,n,d,h;return((n=(a=i.collectValuesBy[r].sortBy)===null||a===void 0?void 0:a.indexOf(l))!==null&&n!==void 0?n:-1)-((h=(d=i.collectValuesBy[r].sortBy)===null||d===void 0?void 0:d.indexOf(s))!==null&&h!==void 0?h:-1)})}generateCollectedValuesSortRule(){for(const e in this.collectedValues)if(this.collectValuesBy&&this.collectValuesBy[e]&&!this.collectValuesBy[e].sortBy){let t=[];for(const i in this.collectedValues[e])Array.isArray(this.collectedValues[e][i])&&(t.push(...this.collectedValues[e][i]),t=Array.from(new Set(t)));t.length>0&&(this.collectValuesBy[e].sortBy=t)}}processRecords(){var e,t;let i=!1;if(((t=(e=this.filterRules)===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0)>=1&&(i=!0),Array.isArray(this.records)){this.filteredRecords||(this.filteredRecords=[]);for(let r=0,o=this.records.length;r<o;r++){const l=this.records[r];i&&!this.filterRecord(l)||(this.filteredRecords.push(l),this.processRecord(l))}}else{this.filteredRecords||(this.filteredRecords={});for(const r in this.records)for(let o=0,l=this.records[r].length;o<l;o++){const s=this.records[r][o];i&&!this.filterRecord(s)||(this.filteredRecords[r]||(this.filteredRecords[r]=[]),this.filteredRecords[r].push(s),this.processRecord(s,r))}}this.rowFlatKeys={},this.colFlatKeys={}}filterRecord(e){var t,i;let r=!0;if(this.filterRules)for(let o=0;o<this.filterRules.length;o++){const l=this.filterRules[o];if(l.filterKey){const s=e[l.filterKey];if(((t=l.filteredValues)===null||t===void 0?void 0:t.indexOf(s))===-1){r=!1;break}}else if(!(!((i=l.filterFunc)===null||i===void 0)&&i.call(l,e))){r=!1;break}}return r}processRecord(e,t){var i,r,o,l,s,a,n,d,h,u,c,v,f,H,g,m,w,C,_,p,S,P,y,I,T,b,A,F,N,x,M,L,K,J,$,ae,de,he,ue,ce,fe,Te,Pe,Se,be,Ie,Re,De,te,se,q,Y,ie,ve,me,le,ye,Fe,ke,je,We,Ue,qe,Ge,Qe,Je;(i=this.derivedFieldRules)===null||i===void 0||i.forEach((D,V)=>{D.fieldName&&D.derivedFunc&&(e[D.fieldName]=D.derivedFunc(e))});for(const D in this.collectValuesBy)if(O(e[D])){this.collectedValues[D]||(this.collectedValues[D]={});const V=this.collectValuesBy[D].by.map(Q=>e[Q]).join(this.stringJoinChar);if(this.collectedValues[D][V]||(this.collectValuesBy[D].sumBy?this.collectedValues[D][V]={}:this.collectValuesBy[D].range?this.collectedValues[D][V]={min:Number.MAX_SAFE_INTEGER,max:Number.MIN_SAFE_INTEGER}:this.collectedValues[D][V]=[]),this.collectValuesBy[D].sumBy){const Q=(r=this.collectValuesBy[D].sumBy)===null||r===void 0?void 0:r.map(G=>e[G]).join(this.stringJoinChar);this.collectedValues[D][V][Q]||(this.collectedValues[D][V][Q]=new He[ee.SUM]({key:D,field:D,isRecord:void 0,needSplitPositiveAndNegative:this.needSplitPositiveAndNegative})),this.collectedValues[D][V][Q].push(e)}else if(this.collectValuesBy[D].range){const Q=this.collectedValues[D][V],G=Math.max(e[D],Q.max),oe=Math.min(e[D],Q.min);isNaN(G)||(Q.max=G,Q.min=oe)}else{const Q=this.collectedValues[D][V];Q.indexOf(e[D])===-1&&Q.push(e[D])}}let $e=!1;const ne=[],pe=[];if(!this.parseCustomTreeToMatchRecords||!((o=this.dataConfig)===null||o===void 0)&&o.isPivotChart||!(!((l=this.customRowTree)===null||l===void 0)&&l.length)||t||this.hasExtensionRowTree){const D=[];pe.push({rowKey:D,indicatorKey:t});for(let V=0,Q=this.rows.length;V<Q;V++){const G=this.rows[V];if(G in e)this.rowsHasValue[V]=!0,D.push(e[G]);else if(G!==Ne){if(!((n=(a=(s=this.dataConfig)===null||s===void 0?void 0:s.totals)===null||a===void 0?void 0:a.row)===null||n===void 0)&&n.showGrandTotals&&V===0&&!this.rows.find(oe=>oe in e)){D.push(this.rowGrandTotalLabel),$e=!0;break}if(!((u=(h=(d=this.dataConfig)===null||d===void 0?void 0:d.totals)===null||h===void 0?void 0:h.row)===null||u===void 0)&&u.subTotalsDimensions&&((f=(v=(c=this.dataConfig)===null||c===void 0?void 0:c.totals)===null||v===void 0?void 0:v.row)===null||f===void 0?void 0:f.subTotalsDimensions.indexOf(this.rows[V-1]))>=0){this.rowHierarchyType!=="tree"&&D.push(this.rowSubTotalLabel),$e=!0;break}}}}else{const D=this.getFieldMatchRowDimensionPaths(e);if(D.length>0)for(let V=0,Q=D.length;V<Q;V++){const G=D[V],oe=[];let B;for(let W=0,re=G.length;W<re;W++)O(G[W].indicatorKey)?B=G[W].indicatorKey:oe.push(G[W].value);pe.push({rowKey:oe,indicatorKey:B})}}if(!this.parseCustomTreeToMatchRecords||!((H=this.dataConfig)===null||H===void 0)&&H.isPivotChart||!(!((g=this.customColTree)===null||g===void 0)&&g.length)||t||this.hasExtensionRowTree){const D=[];ne.push({colKey:D,indicatorKey:t});for(let V=0,Q=this.columns.length;V<Q;V++){const G=this.columns[V];if(G in e)this.columnsHasValue[V]=!0,D.push(e[G]);else if(G!==Ne){if(!((C=(w=(m=this.dataConfig)===null||m===void 0?void 0:m.totals)===null||w===void 0?void 0:w.column)===null||C===void 0)&&C.showGrandTotals&&V===0&&!this.columns.find(oe=>oe in e)){D.push(this.colGrandTotalLabel),$e=!0;break}if(!((S=(p=(_=this.dataConfig)===null||_===void 0?void 0:_.totals)===null||p===void 0?void 0:p.column)===null||S===void 0)&&S.subTotalsDimensions&&((I=(y=(P=this.dataConfig)===null||P===void 0?void 0:P.totals)===null||y===void 0?void 0:y.column)===null||I===void 0?void 0:I.subTotalsDimensions.indexOf(this.columns[V-1]))>=0){D.push(this.colSubTotalLabel),$e=!0;break}}}}else{const D=this.getFieldMatchColDimensionPaths(e);if(D.length>0)for(let V=0,Q=D.length;V<Q;V++){const G=D[V],oe=[];let B;for(let W=0,re=G.length;W<re;W++)O(G[W].indicatorKey)?B=G[W].indicatorKey:oe.push(G[W].value);ne.push({colKey:oe,indicatorKey:B})}}for(let D=0;D<pe.length;D++){const V=pe[D].rowKey;let Q;this.indicatorsAsCol||(Q=pe[D].indicatorKey);for(let G=0;G<ne.length;G++){const oe=ne[G].colKey;this.indicatorsAsCol&&(Q=ne[G].indicatorKey);const B=V.join(this.stringJoinChar),W=oe.join(this.stringJoinChar);if($e){this.totalRecordsTree[B]||(this.totalRecordsTree[B]={}),this.totalRecordsTree[B][W]||(this.totalRecordsTree[B][W]=[]);const z=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let k=0;k<z.length;k++)if(this.calculatedFiledKeys.indexOf(z[k])>=0){const X=(T=this.calculatedFieldRules)===null||T===void 0?void 0:T.find(Ae=>Ae.key===z[k]);!((A=(b=this.totalRecordsTree[B])===null||b===void 0?void 0:b[W])===null||A===void 0)&&A[k]||(this.totalRecordsTree[B][W][k]=new He[ee.RECALCULATE]({key:z[k],field:z[k],isRecord:!0,formatFun:(N=(F=this.indicators)===null||F===void 0?void 0:F.find(Ae=>typeof Ae!="string"&&Ae.indicatorKey===z[k]))===null||N===void 0?void 0:N.format,calculateFun:X==null?void 0:X.calculateFun,dependAggregators:this.totalRecordsTree[B][W],dependIndicatorKeys:X==null?void 0:X.dependIndicatorKeys})),z[k]in e&&((M=(x=this.totalRecordsTree[B])===null||x===void 0?void 0:x[W])===null||M===void 0||M[k].push(e))}else{const X=this.getAggregatorRule(z[k]);!((K=(L=this.totalRecordsTree[B])===null||L===void 0?void 0:L[W])===null||K===void 0)&&K[k]||(this.totalRecordsTree[B][W][k]=new He[(J=X==null?void 0:X.aggregationType)!==null&&J!==void 0?J:ee.SUM]({key:z[k],field:($=X==null?void 0:X.field)!==null&&$!==void 0?$:z[k],aggregationFun:X==null?void 0:X.aggregationFun,formatFun:(ae=X==null?void 0:X.formatFun)!==null&&ae!==void 0?ae:(he=(de=this.indicators)===null||de===void 0?void 0:de.find(Ae=>typeof Ae!="string"&&Ae.indicatorKey===z[k]))===null||he===void 0?void 0:he.format})),z[k]in e&&((ce=(ue=this.totalRecordsTree[B])===null||ue===void 0?void 0:ue[W])===null||ce===void 0||ce[k].push(e))}return}V.length!==0&&(this.rowFlatKeys[B]||(this.rowKeys.push(V),this.rowFlatKeys[B]=1)),oe.length!==0&&(this.colFlatKeys[W]||(this.colKeys.push(oe),this.colFlatKeys[W]=1)),this.tree[B]||(this.tree[B]={}),!((fe=this.tree[B])===null||fe===void 0)&&fe[W]||(this.tree[B][W]=[]);const re=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let z=0;z<re.length;z++)if(this.calculatedFiledKeys.indexOf(re[z])>=0){const k=(Te=this.calculatedFieldRules)===null||Te===void 0?void 0:Te.find(X=>X.key===re[z]);!((Se=(Pe=this.tree[B])===null||Pe===void 0?void 0:Pe[W])===null||Se===void 0)&&Se[z]||(this.tree[B][W][z]=new He[ee.RECALCULATE]({key:re[z],field:re[z],isRecord:!0,formatFun:(Ie=(be=this.indicators)===null||be===void 0?void 0:be.find(X=>typeof X!="string"&&X.indicatorKey===re[z]))===null||Ie===void 0?void 0:Ie.format,calculateFun:k==null?void 0:k.calculateFun,dependAggregators:this.tree[B][W],dependIndicatorKeys:k==null?void 0:k.dependIndicatorKeys})),(De=(Re=this.tree[B])===null||Re===void 0?void 0:Re[W])===null||De===void 0||De[z].push(e)}else{const k=this.getAggregatorRule(re[z]);let X=!1;Q?t===Q?re[z]===Q&&(X=!0):re[z]===Q&&re[z]in e&&(X=!0):k!=null&&k.field?typeof(k==null?void 0:k.field)=="string"?(k==null?void 0:k.field)in e&&(X=!0):k!=null&&k.field.find(Ae=>Ae in e)&&(X=!0):re[z]in e&&(X=!0),!(!((se=(te=this.tree[B])===null||te===void 0?void 0:te[W])===null||se===void 0)&&se[z])&&X&&(this.tree[B][W][z]=new He[(q=k==null?void 0:k.aggregationType)!==null&&q!==void 0?q:ee.SUM]({key:re[z],field:(Y=k==null?void 0:k.field)!==null&&Y!==void 0?Y:re[z],aggregationFun:k==null?void 0:k.aggregationFun,formatFun:(ie=k==null?void 0:k.formatFun)!==null&&ie!==void 0?ie:(me=(ve=this.indicators)===null||ve===void 0?void 0:ve.find(Ae=>typeof Ae!="string"&&Ae.indicatorKey===re[z]))===null||me===void 0?void 0:me.format})),X&&((ye=(le=this.tree[B])===null||le===void 0?void 0:le[W])===null||ye===void 0||ye[z].push(e))}if(this.mappingRules)for(let z=0;z<this.indicatorKeys.length;z++){if(!this.indicatorStatistics[z]){const k=this.getAggregatorRule(this.indicatorKeys[z]);this.indicatorStatistics[z]={max:new He[ee.MAX]({key:this.indicatorKeys[z],field:this.indicatorKeys[z]}),min:new He[ee.MIN]({key:this.indicatorKeys[z],field:this.indicatorKeys[z]}),total:new He[(Fe=k==null?void 0:k.aggregationType)!==null&&Fe!==void 0?Fe:ee.SUM]({key:this.indicatorKeys[z],field:(ke=k==null?void 0:k.field)!==null&&ke!==void 0?ke:this.indicatorKeys[z],aggregationFun:k==null?void 0:k.aggregationFun,formatFun:(je=k==null?void 0:k.formatFun)!==null&&je!==void 0?je:(Ue=(We=this.indicators)===null||We===void 0?void 0:We.find(X=>typeof X!="string"&&X.indicatorKey===this.indicatorKeys[z]))===null||Ue===void 0?void 0:Ue.format})}}this.indicatorStatistics[z].max.push((Ge=(qe=this.tree[B])===null||qe===void 0?void 0:qe[W])===null||Ge===void 0?void 0:Ge[z].value()),this.indicatorStatistics[z].min.push((Je=(Qe=this.tree[B])===null||Qe===void 0?void 0:Qe[W])===null||Je===void 0?void 0:Je[z].value()),this.indicatorStatistics[z].total.push(e)}}}}updateSortRules(e){var t,i,r,o,l,s,a,n,d,h,u,c,v,f,H,g,m,w,C,_,p;this.sorted=!1,this.sortRules=e,this.sortKeys(),this.customRowTree||(this.rowHierarchyType==="tree"?this.rowHeaderTree=this.ArrToTree1(this.rowKeys,this.rows.filter((S,P)=>this.rowsHasValue[P]),this.indicatorsAsCol?void 0:this.indicators,((i=(t=this.totals)===null||t===void 0?void 0:t.row)===null||i===void 0?void 0:i.showGrandTotals)||!this.indicatorsAsCol&&this.columns.length===0||this.indicatorsAsCol&&this.rows.length===0,this.rowGrandTotalLabel,(l=(o=(r=this.totals)===null||r===void 0?void 0:r.row)===null||o===void 0?void 0:o.showGrandTotalsOnTop)!==null&&l!==void 0&&l):this.rowHeaderTree=this.ArrToTree(this.rowKeys,this.rows.filter((S,P)=>this.rowsHasValue[P]),this.indicatorsAsCol?void 0:this.indicators,this.rowsIsTotal,((a=(s=this.totals)===null||s===void 0?void 0:s.row)===null||a===void 0?void 0:a.showGrandTotals)||this.indicatorsAsCol&&this.rows.length===0,this.rowGrandTotalLabel,this.rowSubTotalLabel,(h=(d=(n=this.totals)===null||n===void 0?void 0:n.row)===null||d===void 0?void 0:d.showGrandTotalsOnTop)!==null&&h!==void 0&&h,(v=(c=(u=this.totals)===null||u===void 0?void 0:u.row)===null||c===void 0?void 0:c.showSubTotalsOnTop)!==null&&v!==void 0&&v)),this.customColTree||(this.colHeaderTree=this.ArrToTree(this.colKeys,this.columns.filter((S,P)=>this.columnsHasValue[P]),this.indicatorsAsCol?this.indicators:void 0,this.colsIsTotal,((H=(f=this.totals)===null||f===void 0?void 0:f.column)===null||H===void 0?void 0:H.showGrandTotals)||!this.indicatorsAsCol&&this.columns.length===0,this.colGrandTotalLabel,this.colSubTotalLabel,(w=(m=(g=this.totals)===null||g===void 0?void 0:g.column)===null||m===void 0?void 0:m.showGrandTotalsOnLeft)!==null&&w!==void 0&&w,(p=(_=(C=this.totals)===null||C===void 0?void 0:C.column)===null||_===void 0?void 0:_.showSubTotalsOnLeft)!==null&&p!==void 0&&p))}updateFilterRules(e,t=!1){var i,r;if(this.filterRules=e,this.filteredRecords=void 0,t)this.tree={};else for(const o in this.tree)for(const l in this.tree[o])for(let s=0;s<this.tree[o][l].length;s++)(i=this.tree[o][l][s])===null||i===void 0||i.reset();this.collectedValues={},this.processRecords(),this.processCollectedValuesWithSumBy(),this.processCollectedValuesWithSortBy(),this.totalStatistics(),!((r=this.dataConfig)===null||r===void 0)&&r.isPivotChart&&this.cacheDeminsionCollectedValues()}getAggregatorRule(e){var t;return(t=this.aggregationRules)===null||t===void 0?void 0:t.find((i,r)=>e===i.indicatorKey)}getAggregator(e=[],t=[],i,r=!0,o){var l,s,a,n,d,h,u,c,v,f,H,g,m,w;const C=this.indicatorKeys.indexOf(i);let _,p;typeof e=="string"?_=e:(o&&o.position!=="row"||e.map((P,y)=>{P!==i||O(o==null?void 0:o.index)&&y!==o.index||e.splice(y,1)}),e.length<this.rows.length&&this.rowHierarchyType==="grid-tree"&&(e[0]===this.rowGrandTotalLabel||!((s=(l=this.totals)===null||l===void 0?void 0:l.row)===null||s===void 0)&&s.subTotalsDimensions&&((d=(n=(a=this.totals)===null||a===void 0?void 0:a.row)===null||n===void 0?void 0:n.subTotalsDimensions)===null||d===void 0?void 0:d.length)>=1&&e[e.length-1]!==this.rowSubTotalLabel&&e.push(this.rowSubTotalLabel)),_=Wt(e,this.stringJoinChar)),typeof t=="string"?p=t:(o&&o.position!=="col"||t.map((P,y)=>{P!==i||O(o==null?void 0:o.index)&&y!==o.index||t.splice(y,1)}),t.length<this.columns.length&&this.columnHierarchyType==="grid-tree"&&(t[0]===this.colGrandTotalLabel||!((u=(h=this.totals)===null||h===void 0?void 0:h.column)===null||u===void 0)&&u.subTotalsDimensions&&((f=(v=(c=this.totals)===null||c===void 0?void 0:c.column)===null||v===void 0?void 0:v.subTotalsDimensions)===null||f===void 0?void 0:f.length)>=1&&t[t.length-1]!==this.colSubTotalLabel&&t.push(this.colSubTotalLabel)),p=Wt(t,this.stringJoinChar));const S=(g=(H=this.tree[_])===null||H===void 0?void 0:H[p])===null||g===void 0?void 0:g[C];if(r&&O((w=(m=this.changedTree[_])===null||m===void 0?void 0:m[p])===null||w===void 0?void 0:w[C])){const P=this.changedTree[_][p][C];return S?{value:()=>P,formatValue:S.formatValue,formatFun:S.formatFun,records:S.records,recalculate(){},push(){},deleteRecord(){},updateRecord(){},clearCacheValue(){},reset(){}}:{records:[],value:()=>P,push(){},deleteRecord(){},updateRecord(){},recalculate(){},formatValue:()=>P,clearCacheValue(){},reset(){}}}return S||{records:[],push(){},deleteRecord(){},updateRecord(){},recalculate(){},value:()=>null,clearCacheValue(){},reset(){}}}sortKeys(){if(this.colKeys=this.colKeys_normal.slice(),this.rowKeys=this.rowKeys_normal.slice(),!this.sorted){this.sorted=!0,this.rowKeys.sort(this.arrSort(this.rows,!0));const e=this.arrSort(this.columns,!1);this.colKeys.sort(e)}}arrSort(e,t){let i;const r=this,o=(function(l){const s=[];for(let a=0,n=e.length;a<n;a++)if(i=e[a],r.sortRules)for(let d=0,h=r.sortRules.length;d<h;d++)r.sortRules[d].sortField===i&&s.push({field:i,fieldIndex:a,sortRule:r.sortRules[d],func:r.getSort(r.sortRules[d],t)});return s}).call(this);return function(l,s){var a,n,d,h;let u,c;for(let v=0;v<o.length;v++){if(c=o[v],(a=c.sortRule)===null||a===void 0?void 0:a.sortByIndicator){let f=l,H=s;c.fieldIndex<e.length-1&&(f=l.slice(0,c.fieldIndex+1),r.rowHierarchyType==="grid"&&t?f.push(r.rowSubTotalLabel):t||f.push(r.colSubTotalLabel),H=s.slice(0,c.fieldIndex+1),r.rowHierarchyType==="grid"&&t?H.push(r.rowSubTotalLabel):t||H.push(r.colSubTotalLabel)),u=c.func(f,H,(n=c.sortRule)===null||n===void 0?void 0:n.sortType)}else u=(d=c.func)===null||d===void 0?void 0:d.call(c,l[c.fieldIndex],s[c.fieldIndex],(h=c.sortRule)===null||h===void 0?void 0:h.sortType);if(u!==0)return u}return 0}}getSort(e,t){const i=this;return e.sortByIndicator?(r,o,l)=>{const s=function(a,n){return i.rowHierarchyType==="grid"&&a.length<i.rows.length&&a[a.length-1]!==i.rowSubTotalLabel&&a[a.length-1]!==i.rowGrandTotalLabel&&a.push(i.rowSubTotalLabel),n.length<i.columns.length&&n[n.length-1]!==i.colSubTotalLabel&&n[n.length-1]!==i.colGrandTotalLabel&&n.push(i.colSubTotalLabel),i.getAggregator(a,n,e.sortByIndicator).value()};return t?yt(s(r,e.query),s(o,e.query),l):yt(s(e.query,r),s(e.query,o),l)}:e.sortBy?Ui(e.sortBy):e.sortFunc?e.sortFunc:e.sortType?qi:yt}totalStatistics(){var e,t,i,r,o,l,s,a,n,d,h,u,c,v;const f=this,H=(g,m)=>{var w,C,_,p,S,P,y,I,T,b,A,F,N,x,M,L,K,J,$,ae,de,he,ue,ce,fe,Te,Pe,Se,be,Ie,Re,De,te,se,q,Y,ie,ve,me,le,ye,Fe,ke,je,We,Ue,qe,Ge,Qe,Je;if(!((C=(w=this.totalRecordsTree)===null||w===void 0?void 0:w[g])===null||C===void 0)&&C[m])return this.tree[g]||(this.tree[g]={}),void(this.tree[g][m]=(p=(_=this.totalRecordsTree)===null||_===void 0?void 0:_[g])===null||p===void 0?void 0:p[m]);const $e=m.split(this.stringJoinChar);if(!((P=(S=f.totals)===null||S===void 0?void 0:S.column)===null||P===void 0)&&P.subTotalsDimensions&&((T=(I=(y=f.totals)===null||y===void 0?void 0:y.column)===null||I===void 0?void 0:I.subTotalsDimensions)===null||T===void 0?void 0:T.length)>0&&f.totals.column.showSubTotals!==!1)for(let ne=0,pe=(F=(A=(b=f.totals)===null||b===void 0?void 0:b.column)===null||A===void 0?void 0:A.subTotalsDimensions)===null||F===void 0?void 0:F.length;ne<pe;ne++){const D=f.totals.column.subTotalsDimensions[ne],V=f.columns.indexOf(D);if(V>=0){const Q=$e.slice(0,V+1);Q.push(f.colSubTotalLabel);const G=Q.join(this.stringJoinChar);if(!((x=(N=this.totalRecordsTree)===null||N===void 0?void 0:N[g])===null||x===void 0)&&x[G])return void(this.tree[g][G]=(L=(M=this.totalRecordsTree)===null||M===void 0?void 0:M[g])===null||L===void 0?void 0:L[G]);this.tree[g][G]||(this.tree[g][G]=[]);const oe=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let B=0;B<oe.length;B++)if(this.calculatedFiledKeys.indexOf(oe[B])>=0){const W=(K=this.calculatedFieldRules)===null||K===void 0?void 0:K.find(re=>re.key===oe[B]);!(($=(J=this.tree[g])===null||J===void 0?void 0:J[G])===null||$===void 0)&&$[B]||(this.tree[g][G][B]=new He[ee.RECALCULATE]({key:oe[B],field:oe[B],isRecord:!0,formatFun:(de=(ae=this.indicators)===null||ae===void 0?void 0:ae.find(re=>typeof re!="string"&&re.indicatorKey===oe[B]))===null||de===void 0?void 0:de.format,calculateFun:W==null?void 0:W.calculateFun,dependAggregators:this.tree[g][G],dependIndicatorKeys:W==null?void 0:W.dependIndicatorKeys})),G!==m&&this.tree[g][G][B].push((ue=(he=f.tree[g])===null||he===void 0?void 0:he[m])===null||ue===void 0?void 0:ue[B])}else{if(!this.tree[g][G][B]){const W=this.getAggregatorRule(oe[B]);this.tree[g][G][B]=new He[(ce=W==null?void 0:W.aggregationType)!==null&&ce!==void 0?ce:ee.SUM]({key:oe[B],field:(fe=W==null?void 0:W.field)!==null&&fe!==void 0?fe:oe[B],aggregationFun:W==null?void 0:W.aggregationFun,formatFun:(Te=W==null?void 0:W.formatFun)!==null&&Te!==void 0?Te:(Se=(Pe=this.indicators)===null||Pe===void 0?void 0:Pe.find(re=>typeof re!="string"&&re.indicatorKey===oe[B]))===null||Se===void 0?void 0:Se.format})}G!==m&&this.tree[g][G][B].push((Ie=(be=f.tree[g])===null||be===void 0?void 0:be[m])===null||Ie===void 0?void 0:Ie[B])}}}if(!((De=(Re=f.totals)===null||Re===void 0?void 0:Re.column)===null||De===void 0)&&De.showGrandTotals||this.rows.length===0){const ne=f.colGrandTotalLabel;if(!((se=(te=this.totalRecordsTree)===null||te===void 0?void 0:te[g])===null||se===void 0)&&se[ne])return void(this.tree[g][ne]=(Y=(q=this.totalRecordsTree)===null||q===void 0?void 0:q[g])===null||Y===void 0?void 0:Y[ne]);this.tree[g][ne]||(this.tree[g][ne]=[]);const pe=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let D=0;D<pe.length;D++)if(this.calculatedFiledKeys.indexOf(pe[D])>=0){const V=(ie=this.calculatedFieldRules)===null||ie===void 0?void 0:ie.find(Q=>Q.key===pe[D]);!((me=(ve=this.tree[g])===null||ve===void 0?void 0:ve[ne])===null||me===void 0)&&me[D]||(this.tree[g][ne][D]=new He[ee.RECALCULATE]({key:pe[D],field:pe[D],isRecord:!0,formatFun:(ye=(le=this.indicators)===null||le===void 0?void 0:le.find(Q=>typeof Q!="string"&&Q.indicatorKey===pe[D]))===null||ye===void 0?void 0:ye.format,calculateFun:V==null?void 0:V.calculateFun,dependAggregators:this.tree[g][ne],dependIndicatorKeys:V==null?void 0:V.dependIndicatorKeys})),ne!==m&&this.tree[g][ne][D].push((ke=(Fe=f.tree[g])===null||Fe===void 0?void 0:Fe[m])===null||ke===void 0?void 0:ke[D])}else{if(!this.tree[g][ne][D]){const V=this.getAggregatorRule(pe[D]);this.tree[g][ne][D]=new He[(je=V==null?void 0:V.aggregationType)!==null&&je!==void 0?je:ee.SUM]({key:pe[D],field:(We=V==null?void 0:V.field)!==null&&We!==void 0?We:pe[D],formatFun:(Ue=V==null?void 0:V.formatFun)!==null&&Ue!==void 0?Ue:(Ge=(qe=this.indicators)===null||qe===void 0?void 0:qe.find(Q=>typeof Q!="string"&&Q.indicatorKey===pe[D]))===null||Ge===void 0?void 0:Ge.format})}ne!==m&&this.tree[g][ne][D].push((Je=(Qe=f.tree[g])===null||Qe===void 0?void 0:Qe[m])===null||Je===void 0?void 0:Je[D])}}};if(!((t=(e=f==null?void 0:f.totals)===null||e===void 0?void 0:e.column)===null||t===void 0)&&t.subTotalsDimensions&&((o=(r=(i=f==null?void 0:f.totals)===null||i===void 0?void 0:i.column)===null||r===void 0?void 0:r.subTotalsDimensions)===null||o===void 0?void 0:o.length)>=1||!((s=(l=f==null?void 0:f.totals)===null||l===void 0?void 0:l.row)===null||s===void 0)&&s.subTotalsDimensions&&((d=(n=(a=f==null?void 0:f.totals)===null||a===void 0?void 0:a.row)===null||n===void 0?void 0:n.subTotalsDimensions)===null||d===void 0?void 0:d.length)>=1||!((u=(h=f==null?void 0:f.totals)===null||h===void 0?void 0:h.column)===null||u===void 0)&&u.showGrandTotals||!((v=(c=f==null?void 0:f.totals)===null||c===void 0?void 0:c.row)===null||v===void 0)&&v.showGrandTotals){const g=[];Object.keys(f.tree).forEach(m=>{const w=m.split(this.stringJoinChar);Object.keys(f.tree[m]).forEach(C=>{var _,p,S,P,y,I,T,b,A,F,N,x,M,L,K,J,$,ae,de,he,ue,ce,fe,Te,Pe,Se,be,Ie,Re,De;if(!((p=(_=f.totals)===null||_===void 0?void 0:_.row)===null||p===void 0)&&p.subTotalsDimensions&&((y=(P=(S=f.totals)===null||S===void 0?void 0:S.row)===null||P===void 0?void 0:P.subTotalsDimensions)===null||y===void 0?void 0:y.length)>0&&f.totals.row.showSubTotals!==!1)for(let te=0,se=(b=(T=(I=f.totals)===null||I===void 0?void 0:I.row)===null||T===void 0?void 0:T.subTotalsDimensions)===null||b===void 0?void 0:b.length;te<se;te++){const q=f.totals.row.subTotalsDimensions[te],Y=f.rows.indexOf(q);if(Y>=0&&Y<f.rows.length-1){const ie=w.slice(0,Y+1);this.rowHierarchyType!=="tree"&&ie.push(f.rowSubTotalLabel);const ve=ie.join(this.stringJoinChar);this.tree[ve]||(this.tree[ve]={},g.push(ve)),this.tree[ve][C]||(this.tree[ve][C]=[]);const me=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let le=0;le<me.length;le++){if(!this.tree[ve][C][le])if(this.calculatedFiledKeys.indexOf(me[le])>=0){const ye=(A=this.calculatedFieldRules)===null||A===void 0?void 0:A.find(Fe=>Fe.key===me[le]);this.tree[ve][C][le]=new He[ee.RECALCULATE]({key:me[le],field:me[le],isRecord:!0,formatFun:(N=(F=this.indicators)===null||F===void 0?void 0:F.find(Fe=>typeof Fe!="string"&&Fe.indicatorKey===me[le]))===null||N===void 0?void 0:N.format,calculateFun:ye==null?void 0:ye.calculateFun,dependAggregators:this.tree[ve][C],dependIndicatorKeys:ye==null?void 0:ye.dependIndicatorKeys})}else{const ye=this.getAggregatorRule(me[le]);this.tree[ve][C][le]=new He[(x=ye==null?void 0:ye.aggregationType)!==null&&x!==void 0?x:ee.SUM]({key:me[le],field:(M=ye==null?void 0:ye.field)!==null&&M!==void 0?M:me[le],formatFun:(L=ye==null?void 0:ye.formatFun)!==null&&L!==void 0?L:(J=(K=this.indicators)===null||K===void 0?void 0:K.find(Fe=>typeof Fe!="string"&&Fe.indicatorKey===me[le]))===null||J===void 0?void 0:J.format})}ve!==m&&this.tree[ve][C][le].push((ae=($=f.tree[m])===null||$===void 0?void 0:$[C])===null||ae===void 0?void 0:ae[le])}}}if(!((he=(de=f.totals)===null||de===void 0?void 0:de.row)===null||he===void 0)&&he.showGrandTotals||this.columns.length===0){const te=f.rowGrandTotalLabel;this.tree[te]||(this.tree[te]={},g.push(te)),this.tree[te][C]||(this.tree[te][C]=[]);const se=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let q=0;q<se.length;q++){if(!this.tree[te][C][q])if(this.calculatedFiledKeys.indexOf(se[q])>=0){const Y=(ue=this.calculatedFieldRules)===null||ue===void 0?void 0:ue.find(ie=>ie.key===se[q]);this.tree[te][C][q]=new He[ee.RECALCULATE]({key:se[q],field:se[q],isRecord:!0,formatFun:(fe=(ce=this.indicators)===null||ce===void 0?void 0:ce.find(ie=>typeof ie!="string"&&ie.indicatorKey===se[q]))===null||fe===void 0?void 0:fe.format,calculateFun:Y==null?void 0:Y.calculateFun,dependAggregators:this.tree[te][C],dependIndicatorKeys:Y==null?void 0:Y.dependIndicatorKeys})}else{const Y=this.getAggregatorRule(se[q]);this.tree[te][C][q]=new He[(Te=Y==null?void 0:Y.aggregationType)!==null&&Te!==void 0?Te:ee.SUM]({key:se[q],field:(Pe=Y==null?void 0:Y.field)!==null&&Pe!==void 0?Pe:se[q],formatFun:(Se=Y==null?void 0:Y.formatFun)!==null&&Se!==void 0?Se:(Ie=(be=this.indicators)===null||be===void 0?void 0:be.find(ie=>typeof ie!="string"&&ie.indicatorKey===se[q]))===null||Ie===void 0?void 0:Ie.format})}te!==m&&this.tree[te][C][q].push((De=(Re=f.tree[m])===null||Re===void 0?void 0:Re[C])===null||De===void 0?void 0:De[q])}}H(m,C)})}),g.forEach(m=>{Object.keys(f.tree[m]).forEach(w=>{H(m,w)})})}for(const g in f.totalRecordsTree)for(const m in f.totalRecordsTree[g])H(g,m)}ArrToTree1(e,t,i,r,o,l){const s=[],a=this.stringJoinChar,n=new Map;function d(h,u){const c=[];let v;h.forEach((f,H)=>{var g;c.push(f);const m=c.join(a);let w=n.get(m);w||(w={value:f,dimensionKey:t[H],children:H===h.length-1&&((g=i==null?void 0:i.length)!==null&&g!==void 0?g:0)>=1?i==null?void 0:i.map(C=>typeof C=="string"?{indicatorKey:C,value:C}:{indicatorKey:C.indicatorKey,value:C.title}):[]},n.set(m,w),v?v.children.push(w):l&&u?s.unshift(w):s.push(w)),v=w})}return e.forEach(h=>d(h,!1)),r&&d([o],r),s}ArrToTree(e,t,i,r,o,l,s,a,n){var d;let h=[];const u=this.stringJoinChar,c=new Map;if(e!=null&&e.length?e.forEach(v=>function(f){const H=[];let g;f.forEach((m,w)=>{var C,_,p,S;H.push(m);const P=H.join(u);let y=c.get(P);if(!y){if(y={value:m,dimensionKey:t[w],children:w===f.length-1&&((C=i==null?void 0:i.length)!==null&&C!==void 0?C:0)>=1?i==null?void 0:i.map(I=>typeof I=="string"?{indicatorKey:I,value:I}:{indicatorKey:I.indicatorKey,value:I.title}):[]},r[w]){let I=(_=y.children)!==null&&_!==void 0?_:[];const T={value:s,dimensionKey:t[w+1],levelSpan:r.length-w-1,children:((p=i==null?void 0:i.length)!==null&&p!==void 0?p:0)>=1?i==null?void 0:i.map(b=>typeof b=="string"?{indicatorKey:b,value:b}:{indicatorKey:b.indicatorKey,value:b.title}):[]};I.push(T),I=(S=T.children)!==null&&S!==void 0?S:[]}c.set(P,y),g?r[w-1]&&!n?g.children.splice(g.children.length-1,0,y):g.children.push(y):h.push(y)}g=y})}(v)):i&&(h=i==null?void 0:i.map(v=>{var f;return typeof v=="string"?{indicatorKey:v,value:v}:{indicatorKey:v.indicatorKey,value:(f=v.title)!==null&&f!==void 0?f:v.indicatorKey}})),o&&(e==null?void 0:e.length)){const v={value:l,dimensionKey:t[0],levelSpan:r.length,children:(d=i==null?void 0:i.map(f=>typeof f=="string"?{indicatorKey:f,value:f}:{indicatorKey:f.indicatorKey,value:f.title}))!==null&&d!==void 0?d:[]};a?h.unshift(v):h.push(v)}return h}cacheDeminsionCollectedValues(){for(const e in this.collectValuesBy)this.collectValuesBy[e].type!=="xField"&&this.collectValuesBy[e].type!=="yField"||(this.dataConfig.dimensionSortArray?this.cacheCollectedValues[e]=co(this.collectedValues[e],this.dataConfig.dimensionSortArray):this.cacheCollectedValues[e]=this.collectedValues[e])}changeTreeNodeValue(e=[],t=[],i,r){var o,l,s;const a=this.indicatorKeys.indexOf(i);let n,d;n=typeof e=="string"?e:e.join(this.stringJoinChar),d=typeof t=="string"?t:t.join(this.stringJoinChar),!((o=this.changedTree[n])===null||o===void 0)&&o[d]?this.changedTree[n][d][a]=r:this.changedTree[n]?(this.changedTree[n][d]=[],this.changedTree[n][d][a]=r):(this.changedTree[n]={},this.changedTree[n][d]=[],this.changedTree[n][d][a]=r);const h=(s=(l=this.tree[n])===null||l===void 0?void 0:l[d])===null||s===void 0?void 0:s[a];(h==null?void 0:h.records.length)===1&&(h.records[0][this.indicatorKeys[a]]=r)}changeRecordFieldValue(e,t,i){let r=!1;for(let o=0;o<this.indicatorKeys.length;o++)this.indicatorKeys[o]===e&&(r=!0);if(!r){if(Array.isArray(this.records))for(let o=0,l=this.records.length;o<l;o++){const s=this.records[o];s[e]===t&&(s[e]=i)}else for(const o in this.records)for(let l=0,s=this.records[o].length;l<s;l++){const a=this.records[o][l];a[e]===t&&(a[e]=i)}this.rowFlatKeys={},this.colFlatKeys={},this.tree={},this.processRecords()}}_rowTreeHasChanged(){this.hasExtensionRowTree||(this.customRowTreeDimensionPaths=this.customTreeToDimensionPathArr(this.customRowTree,"row"))}changeDataConfig(e){this.rows=e.rows,this.columns=e.columns}addRecords(e){for(let t=0,i=e.length;t<i;t++){const r=e[t];this.processRecord(r)}Array.isArray(this.records)&&this.records.push(e)}customTreeToDimensionPathArr(e,t){const i=[],r=this;function o(l,s){var a,n,d;l.virtual||(!((a=s[s.length-1])===null||a===void 0)&&a.childKeys&&l.dimensionKey&&s[s.length-1].childKeys.indexOf(l.dimensionKey)===-1&&l.dimensionKey!==s[s.length-1].dimensionKey&&s[s.length-1].childKeys.push(l.dimensionKey),s.push({dimensionKey:O(l.indicatorKey)?void 0:l.dimensionKey,value:l.value,indicatorKey:l.indicatorKey,virtual:l.virtual})),((n=l.children)===null||n===void 0?void 0:n.length)>0?(r.rowHierarchyType==="tree"&&t==="row"&&(s[s.length-1].childKeys=[],i.push([...s])),(d=l.children)===null||d===void 0||d.forEach(h=>o(h,[...s]))):i.push(s)}return e==null||e.forEach(l=>o(l,[])),i}getFieldMatchColDimensionPaths(e){var t,i;const r=[];for(let o=0;(i=o<((t=this.customColTreeDimensionPaths)===null||t===void 0?void 0:t.length))!==null&&i!==void 0&&i;o++){const l=this.customColTreeDimensionPaths[o];let s=!0;for(let a=0;a<l.length;a++){const n=l[a];if(n.dimensionKey&&e[n.dimensionKey]!==n.value||n.indicatorKey&&e[n.indicatorKey]===void 0){s=!1;break}}s&&r.push(l)}return r}getFieldMatchRowDimensionPaths(e){var t,i;const r=[];for(let o=0;(i=o<((t=this.customRowTreeDimensionPaths)===null||t===void 0?void 0:t.length))!==null&&i!==void 0&&i;o++){const l=this.customRowTreeDimensionPaths[o];let s=!0;for(let a=0;a<l.length;a++){const n=l[a];if(n.dimensionKey&&e[n.dimensionKey]!==n.value||n.indicatorKey&&e[n.indicatorKey]===void 0){s=!1;break}if(n.childKeys&&a===l.length-1&&n.childKeys.length>0&&n.childKeys.find(d=>O(e[d]))){s=!1;break}}s&&(this.indicatorsAsCol||this.rowHierarchyType!=="tree"||l.find(a=>a.indicatorKey)||(s=!1)),s&&r.push(l)}return r}}function co(R,e){return R.sort((t,i)=>{const r=e.indexOf(t),o=e.indexOf(i);return r<o?-1:r>o?1:0})}class vo extends Qt{constructor(e,t){var i,r,o,l,s,a,n,d,h,u,c,v,f,H,g,m,w,C,_,p,S,P,y,I;if(wt.mode==="node"?(t=e,e=null):e instanceof HTMLElement||(t=e,e=e.container?e.container:null),super(e,t),this.layoutNodeId={seqId:0},t){t.rowHierarchyType||(t.rowHierarchyType="grid"),t.columnHierarchyType||(t.columnHierarchyType="grid"),t.layout&&Object.assign(t,t.layout),this.internalProps.columns=Ce(t.columns),this.internalProps.rows=Ce(t.rows),this.internalProps.indicators=dt(t.indicators),(i=t.indicators)===null||i===void 0||i.forEach((b,A)=>{typeof b=="object"&&(b!=null&&b.editor)&&(this.internalProps.indicators[A].editor=b.editor)}),this.internalProps.columnTree=!t.indicatorsAsCol||!((r=t.columns)===null||r===void 0)&&r.length||t.columnTree?Ce(t.columnTree):[],this.internalProps.rowTree=t.indicatorsAsCol||!((o=t.rows)===null||o===void 0)&&o.length||t.rowTree?Ce(t.rowTree):[],this.internalProps.records=t.records,this.pagination=t.pagination,this.internalProps.columnResizeType=(a=(s=(l=t.resize)===null||l===void 0?void 0:l.columnResizeType)!==null&&s!==void 0?s:t.columnResizeType)!==null&&a!==void 0?a:"column",this.internalProps.rowResizeType=(h=(d=(n=t.resize)===null||n===void 0?void 0:n.rowResizeType)!==null&&d!==void 0?d:t.rowResizeType)!==null&&h!==void 0?h:"row",this.internalProps.dataConfig=Ce(t.dataConfig),this.internalProps.columnWidthConfig=t.columnWidthConfig,this.internalProps.columnWidthConfigForRowHeader=t.columnWidthConfigForRowHeader;const T=this.internalProps.records;if(this.internalProps.recordsIsTwoDimensionalArray=!1,((u=T==null?void 0:T[0])===null||u===void 0?void 0:u.constructor)===Array&&(this.internalProps.recordsIsTwoDimensionalArray=!0),((c=t.customConfig)===null||c===void 0?void 0:c.enableDataAnalysis)===!1){const b=new ge((v=this.internalProps.columnTree)!==null&&v!==void 0?v:[],this.layoutNodeId,this.options.columnHierarchyType,this.options.columnHierarchyType!=="grid"?(f=this.options.columnExpandLevel)!==null&&f!==void 0?f:1:void 0),A=new ge((H=this.internalProps.rowTree)!==null&&H!==void 0?H:[],this.layoutNodeId,this.options.rowHierarchyType,this.options.rowHierarchyType!=="grid"?(g=this.options.rowExpandLevel)!==null&&g!==void 0?g:1:void 0);this.internalProps.layoutMap=new ze(this,null,b,A),this.internalProps.recordsIsTwoDimensionalArray===!1&&(this.flatDataToObjects=new pt({rows:this.internalProps.layoutMap.fullRowDimensionKeys,columns:this.internalProps.layoutMap.colDimensionKeys,indicators:this.internalProps.layoutMap.indicatorKeys,indicatorsAsCol:this.internalProps.layoutMap.indicatorsAsCol,indicatorDimensionKey:this.internalProps.layoutMap.indicatorDimensionKey},T))}else{const b=Ot(this,t),{rowKeys:A,columnKeys:F,indicatorKeys:N}=b;let{columnDimensionTree:x,rowDimensionTree:M}=b;this.dataset=new ut(this.internalProps.dataConfig,A,F,N,this.internalProps.indicators,(m=t.indicatorsAsCol)===null||m===void 0||m,t.records,t.rowHierarchyType,t.columnHierarchyType,this.internalProps.columnTree,this.internalProps.rowTree,!1,!!t.extensionRows,!!t.parseCustomTreeToMatchRecords),t.columnTree?x.hasHideNode&&(Me(x.tree.children,t.indicators,!0,this),x.reset(x.tree.children)):(t.indicatorsAsCol!==!1&&(this.dataset.colHeaderTree=xe(this.dataset.colHeaderTree,t.indicators)),t.indicatorsAsCol!==!1&&t.indicators&&this.dataset.colHeaderTree&&Me(this.dataset.colHeaderTree,t.indicators,!1,this),x=new ge((w=this.dataset.colHeaderTree)!==null&&w!==void 0?w:[],this.layoutNodeId,this.options.columnHierarchyType,this.options.columnHierarchyType!=="grid"?(C=this.options.columnExpandLevel)!==null&&C!==void 0?C:1:void 0)),t.rowTree?M.hasHideNode&&(Me(M.tree.children,t.indicators,!0,this),M.reset(M.tree.children)):(t.indicatorsAsCol===!1&&(this.dataset.rowHeaderTree=xe(this.dataset.rowHeaderTree,t.indicators)),t.indicatorsAsCol===!1&&this.dataset.rowHeaderTree&&t.indicators&&Me(this.dataset.rowHeaderTree,t.indicators,!1,this),M=new ge((_=this.dataset.rowHeaderTree)!==null&&_!==void 0?_:[],this.layoutNodeId,this.options.rowHierarchyType,this.options.rowHierarchyType!=="grid"?(p=this.options.rowExpandLevel)!==null&&p!==void 0?p:1:void 0)),this.internalProps.layoutMap=new ze(this,this.dataset,x,M)}if(this._changePivotSortStateBySortRules(),((P=(S=t.pivotSortState)===null||S===void 0?void 0:S.length)!==null&&P!==void 0?P:0)>0&&(this.pivotSortState=[],this.pivotSortState=t.pivotSortState),wt.mode!=="node"&&(this.editorManager=new Gi(this)),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.stateManager.initCheckedState(T),this.scenegraph.createSceneGraph(),t.title){const b=Oe.getComponent("title");this.internalProps.title=new b(t.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)(y=this.internalProps.emptyTip)===null||y===void 0||y.resetVisible();else{const b=Oe.getComponent("emptyTip");this.internalProps.emptyTip=new b(this.options.emptyTip,this),(I=this.internalProps.emptyTip)===null||I===void 0||I.resetVisible()}setTimeout(()=>{this.fireListeners(at.INITIALIZED,null)},0)}}static get EVENT_TYPE(){return mt}isListTable(){return!1}isPivotTable(){return!0}isPivotChart(){return!1}get recordsCount(){var e;return(e=this.records)===null||e===void 0?void 0:e.length}_canResizeColumn(e,t){const i=super._canResizeColumn(e,t);if(i){if(this.internalProps.layoutMap.isSeriesNumber(e,t)&&this.internalProps.rowSeriesNumber.disableColumnResize===!0)return!1;if(!this.internalProps.layoutMap.indicatorsAsCol){const r=this.internalProps.layoutMap.getBody(e,this.columnHeaderLevelCount);if(r!=null&&r.disableColumnResize)return!1}}return i}updateOption(e){var t,i,r,o,l,s,a,n,d,h,u,c,v,f,H,g,m,w,C,_,p,S,P,y,I,T;const b=this.internalProps;if(super.updateOption(e),e.rowHierarchyType||(e.rowHierarchyType="grid"),e.columnHierarchyType||(e.columnHierarchyType="grid"),this.layoutNodeId={seqId:0},this.internalProps.columns=Ce(e.columns),this.internalProps.rows=Ce(e.rows),this.internalProps.indicators=!((t=e.indicators)===null||t===void 0)&&t.length?dt(e.indicators):[],(i=e.indicators)===null||i===void 0||i.forEach((F,N)=>{typeof F=="object"&&(F!=null&&F.editor)&&(this.internalProps.indicators[N].editor=F.editor)}),this.internalProps.columnTree=!e.indicatorsAsCol||!((r=e.columns)===null||r===void 0)&&r.length||e.columnTree?Ce(e.columnTree):[],this.internalProps.rowTree=e.indicatorsAsCol||!((o=e.rows)===null||o===void 0)&&o.length||e.rowTree?Ce(e.rowTree):[],e.records&&(this.internalProps.records=e.records),this.stateManager.initCheckedState(this.internalProps.records),this.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1),this.pagination=e.pagination,b.columnResizeType=(a=(s=(l=e.resize)===null||l===void 0?void 0:l.columnResizeType)!==null&&s!==void 0?s:e.columnResizeType)!==null&&a!==void 0?a:"column",b.rowResizeType=(h=(d=(n=e.resize)===null||n===void 0?void 0:n.rowResizeType)!==null&&d!==void 0?d:e.rowResizeType)!==null&&h!==void 0?h:"row",b.dataConfig=Ce(e.dataConfig),this.internalProps.columnWidthConfig=e.columnWidthConfig,this.internalProps.columnWidthConfigForRowHeader=e.columnWidthConfigForRowHeader,(e==null?void 0:e.rowHierarchyType)!=="grid"&&this.internalProps.layoutMap.rowHierarchyType!=="grid"&&this.internalProps.layoutMap.rowExpandLevel===(e==null?void 0:e.rowExpandLevel)){const F=this.internalProps.layoutMap.rowDimensionTree.tree.children;(u=this.internalProps.rowTree)===null||u===void 0||u.forEach((N,x)=>{const M=F.find(L=>L.dimensionKey===N.dimensionKey&&L.value===N.value);M&&this._syncHierarchyState(M,N)})}const A=this.internalProps.records;if(this.internalProps.recordsIsTwoDimensionalArray=!1,((c=A==null?void 0:A[0])===null||c===void 0?void 0:c.constructor)===Array&&(this.internalProps.recordsIsTwoDimensionalArray=!0),((v=e.customConfig)===null||v===void 0?void 0:v.enableDataAnalysis)===!1){let F,N;e.columnTree&&(F=new ge((f=this.internalProps.columnTree)!==null&&f!==void 0?f:[],this.layoutNodeId,this.options.columnHierarchyType,this.options.columnHierarchyType!=="grid"?(H=this.options.columnExpandLevel)!==null&&H!==void 0?H:1:void 0)),e.rowTree&&(N=new ge((g=this.internalProps.rowTree)!==null&&g!==void 0?g:[],this.layoutNodeId,this.options.rowHierarchyType,this.options.rowHierarchyType!=="grid"?(m=this.options.rowExpandLevel)!==null&&m!==void 0?m:1:void 0)),b.layoutMap=new ze(this,null,F,N),this.internalProps.recordsIsTwoDimensionalArray===!1&&(this.flatDataToObjects=new pt({rows:b.layoutMap.fullRowDimensionKeys,columns:b.layoutMap.colDimensionKeys,indicators:b.layoutMap.indicatorKeys,indicatorsAsCol:b.layoutMap.indicatorsAsCol,indicatorDimensionKey:b.layoutMap.indicatorDimensionKey},A))}else{const F=Ot(this,e),{rowKeys:N,columnKeys:x,indicatorKeys:M}=F;let{columnDimensionTree:L,rowDimensionTree:K}=F;this.dataset=new ut(b.dataConfig,N,x,M,this.internalProps.indicators,(w=e.indicatorsAsCol)===null||w===void 0||w,A,e.rowHierarchyType,e.columnHierarchyType,this.internalProps.columnTree,this.internalProps.rowTree,!1,!!e.extensionRows,!!e.parseCustomTreeToMatchRecords),e.columnTree?L.hasHideNode&&(Me(L.tree.children,e.indicators,!0,this),L.reset(L.tree.children)):(e.indicatorsAsCol!==!1&&(this.dataset.colHeaderTree=xe(this.dataset.colHeaderTree,e.indicators)),e.indicatorsAsCol!==!1&&e.indicators&&this.dataset.colHeaderTree&&Me(this.dataset.colHeaderTree,e.indicators,!1,this),L=new ge((C=this.dataset.colHeaderTree)!==null&&C!==void 0?C:[],this.layoutNodeId,this.options.columnHierarchyType,this.options.columnHierarchyType!=="grid"?(_=this.options.columnExpandLevel)!==null&&_!==void 0?_:1:void 0)),e.rowTree?K.hasHideNode&&(Me(K.tree.children,e.indicators,!0,this),K.reset(K.tree.children)):(e.indicatorsAsCol===!1&&(this.dataset.rowHeaderTree=xe(this.dataset.rowHeaderTree,e.indicators)),e.indicatorsAsCol===!1&&this.dataset.rowHeaderTree&&e.indicators&&Me(this.dataset.rowHeaderTree,e.indicators,!1,this),K=new ge((p=this.dataset.rowHeaderTree)!==null&&p!==void 0?p:[],this.layoutNodeId,this.options.rowHierarchyType,this.options.rowHierarchyType!=="grid"?(S=this.options.rowExpandLevel)!==null&&S!==void 0?S:1:void 0)),b.layoutMap=new ze(this,this.dataset,L,K)}if(this._changePivotSortStateBySortRules(),((y=(P=e.pivotSortState)===null||P===void 0?void 0:P.length)!==null&&y!==void 0?y:0)>0&&(this.pivotSortState=[],this.pivotSortState=e.pivotSortState),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,b.releaseList&&(b.releaseList.forEach(F=>{var N;return(N=F==null?void 0:F.release)===null||N===void 0?void 0:N.call(F)}),b.releaseList=null),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph(),e.title){const F=Oe.getComponent("title");this.internalProps.title=new F(e.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)(I=this.internalProps.emptyTip)===null||I===void 0||I.resetVisible();else{const F=Oe.getComponent("emptyTip");this.internalProps.emptyTip=new F(this.options.emptyTip,this),(T=this.internalProps.emptyTip)===null||T===void 0||T.resetVisible()}return new Promise(F=>{setTimeout(F,0)})}updatePagination(e){e?(this.pagination||(this.pagination={currentPage:0,perPageCount:0}),typeof e.currentPage=="number"&&e.currentPage>=0&&(this.pagination.currentPage=e.currentPage),e.perPageCount&&(this.pagination.perPageCount=e.perPageCount||this.pagination.perPageCount),this.scenegraph.clearCells(),this.internalProps.layoutMap.setPagination(this.pagination),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()):this.pagination&&(this.pagination=void 0,this.scenegraph.clearCells(),this.internalProps.layoutMap.setPagination(void 0),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render())}refreshHeader(){this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){var e,t,i,r,o,l,s,a;const n=this,{layoutMap:d}=n.internalProps;d&&(n.colCount=(e=d.colCount)!==null&&e!==void 0?e:0,n.rowCount=(t=d.rowCount)!==null&&t!==void 0?t:0,this.internalProps.frozenColCount=this.options.frozenColCount?this.options.frozenColCount:((i=d.rowHeaderLevelCount)!==null&&i!==void 0?i:0)+d.leftRowSeriesNumberColumnCount,n.frozenRowCount=Math.max(d.headerLevelCount,(r=this.options.frozenRowCount)!==null&&r!==void 0?r:0),n.bottomFrozenRowCount!==((o=this.options.bottomFrozenRowCount)!==null&&o!==void 0?o:0)&&(n.bottomFrozenRowCount=(l=this.options.bottomFrozenRowCount)!==null&&l!==void 0?l:0),n.rightFrozenColCount!==((s=this.options.rightFrozenColCount)!==null&&s!==void 0?s:0)&&(n.rightFrozenColCount=(a=this.options.rightFrozenColCount)!==null&&a!==void 0?a:0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount),this.stateManager.setFrozenRow(this.frozenRowCount))}_getSortFuncFromHeaderOption(e,t,i){}get rowHierarchyType(){return this.internalProps.layoutMap.rowHierarchyType}get columnHierarchyType(){return this.internalProps.layoutMap.columnHierarchyType}_syncHierarchyState(e,t){var i,r;e.value===t.value&&e.dimensionKey===t.dimensionKey&&(t.hierarchyState=(i=t.hierarchyState)!==null&&i!==void 0?i:t!=null&&t.children?e.hierarchyState:void 0,(r=t==null?void 0:t.children)===null||r===void 0||r.forEach((o,l)=>{var s;if(!((s=e==null?void 0:e.children)===null||s===void 0)&&s[l]&&o){const a=e.children.find(n=>n.dimensionKey===o.dimensionKey&&n.value===o.value);a&&this._syncHierarchyState(a,o)}}))}getRecordShowIndexByCell(e,t){}getTableIndexByRecordIndex(e){}getTableIndexByField(e){}getCellAddrByFieldRecord(e,t){}getBodyIndexByRow(e){const{layoutMap:t}=this.internalProps;return t.getBodyIndexByRow(e)}getBodyIndexByCol(e){const{layoutMap:t}=this.internalProps;return t.getBodyIndexByCol(e)}getFieldData(e,t,i){var r,o,l;if(!this.internalProps.layoutMap.isHeader(t,i)){if(this.internalProps.recordsIsTwoDimensionalArray){const s=this.getBodyIndexByRow(i),a=this.getBodyIndexByCol(t);return(r=this.records[s])===null||r===void 0?void 0:r[a]}if(this.dataset){const s=this.internalProps.layoutMap.getCellHeaderPaths(t,i);if(s){let a;const n=(o=s.colHeaderPaths)===null||o===void 0?void 0:o.filter(u=>!u.virtual).map((u,c)=>{var v;return u.indicatorKey&&(a={position:"col",index:c}),(v=u.indicatorKey)!==null&&v!==void 0?v:u.value}),d=(l=s.rowHeaderPaths)===null||l===void 0?void 0:l.filter(u=>!u.virtual).map((u,c)=>{var v;return u.indicatorKey&&(a={position:"row",index:c}),(v=u.indicatorKey)!==null&&v!==void 0?v:u.value}),h=this.dataset.getAggregator(d,n,this.internalProps.layoutMap.getIndicatorKey(t,i),!0,a);if(h.records&&h.records.length>=1)return h.records[0][e]}}else if(this.flatDataToObjects){const s=this.internalProps.layoutMap.getCellHeaderPaths(t,i),a=s.colHeaderPaths.map(h=>{var u;return(u=h.indicatorKey)!==null&&u!==void 0?u:h.value}),n=s.rowHeaderPaths.map(h=>{var u;return(u=h.indicatorKey)!==null&&u!==void 0?u:h.value}),d=this.flatDataToObjects.getTreeNode(n,a,this.internalProps.layoutMap.getBody(t,i).indicatorKey,!1);if(d!=null&&d.record)return d==null?void 0:d.record[e]}}}getCellValue(e,t,i){var r,o,l,s,a,n,d;if(!i){const h=this.getCustomMergeValue(e,t);if(h)return h}if(this.internalProps.layoutMap.isSeriesNumber(e,t)){if(this.internalProps.layoutMap.isSeriesNumberInHeader(e,t)){const{title:u}=this.internalProps.layoutMap.getSeriesNumberHeader(e,t);return u}const{format:h}=this.internalProps.layoutMap.getSeriesNumberBody(e,t);return typeof h=="function"?h(e,t,this):t-this.columnHeaderLevelCount+1}if(this.internalProps.layoutMap.isHeader(e,t)){const{title:h,fieldFormat:u}=this.internalProps.layoutMap.getHeader(e,t);return typeof u=="function"?u(h,e,t,this):h}if(this.internalProps.recordsIsTwoDimensionalArray){const{fieldFormat:h}=this.internalProps.layoutMap.getBody(e,t),u=this.getBodyIndexByRow(t),c=this.getBodyIndexByCol(e),v=(r=this.records[u])===null||r===void 0?void 0:r[c];return typeof h=="function"?h(v,e,t,this):v}if(this.dataset){const h=this.internalProps.layoutMap.getCellHeaderPaths(e,t);let u;const c=(l=(o=h.colHeaderPaths)===null||o===void 0?void 0:o.filter(g=>!g.virtual))===null||l===void 0?void 0:l.map((g,m)=>{var w;return g.indicatorKey&&(u={position:"col",index:m}),(w=g.indicatorKey)!==null&&w!==void 0?w:g.value}),v=(a=(s=h.rowHeaderPaths)===null||s===void 0?void 0:s.filter(g=>!g.virtual))===null||a===void 0?void 0:a.map((g,m)=>{var w;return g.indicatorKey&&(u={position:"row",index:m}),(w=g.indicatorKey)!==null&&w!==void 0?w:g.value}),f=this.dataset.getAggregator(v,c,this.internalProps.layoutMap.getIndicatorKey(e,t),!0,u),{fieldFormat:H}=this.internalProps.layoutMap.getBody(e,t);return f.formatValue?f.formatValue(e,t,this):typeof H=="function"?H(f==null?void 0:f.value(),e,t,this):(n=f==null?void 0:f.value())!==null&&n!==void 0?n:""}if(this.flatDataToObjects){const h=this.internalProps.layoutMap.getCellHeaderPaths(e,t),u=h.colHeaderPaths.map(H=>{var g;return(g=H.indicatorKey)!==null&&g!==void 0?g:H.value}),c=h.rowHeaderPaths.map(H=>{var g;return(g=H.indicatorKey)!==null&&g!==void 0?g:H.value}),v=this.flatDataToObjects.getTreeNode(c,u,this.internalProps.layoutMap.getBody(e,t).indicatorKey),{fieldFormat:f}=this.internalProps.layoutMap.getBody(e,t);return typeof f=="function"?f(v==null?void 0:v.value,e,t,this):(d=v==null?void 0:v.value)!==null&&d!==void 0?d:""}}getCellOriginValue(e,t){var i,r,o;const l=this;if(l.internalProps.layoutMap.isHeader(e,t)){const{title:s}=l.internalProps.layoutMap.getHeader(e,t);return typeof s=="function"?s():s}if(this.internalProps.recordsIsTwoDimensionalArray){const s=this.getBodyIndexByRow(t),a=this.getBodyIndexByCol(e);return(i=this.records[s])===null||i===void 0?void 0:i[a]}if(this.dataset){let s;const a=this.internalProps.layoutMap.getCellHeaderPaths(e,t),n=(r=a.colHeaderPaths)===null||r===void 0?void 0:r.filter(u=>!u.virtual).map((u,c)=>{var v;return u.indicatorKey&&(s={position:"col",index:c}),(v=u.indicatorKey)!==null&&v!==void 0?v:u.value}),d=(o=a.rowHeaderPaths)===null||o===void 0?void 0:o.filter(u=>!u.virtual).map((u,c)=>{var v;return u.indicatorKey&&(s={position:"row",index:c}),(v=u.indicatorKey)!==null&&v!==void 0?v:u.value}),h=this.dataset.getAggregator(d,n,this.internalProps.layoutMap.getIndicatorKey(e,t),!0,s);return h.value?h.value():void 0}if(this.flatDataToObjects){const s=this.internalProps.layoutMap.getCellHeaderPaths(e,t),a=s.colHeaderPaths.map(h=>{var u;return(u=h.indicatorKey)!==null&&u!==void 0?u:h.value}),n=s.rowHeaderPaths.map(h=>{var u;return(u=h.indicatorKey)!==null&&u!==void 0?u:h.value}),d=this.flatDataToObjects.getTreeNode(n,a,this.internalProps.layoutMap.getBody(e,t).indicatorKey);return d==null?void 0:d.value}}getCellRawValue(e,t){var i,r,o;const l=this;if(l.internalProps.layoutMap.isHeader(e,t)){const{title:s}=l.internalProps.layoutMap.getHeader(e,t);return typeof s=="function"?s():s}if(this.internalProps.recordsIsTwoDimensionalArray){const s=this.getBodyIndexByRow(t),a=this.getBodyIndexByCol(e);return(i=this.records[s])===null||i===void 0?void 0:i[a]}if(this.dataset){let s;const a=this.internalProps.layoutMap.getCellHeaderPaths(e,t),n=(r=a.colHeaderPaths)===null||r===void 0?void 0:r.filter(u=>!u.virtual).map((u,c)=>{var v;return u.indicatorKey&&(s={position:"col",index:c}),(v=u.indicatorKey)!==null&&v!==void 0?v:u.value}),d=(o=a.rowHeaderPaths)===null||o===void 0?void 0:o.filter(u=>!u.virtual).map((u,c)=>{var v;return u.indicatorKey&&(s={position:"row",index:c}),(v=u.indicatorKey)!==null&&v!==void 0?v:u.value}),h=this.dataset.getAggregator(d,n,this.internalProps.layoutMap.getIndicatorKey(e,t),!1,s);return h.value?h.value():void 0}if(this.flatDataToObjects){const s=this.internalProps.layoutMap.getCellHeaderPaths(e,t),a=s.colHeaderPaths.map(h=>{var u;return(u=h.indicatorKey)!==null&&u!==void 0?u:h.value}),n=s.rowHeaderPaths.map(h=>{var u;return(u=h.indicatorKey)!==null&&u!==void 0?u:h.value}),d=this.flatDataToObjects.getTreeNode(n,a,this.internalProps.layoutMap.getBody(e,t).indicatorKey,!1);return d==null?void 0:d.value}}getCellOriginRecord(e,t){var i,r,o;if(!this.internalProps.layoutMap.isHeader(e,t)){if(this.internalProps.recordsIsTwoDimensionalArray){const l=this.getBodyIndexByRow(t),s=this.getBodyIndexByCol(e);return(i=this.records[l])===null||i===void 0?void 0:i[s]}if(this.dataset){let l;const s=this.internalProps.layoutMap.getCellHeaderPaths(e,t),a=(r=s.colHeaderPaths)===null||r===void 0?void 0:r.filter(d=>!d.virtual).map((d,h)=>{var u;return d.indicatorKey&&(l={position:"col",index:h}),(u=d.indicatorKey)!==null&&u!==void 0?u:d.value}),n=(o=s.rowHeaderPaths)===null||o===void 0?void 0:o.filter(d=>!d.virtual).map((d,h)=>{var u;return d.indicatorKey&&(l={position:"row",index:h}),(u=d.indicatorKey)!==null&&u!==void 0?u:d.value});return this.dataset.getAggregator(n,a,this.internalProps.layoutMap.getIndicatorKey(e,t),!0,l).records}if(this.flatDataToObjects){const l=this.internalProps.layoutMap.getCellHeaderPaths(e,t),s=l.colHeaderPaths.map(d=>{var h;return(h=d.indicatorKey)!==null&&h!==void 0?h:d.value}),a=l.rowHeaderPaths.map(d=>{var h;return(h=d.indicatorKey)!==null&&h!==void 0?h:d.value}),n=this.flatDataToObjects.getTreeNode(a,s,this.internalProps.layoutMap.getBody(e,t).indicatorKey);return n==null?void 0:n.record}}}getCellRawRecord(e,t){var i,r,o;if(!this.internalProps.layoutMap.isHeader(e,t)){if(this.internalProps.recordsIsTwoDimensionalArray){const l=this.getBodyIndexByRow(t),s=this.getBodyIndexByCol(e);return(i=this.records[l])===null||i===void 0?void 0:i[s]}if(this.dataset){let l;const s=this.internalProps.layoutMap.getCellHeaderPaths(e,t),a=(r=s.colHeaderPaths)===null||r===void 0?void 0:r.filter(d=>!d.virtual).map((d,h)=>{var u;return d.indicatorKey&&(l={position:"col",index:h}),(u=d.indicatorKey)!==null&&u!==void 0?u:d.value}),n=(o=s.rowHeaderPaths)===null||o===void 0?void 0:o.filter(d=>!d.virtual).map((d,h)=>{var u;return d.indicatorKey&&(l={position:"row",index:h}),(u=d.indicatorKey)!==null&&u!==void 0?u:d.value});return this.dataset.getAggregator(n,a,this.internalProps.layoutMap.getIndicatorKey(e,t),!1,l).records}if(this.flatDataToObjects){const l=this.internalProps.layoutMap.getCellHeaderPaths(e,t),s=l.colHeaderPaths.map(d=>{var h;return(h=d.indicatorKey)!==null&&h!==void 0?h:d.value}),a=l.rowHeaderPaths.map(d=>{var h;return(h=d.indicatorKey)!==null&&h!==void 0?h:d.value}),n=this.flatDataToObjects.getTreeNode(a,s,this.internalProps.layoutMap.getBody(e,t).indicatorKey,!1);return n==null?void 0:n.record}}}updateSortRules(e,t,i){this.internalProps.dataConfig?this.internalProps.dataConfig.sortRules=e:this.internalProps.dataConfig={sortRules:e},this.dataset.updateSortRules(e),this._changePivotSortStateBySortRules();const{layoutMap:r}=this.internalProps;r.resetHeaderTree(),this.scenegraph.clearCells(),ht(t)&&ht(i)?(this.isRowHeader(t,i)?(this.setMinMaxLimitWidth(!0),this.internalProps._widthResizedColMap.clear()):this.isCornerHeader(t,i)?r.cornerSetting.titleOnDimension==="column"?(this.setMinMaxLimitWidth(!0),this.internalProps._widthResizedColMap.clear()):r.cornerSetting.titleOnDimension==="row"&&this.internalProps._heightResizedRowMap.clear():this.isColumnHeader(t,i)&&this.internalProps._heightResizedRowMap.clear(),this.refreshRowColCount()):this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.createSceneGraph(!0),this.render()}_changePivotSortStateBySortRules(){var e,t,i,r;this.pivotSortState=[];const o=(t=(e=this.internalProps.dataConfig)===null||e===void 0?void 0:e.sortRules)!==null&&t!==void 0?t:[];for(let l=0;l<o.length;l++){const s=o[l],a=[];if(s.sortByIndicator&&s.sortField===(this.dataset.indicatorsAsCol?this.dataset.rows[this.dataset.rows.length-1]:this.dataset.columns[this.dataset.columns.length-1])){for(let d=0;d<s.query.length;d++)a.push({dimensionKey:this.dataset.indicatorsAsCol?this.dataset.columns[d]:this.dataset.rows[d],value:s.query[d]});a.push({indicatorKey:s.sortByIndicator,value:(r=(i=this.internalProps.layoutMap.getIndicatorInfo(s.sortByIndicator))===null||i===void 0?void 0:i.title)!==null&&r!==void 0?r:s.sortByIndicator})}else a.push({dimensionKey:s.sortField,isPivotCorner:!0,value:s.sortField});const n=s.sortType?s.sortType.toUpperCase():"ASC";this.pivotSortState.push({dimensions:a,order:tt[n]})}}_parseColumnWidthConfig(e){for(let t=0;t<(e==null?void 0:e.length);t++){const i=e[t],r=i.dimensions,o=i.width,l=this.getCellAddressByHeaderPaths(r);if(l&&l.col>=this.rowHeaderLevelCount){const s=this.getCellHeaderPaths(l.col,this.columnHeaderLevelCount);if(s.colHeaderPaths.length===r.length){let a=!0;for(let n=0;n<r.length;n++){const d=r[n];if(s.colHeaderPaths.findIndex((h,u)=>h.indicatorKey===d.indicatorKey||h.dimensionKey===d.dimensionKey&&h.value===d.value)<0){a=!1;break}}a&&!this.internalProps._widthResizedColMap.has(l.col)&&(this._setColWidth(l.col,o),this.internalProps._widthResizedColMap.add(l.col))}}else l&&l.col<this.rowHeaderLevelCount&&(this.internalProps._widthResizedColMap.has(l.col)||(this._setColWidth(l.col,o),this.internalProps._widthResizedColMap.add(l.col)))}}_parseColumnWidthConfigForRowHeader(e){for(let t=0;t<(e==null?void 0:e.length);t++){const i=e[t],r=i.dimensions,o=i.width,l=this.getCellAddressByHeaderPaths(r);l&&l.col<this.rowHeaderLevelCount&&(this.internalProps._widthResizedColMap.has(l.col)||(this._setColWidth(l.col,o),this.internalProps._widthResizedColMap.add(l.col)))}}updatePivotSortState(e){this.pivotSortState=e}sort(e,t,i){var r;let o;if(this.isCornerHeader(e,t)){const a=this.getHeaderDefine(e,t);o=[];const n={isPivotCorner:!0,dimensionKey:a.value,value:a.value};o.push(n)}else o=this.isColumnHeader(e,t)?this.getCellHeaderPaths(e,t).colHeaderPaths:this.getCellHeaderPaths(e,t).rowHeaderPaths;const l=o[o.length-1].indicatorKey,s=this.getHeaderDefine(e,t);if(s.sort){if(this.dataset.sortRules){const a={};for(let n=this.dataset.sortRules.length-1;n>=0;n--){const d=this.dataset.sortRules[n];s.dimensionKey&&d.sortField===s.dimensionKey?(a[d.sortField]=d,this.dataset.sortRules.splice(n,1)):l&&d.sortField===(this.dataset.indicatorsAsCol?this.dataset.rows[this.dataset.rows.length-1]:this.dataset.columns[this.dataset.columns.length-1])&&this.dataset.sortRules.splice(n,1)}l?this.dataset.sortRules.push({sortField:this.dataset.indicatorsAsCol?this.dataset.rows[this.dataset.rows.length-1]:this.dataset.columns[this.dataset.columns.length-1],sortType:tt[i],sortByIndicator:l,query:o.reduce((n,d)=>(d.dimensionKey&&n.push(d.value),n),[])}):this.dataset.sortRules.push(Object.assign((r=a[s.dimensionKey])!==null&&r!==void 0?r:{},{sortField:s.dimensionKey,sortType:tt[i]}))}else this.dataset.sortRules=l?[{sortField:this.dataset.indicatorsAsCol?this.dataset.rows[this.dataset.rows.length-1]:this.dataset.columns[this.dataset.columns.length-1],sortType:tt[i],sortByIndicator:l,query:o.reduce((a,n)=>(n.dimensionKey&&a.push(n.value),a),[])}]:[{sortField:s.dimensionKey,sortType:tt[i]}];this.updateSortRules(this.dataset.sortRules,e,t)}}getPivotSortState(e,t){if(!this.pivotSortState)return;const i=this.getCellRange(e,t);for(let r=0;r<this.pivotSortState.length;r++){const o=this.pivotSortState[r],l=o.dimensions,s=this.getCellAddressByHeaderPaths(l),a=o.order;if(s&&Jt(i,s.col,s.row))return a}}_moveHeaderPosition(e,t){const i=this.getCellRange(e.col,e.row),r=this.getCellRange(t.col,t.row),o=this.internalProps.layoutMap.moveHeaderPosition(e,t);if(o){if(o.moveType==="column"){if(this.internalProps.recordsIsTwoDimensionalArray)for(let l=0;l<this.internalProps.records.length;l++){const s=this.internalProps.records[l].splice(o.sourceIndex-this.rowHeaderLevelCount,o.sourceSize);s.unshift(o.targetIndex-this.rowHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records[l],s)}this.colWidthsMap.exchangeOrder(i.start.col,i.end.col-i.start.col+1,r.start.col,r.end.col-r.start.col+1,o.targetIndex),this.setMinMaxLimitWidth()}else if(o.moveType==="row"){if(this.internalProps.recordsIsTwoDimensionalArray){const l=this.internalProps.records.splice(o.sourceIndex-this.columnHeaderLevelCount,o.sourceSize);l.unshift(o.targetIndex-this.columnHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records,l)}o.targetIndex>o.sourceIndex?this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex+o.sourceSize-o.targetSize,o.targetSize,o.targetIndex):this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex,o.targetSize,o.targetIndex)}return o}return null}toggleHierarchyState(e,t,i=!0){const r=this.getHierarchyState(e,t);if(r===Ee.expand)this._refreshHierarchyState(e,t,i),this.fireListeners(mt.TREE_HIERARCHY_STATE_CHANGE,{col:e,row:t,hierarchyState:Ee.collapse});else if(r===Ee.collapse){const o=this.internalProps.layoutMap.getHeadNode(e,t);Array.isArray(o.children)&&this._refreshHierarchyState(e,t,i),this.fireListeners(mt.TREE_HIERARCHY_STATE_CHANGE,{col:e,row:t,hierarchyState:Ee.expand,originData:o})}}_refreshHierarchyState(e,t,i=!0,r){var o,l;this.frozenColCount,this.frozenRowCount;const s=this.getBodyVisibleRowRange().rowStart;this.internalProps._oldRowCount=this.rowCount,this.internalProps._oldColCount=this.colCount;let a=!1,n=!1;this.stateManager.updateHoverIcon(e,t,void 0,void 0);const d=this.internalProps.layoutMap.checkHasChart();d&&(this.autoFillWidth&&(a=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(n=this.getAllRowsHeight()<=this.tableNoFrameHeight));const h=this.internalProps.layoutMap.isRowHeader(e,t)?this.internalProps.layoutMap.toggleHierarchyState(e,t):this.internalProps.layoutMap.toggleHierarchyStateForColumnTree(e,t);r&&r(),this.refreshRowColCount(),this.frozenColCount,this.frozenRowCount,this.clearCellStyleCache(),this.rowHierarchyType==="tree"&&this.scenegraph.updateHierarchyIcon(e,t),(o=this.reactCustomLayout)===null||o===void 0||o.clearCache(),this.rowHierarchyType!=="grid-tree"&&this.columnHierarchyType!=="grid-tree"?this.scenegraph.updateRow(h.removeCellPositionsRowDirection,h.addCellPositionsRowDirection,h.updateCellPositionsRowDirection,i):(this.internalProps.stick.changedCells.clear(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.scrollToRow(s)),(l=this.reactCustomLayout)===null||l===void 0||l.updateAllCustomCell(),d&&(this.autoFillWidth&&!a&&(a=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!n&&(n=this.getAllRowsHeight()<=this.tableNoFrameHeight),(this.widthMode==="adaptive"||a||this.heightMode==="adaptive"||n)&&this.scenegraph.updateChartSizeForResizeColWidth(-1)),this.internalProps._oldRowCount=void 0,this.internalProps._oldColCount=void 0}getHeaderCellAddressByPath(e){return this.internalProps.layoutMap.getPivotCellAdress(e)}getCellAddressByHeaderPaths(e){return this.internalProps.layoutMap.getCellAdressByHeaderPath(e)}getHeaderPathByXY(e){let t;return t=e?this.getCellAt(e.x+this.getFrozenColsWidth()+this.scrollLeft+1,e.y+this.getFrozenRowsHeight()+this.scrollTop+1):this.getCellAt(this.getFrozenColsWidth()+this.scrollLeft+1,this.getFrozenRowsHeight()+this.scrollTop+1),this.internalProps.layoutMap.getCellHeaderPaths(t.col,t.row)}getHierarchyState(e,t){var i;return(i=this._getHeaderLayoutMap(e,t))===null||i===void 0?void 0:i.hierarchyState}getLayoutColumnTree(){return this.internalProps.layoutMap.getLayoutColumnTree()}getLayoutColumnTreeCount(){return this.internalProps.layoutMap.getLayoutColumnTreeCount()}getLayoutRowTree(){return this.internalProps.layoutMap.getLayoutRowTree()}getLayoutRowTreeCount(){return this.internalProps.layoutMap.getLayoutRowTreeCount()}getCellHeaderTreeNodes(e,t){return this.internalProps.layoutMap.getCellHeaderPathsWithTreeNode(e,t)}getMenuInfo(e,t,i){const r=this.internalProps.layoutMap.getPivotDimensionInfo(e,t);return{dimensionKey:r[r.length-1].dimensionKey,value:this.getCellValue(e,t),cellLocation:this.getCellLocation(e,t),isPivotCorner:this.isCornerHeader(e,t),event:void 0}}setRecords(e){var t,i,r,o,l,s,a,n;const d={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.options.records=this.internalProps.records=e,this.internalProps.recordsIsTwoDimensionalArray=!1,((t=e==null?void 0:e[0])===null||t===void 0?void 0:t.constructor)===Array&&(this.internalProps.recordsIsTwoDimensionalArray=!0);const h=this.options,u=this.internalProps;if(((i=this.options.customConfig)===null||i===void 0?void 0:i.enableDataAnalysis)===!1)this.internalProps.recordsIsTwoDimensionalArray===!1&&(this.flatDataToObjects=new pt({rows:u.layoutMap.fullRowDimensionKeys,columns:u.layoutMap.colDimensionKeys,indicators:u.layoutMap.indicatorKeys,indicatorsAsCol:u.layoutMap.indicatorsAsCol,indicatorDimensionKey:u.layoutMap.indicatorDimensionKey},e));else{let c,v;this.dataset.setRecords(e),h.columnTree?c=u.layoutMap.columnDimensionTree:(h.indicatorsAsCol!==!1&&h.indicators&&this.dataset.colHeaderTree&&Me(this.dataset.colHeaderTree,h.indicators,!1,this),c=new ge((r=this.dataset.colHeaderTree)!==null&&r!==void 0?r:[],this.layoutNodeId,this.options.columnHierarchyType,this.options.columnHierarchyType!=="grid"?(o=this.options.columnExpandLevel)!==null&&o!==void 0?o:1:void 0)),h.rowTree?v=u.layoutMap.rowDimensionTree:(h.indicatorsAsCol===!1&&this.dataset.rowHeaderTree&&h.indicators&&Me(this.dataset.rowHeaderTree,h.indicators,!1,this),v=new ge((l=this.dataset.rowHeaderTree)!==null&&l!==void 0?l:[],this.layoutNodeId,this.options.rowHierarchyType,this.options.rowHierarchyType!=="grid"?(s=this.options.rowExpandLevel)!==null&&s!==void 0?s:1:void 0)),u.layoutMap=new ze(this,this.dataset,c,v),this.pivotSortState=[],h.pivotSortState&&(this.pivotSortState=h.pivotSortState)}if(this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(d.col,d.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.eventManager.updateEventBinder(),this.options.emptyTip)if(this.internalProps.emptyTip)(a=this.internalProps.emptyTip)===null||a===void 0||a.resetVisible();else{const c=Oe.getComponent("emptyTip");this.internalProps.emptyTip=new c(this.options.emptyTip,this),(n=this.internalProps.emptyTip)===null||n===void 0||n.resetVisible()}}startEditCell(e,t,i){var r;if(O(e)&&O(t))this.eventManager.isDraging=!1,this.selectCell(e,t),this.editorManager.startEditCell(e,t,i);else if(!((r=this.stateManager.select)===null||r===void 0)&&r.cellPos){const{col:o,row:l}=this.stateManager.select.cellPos;O(o)&&O(l)&&this.editorManager.startEditCell(o,l,i)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(e,t){var i,r,o;let l;if(this.isCornerHeader(e,t)){const s=this.getHeaderDefine(e,t);l=(i=s==null?void 0:s.headerEditor)!==null&&i!==void 0?i:this.options.headerEditor}else if(this.isHeader(e,t)){const s=this.getHeaderDefine(e,t);l=(r=s==null?void 0:s.headerEditor)!==null&&r!==void 0?r:this.options.headerEditor}else{const s=this.getBodyColumnDefine(e,t);l=(o=s==null?void 0:s.editor)!==null&&o!==void 0?o:this.options.editor}return typeof l=="function"&&(l=l({col:e,row:t,dataValue:this.getCellOriginValue(e,t),value:this.getCellValue(e,t)||"",table:this})),typeof l=="string"?Qi(l):l}isHasEditorDefine(e,t){var i;const r=this.getBodyColumnDefine(e,t);let o=(i=r==null?void 0:r.editor)!==null&&i!==void 0?i:this.options.editor;return typeof o=="function"&&(o=o({col:e,row:t,dataValue:this.getCellOriginValue(e,t),value:this.getCellValue(e,t)||"",table:this})),O(o)}changeCellValue(e,t,i,r=!1){if(r&&this.isHasEditorDefine(e,t)||r===!1){let o=i;const l=this.getCellOriginValue(e,t),s=this.getCellRawValue(e,t);typeof s=="number"&&zt(i)&&(o=parseFloat(i)),this._changeCellValueToDataSet(e,t,l,o);const a=this.getCellRange(e,t);for(let n=a.start.col;n<=a.end.col;n++)for(let d=a.start.row;d<=a.end.row;d++)this.scenegraph.updateCellContent(n,d);if(this.widthMode==="adaptive"||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)this.internalProps._widthResizedColMap.size===0&&this.scenegraph.recalculateColWidths();else if(!this.internalProps._widthResizedColMap.has(e)){const n=this.getColWidth(e),d=Nt(e,0,this.rowCount-1,this,!1);d!==n&&this.scenegraph.updateColWidth(e,d-n)}if(this.heightMode==="adaptive"||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)this.internalProps._heightResizedRowMap.size===0&&this.scenegraph.recalculateRowHeights();else if(this.isAutoRowHeight()&&!this.internalProps._heightResizedRowMap.has(t)){const n=this.getRowHeight(t),d=Bt(t,0,this.colCount-1,this);this.scenegraph.updateRowHeight(t,d-n)}l!==o&&this.fireListeners(at.CHANGE_CELL_VALUE,{col:e,row:t,rawValue:s,currentValue:l,changedValue:o}),this.scenegraph.updateNextFrame()}}changeCellValues(e,t,i,r=!1){let o=e,l=t;const s=[],a=[];for(let h=0;h<i.length&&!(t+h>this.rowCount-1);h++){const u=i[h],c=[],v=[];s.push(c),a.push(v);for(let f=0;f<u.length&&!(e+f>this.colCount-1);f++){const H=this.getCellRawValue(e+f,t+h);c.push(H);const g=this.getCellOriginValue(e+f,t+h);v.push(g)}}for(let h=0;h<i.length&&!(t+h>this.rowCount-1);h++){l=t+h;const u=i[h];let c=e;for(let v=0;v<u.length&&!(e+v>this.colCount-1);v++)if(c=e+v,r&&this.isHasEditorDefine(e+v,t+h)||r===!1){const f=u[v];let H=f;const g=a[h][v],m=s[h][v];typeof m=="number"&&zt(f)&&(H=parseFloat(f)),this._changeCellValueToDataSet(e+v,t+h,g,H);const w=this.getCellOriginValue(e+v,t+h);w!==g&&this.fireListeners(at.CHANGE_CELL_VALUE,{col:e+v,row:t+h,rawValue:m,currentValue:g,changedValue:w})}o=Math.max(o,c)}const n=this.getCellRange(e,t),d=this.getCellRange(o,l);for(let h=n.start.col;h<=d.end.col;h++)for(let u=n.start.row;u<=d.end.row;u++)this.scenegraph.updateCellContent(h,u);if(this.widthMode==="adaptive"||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)this.internalProps._widthResizedColMap.size===0&&this.scenegraph.recalculateColWidths();else for(let h=e;h<=d.end.col;h++)if(!this.internalProps._widthResizedColMap.has(h)){const u=this.getColWidth(h),c=Nt(h,0,this.rowCount-1,this,!1);c!==u&&this.scenegraph.updateColWidth(h,c-u)}if(this.heightMode==="adaptive"||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)this.scenegraph.recalculateRowHeights();else if(this.isAutoRowHeight()){const h=[],u=[];for(let c=t;c<=d.end.row;c++)if(this.rowHeightsMap.get(c)){const v=this.getRowHeight(c),f=Bt(c,0,this.colCount-1,this);h.push(c),u.push(f-v)}this.scenegraph.updateRowsHeight(h,u)}this.scenegraph.updateNextFrame()}_changeCellValueToDataSet(e,t,i,r){var o,l,s,a,n,d,h,u;if(this.internalProps.recordsIsTwoDimensionalArray){const c=this.getBodyIndexByRow(t),v=this.getBodyIndexByCol(e);this.records[c][v]=r}else if(this.dataset){const c=this.internalProps.layoutMap.getCellHeaderPaths(e,t);if(this.isCornerHeader(e,t))this.internalProps.layoutMap.changeCornerTitle(e,t,r);else if(this.isHeader(e,t))this.internalProps.layoutMap.changeTreeNodeTitle(e,t,r),!this.isCornerHeader(e,t)&&this.dataset.changeRecordFieldValue(!((o=c.colHeaderPaths)===null||o===void 0)&&o.length?(l=c.colHeaderPaths[c.colHeaderPaths.length-1].indicatorKey)!==null&&l!==void 0?l:c.colHeaderPaths[c.colHeaderPaths.length-1].dimensionKey:(s=c.rowHeaderPaths[c.rowHeaderPaths.length-1].indicatorKey)!==null&&s!==void 0?s:c.rowHeaderPaths[c.rowHeaderPaths.length-1].dimensionKey,i,r);else{const v=(a=c.colHeaderPaths)===null||a===void 0?void 0:a.filter(H=>!H.virtual).map(H=>{var g;return(g=H.indicatorKey)!==null&&g!==void 0?g:H.value}),f=(n=c.rowHeaderPaths)===null||n===void 0?void 0:n.filter(H=>!H.virtual).map(H=>{var g;return(g=H.indicatorKey)!==null&&g!==void 0?g:H.value});this.dataset.changeTreeNodeValue(this.internalProps.layoutMap.indicatorsAsCol?f:f.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?v.slice(0,-1):v,this.internalProps.layoutMap.getIndicatorKey(e,t),r)}}else if(this.flatDataToObjects){const c=this.internalProps.layoutMap.getCellHeaderPaths(e,t);if(this.isHeader(e,t))this.internalProps.layoutMap.changeTreeNodeTitle(e,t,r),!this.isCornerHeader(e,t)&&this.flatDataToObjects.changeRecordFieldValue(!((d=c.colHeaderPaths)===null||d===void 0)&&d.length?(h=c.colHeaderPaths[c.colHeaderPaths.length-1].indicatorKey)!==null&&h!==void 0?h:c.colHeaderPaths[c.colHeaderPaths.length-1].dimensionKey:(u=c.rowHeaderPaths[c.rowHeaderPaths.length-1].indicatorKey)!==null&&u!==void 0?u:c.rowHeaderPaths[c.rowHeaderPaths.length-1].dimensionKey,i,r);else{const v=c.colHeaderPaths.map(H=>{var g;return(g=H.indicatorKey)!==null&&g!==void 0?g:H.value}),f=c.rowHeaderPaths.map(H=>{var g;return(g=H.indicatorKey)!==null&&g!==void 0?g:H.value});this.flatDataToObjects.changeTreeNodeValue(f,v,this.internalProps.layoutMap.getBody(e,t).indicatorKey,r)}}}_hasCustomRenderOrLayout(){if(this.options.customRender)return!0;const{columnsDefine:e,rowsDefine:t,indicatorsDefine:i}=this.internalProps.layoutMap;for(let r=0;r<e.length;r++){const o=e[r];if(typeof o!="string"&&(o.headerCustomLayout||o.headerCustomRender))return!0}for(let r=0;r<t.length;r++){const o=t[r];if(typeof o!="string"&&(o.headerCustomLayout||o.headerCustomRender))return!0}for(let r=0;r<i.length;r++){const o=i[r];if(typeof o!="string"&&(o.customLayout||o.headerCustomLayout||o.customRender||o.headerCustomRender))return!0}return!1}changeRecordOrder(e,t){}setTreeNodeChildren(e,t,i,r){this.flatDataToObjects?(this.internalProps.layoutMap.getHeadNode(i,r).children=e,this._refreshHierarchyState(i,r,!0,()=>{this.flatDataToObjects.changeDataConfig({rows:this.internalProps.layoutMap.fullRowDimensionKeys,columns:this.internalProps.layoutMap.colDimensionKeys,indicators:this.internalProps.layoutMap.indicatorKeys,indicatorsAsCol:this.internalProps.layoutMap.indicatorsAsCol,indicatorDimensionKey:this.internalProps.layoutMap.indicatorDimensionKey}),this.flatDataToObjects.addRecords(t)})):(this.internalProps.layoutMap.getHeadNode(i,r).children=e,this._refreshHierarchyState(i,r,!0,()=>{this.dataset._rowTreeHasChanged(),this.dataset.changeDataConfig({rows:this.internalProps.layoutMap.fullRowDimensionKeys,columns:this.internalProps.layoutMap.colDimensionKeys}),this.dataset.addRecords(t)}))}updateFilterRules(e){this.internalProps.dataConfig.filterRules=e,this.dataset.updateFilterRules(e),this.renderWithRecreateCells()}getFilteredRecords(){var e;return(e=this.dataset)===null||e===void 0?void 0:e.filterRules}release(){this.editorManager.release(),super.release()}}$t(),Yt(),Xt(),Zt(),ei(),ti(),ii(),oi(),ri(),si(),li(),ni(),ai(),di();class Tt extends vo{}$t(),Yt(),Xt(),Zt(),ei(),ti(),ii(),oi(),ri(),si(),li(),ni(),ai(),di();class Pt extends Qt{constructor(e,t){var i,r,o,l,s,a,n,d,h,u,c,v,f,H,g,m,w,C,_,p,S,P,y,I;let T,b;wt.mode==="node"?(t=e,e=null):e instanceof HTMLElement||(t=e,e=e.container?e.container:null),super(e,t),this.layoutNodeId={seqId:0},this._selectedDataItemsInChart=[],this._selectedDimensionInChart=[],this._chartEventMap={},t.layout&&Object.assign(t,t.layout),this.internalProps.columns=Ce(t.columns),this.internalProps.rows=Ce(t.rows),this.internalProps.indicators=dt(t.indicators),this.internalProps.columnTree=!t.indicatorsAsCol||!((i=t.columns)===null||i===void 0)&&i.length||t.columnTree?Ce(t.columnTree):[],this.internalProps.rowTree=t.indicatorsAsCol||!((r=t.rows)===null||r===void 0)&&r.length||t.rowTree?Ce(t.rowTree):[],this.internalProps.records=t.records,this.setCustomStateNameToSpec(),this.internalProps.columnResizeType=(s=(l=(o=t.resize)===null||o===void 0?void 0:o.columnResizeType)!==null&&l!==void 0?l:t.columnResizeType)!==null&&s!==void 0?s:"column",this.internalProps.rowResizeType=(d=(n=(a=t.resize)===null||a===void 0?void 0:a.rowResizeType)!==null&&n!==void 0?n:t.rowResizeType)!==null&&d!==void 0?d:"row",this.internalProps.dataConfig={isPivotChart:!0},this._axes=Be(t.axes)?t.axes:[],t.columnTree&&(t.indicatorsAsCol!==!1&&(this.internalProps.columnTree=xe(this.internalProps.columnTree,t.indicators)),T=new ge((h=this.internalProps.columnTree)!==null&&h!==void 0?h:[],this.layoutNodeId)),t.rowTree&&(t.indicatorsAsCol===!1&&(this.internalProps.rowTree=xe(this.internalProps.rowTree,t.indicators)),b=new ge((u=this.internalProps.rowTree)!==null&&u!==void 0?u:[],this.layoutNodeId));const A=!((c=b==null?void 0:b.dimensionKeys)===null||c===void 0)&&c.count?b.dimensionKeys.valueArr():(f=(v=t.rows)===null||v===void 0?void 0:v.reduce((x,M)=>(typeof M=="string"?x.push(M):x.push(M.dimensionKey),x),[]))!==null&&f!==void 0?f:[],F=!((H=T==null?void 0:T.dimensionKeys)===null||H===void 0)&&H.count?T.dimensionKeys.valueArr():(m=(g=t.columns)===null||g===void 0?void 0:g.reduce((x,M)=>(typeof M=="string"?x.push(M):x.push(M.dimensionKey),x),[]))!==null&&m!==void 0?m:[],N=(C=(w=t.indicators)===null||w===void 0?void 0:w.reduce((x,M)=>(typeof M=="string"?x.push(M):x.push(M.indicatorKey),x),[]))!==null&&C!==void 0?C:[];if(this.internalProps.dataConfig.collectValuesBy=this._generateCollectValuesConfig(F,A),this.internalProps.dataConfig.aggregationRules=this._generateAggregationRules(),this.internalProps.dataConfig.dimensionSortArray=this._getDimensionSortArray(),this.dataset=new ut(this.internalProps.dataConfig,A,F,N,this.internalProps.indicators,(_=t.indicatorsAsCol)===null||_===void 0||_,t.records,void 0,void 0,this.internalProps.columnTree,this.internalProps.rowTree,!0),this.options.indicatorsAsCol&&st(this.internalProps.indicators)){const x=M=>{M.forEach(L=>{var K;!((K=L.children)===null||K===void 0)&&K.length?x(L.children):L.children=[{dimensionKey:"axis",value:""}]})};!((p=this.dataset.rowHeaderTree)===null||p===void 0)&&p.length?x(this.dataset.rowHeaderTree):this.dataset.rowHeaderTree=[{dimensionKey:"axis",value:""}]}if(t.columnTree||t.indicatorsAsCol!==!1&&(this.dataset.colHeaderTree=xe(this.dataset.colHeaderTree,t.indicators)),t.rowTree||t.indicatorsAsCol===!1&&(this.dataset.rowHeaderTree=xe(this.dataset.rowHeaderTree,t.indicators)),T=new ge((S=this.dataset.colHeaderTree)!==null&&S!==void 0?S:[],this.layoutNodeId),b=new ge((P=this.dataset.rowHeaderTree)!==null&&P!==void 0?P:[],this.layoutNodeId),this.internalProps.layoutMap=new ze(this,this.dataset,T,b),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.createSceneGraph(),t.title){const x=Oe.getComponent("title");this.internalProps.title=new x(t.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)(y=this.internalProps.emptyTip)===null||y===void 0||y.resetVisible();else{const x=Oe.getComponent("emptyTip");this.internalProps.emptyTip=new x(this.options.emptyTip,this),(I=this.internalProps.emptyTip)===null||I===void 0||I.resetVisible()}setTimeout(()=>{this.fireListeners(at.INITIALIZED,null)},0)}static get EVENT_TYPE(){return Ji}get pivotChartAxes(){return this._axes}get recordsCount(){var e;return(e=this.records)===null||e===void 0?void 0:e.length}isListTable(){return!1}isPivotTable(){return!0}isPivotChart(){return!0}_canResizeColumn(e,t){const i=super._canResizeColumn(e,t);if(i&&!this.internalProps.layoutMap.indicatorsAsCol){const r=this.internalProps.layoutMap.getBody(e,this.columnHeaderLevelCount);if(r!=null&&r.disableColumnResize)return!1}return i}updateOption(e){var t,i,r,o,l,s,a,n,d,h,u,c,v,f,H,g,m,w,C,_,p,S,P,y,I,T;const b=this.internalProps;let A,F;super.updateOption(e),this.layoutNodeId={seqId:0},this.internalProps.columns=Ce(e.columns),this.internalProps.rows=Ce(e.rows),this.internalProps.indicators=!((t=e.indicators)===null||t===void 0)&&t.length?dt(e.indicators):[],this.internalProps.columnTree=!e.indicatorsAsCol||!((i=e.columns)===null||i===void 0)&&i.length||e.columnTree?Ce(e.columnTree):[],this.internalProps.rowTree=e.indicatorsAsCol||!((r=e.rows)===null||r===void 0)&&r.length||e.rowTree?Ce(e.rowTree):[],e.records&&(this.internalProps.records=e.records),this.setCustomStateNameToSpec(),this._selectedDataItemsInChart=[],b.columnResizeType=(s=(l=(o=e.resize)===null||o===void 0?void 0:o.columnResizeType)!==null&&l!==void 0?l:e.columnResizeType)!==null&&s!==void 0?s:"column",b.rowResizeType=(d=(n=(a=e.resize)===null||a===void 0?void 0:a.rowResizeType)!==null&&n!==void 0?n:e.rowResizeType)!==null&&d!==void 0?d:"row",b.dataConfig={isPivotChart:!0},this._axes=Be(e.axes)?e.axes:[],e.columnTree&&(e.indicatorsAsCol!==!1&&(this.internalProps.columnTree=xe(this.internalProps.columnTree,e.indicators)),A=new ge((h=this.internalProps.columnTree)!==null&&h!==void 0?h:[],this.layoutNodeId)),e.rowTree&&(e.indicatorsAsCol===!1&&(this.internalProps.rowTree=xe(this.internalProps.rowTree,e.indicators)),F=new ge((u=this.internalProps.rowTree)!==null&&u!==void 0?u:[],this.layoutNodeId));const N=!((c=F==null?void 0:F.dimensionKeys)===null||c===void 0)&&c.count?F.dimensionKeys.valueArr():(f=(v=e.rows)===null||v===void 0?void 0:v.reduce((L,K)=>(typeof K=="string"?L.push(K):L.push(K.dimensionKey),L),[]))!==null&&f!==void 0?f:[],x=!((H=A==null?void 0:A.dimensionKeys)===null||H===void 0)&&H.count?A.dimensionKeys.valueArr():(m=(g=e.columns)===null||g===void 0?void 0:g.reduce((L,K)=>(typeof K=="string"?L.push(K):L.push(K.dimensionKey),L),[]))!==null&&m!==void 0?m:[],M=(C=(w=e.indicators)===null||w===void 0?void 0:w.reduce((L,K)=>(typeof K=="string"?L.push(K):L.push(K.indicatorKey),L),[]))!==null&&C!==void 0?C:[];if(this.internalProps.dataConfig.collectValuesBy=this._generateCollectValuesConfig(x,N),this.internalProps.dataConfig.aggregationRules=this._generateAggregationRules(),this.internalProps.dataConfig.dimensionSortArray=this._getDimensionSortArray(),this.dataset=new ut(this.internalProps.dataConfig,N,x,M,this.internalProps.indicators,(_=e.indicatorsAsCol)===null||_===void 0||_,(p=e.records)!==null&&p!==void 0?p:this.internalProps.records,void 0,void 0,this.internalProps.columnTree,this.internalProps.rowTree,!0),this.options.indicatorsAsCol&&st(this.internalProps.indicators)){const L=K=>{K.forEach(J=>{var $;!(($=J.children)===null||$===void 0)&&$.length?L(J.children):J.children=[{dimensionKey:"axis",value:""}]})};!((S=this.dataset.rowHeaderTree)===null||S===void 0)&&S.length?L(this.dataset.rowHeaderTree):this.dataset.rowHeaderTree=[{dimensionKey:"axis",value:""}]}if(e.columnTree||e.indicatorsAsCol!==!1&&(this.dataset.colHeaderTree=xe(this.dataset.colHeaderTree,e.indicators)),e.rowTree||e.indicatorsAsCol===!1&&(this.dataset.rowHeaderTree=xe(this.dataset.rowHeaderTree,e.indicators)),A=new ge((P=this.dataset.colHeaderTree)!==null&&P!==void 0?P:[],this.layoutNodeId),F=new ge((y=this.dataset.rowHeaderTree)!==null&&y!==void 0?y:[],this.layoutNodeId),b.layoutMap=new ze(this,this.dataset,A,F),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,b.releaseList&&(b.releaseList.forEach(L=>{var K;return(K=L==null?void 0:L.release)===null||K===void 0?void 0:K.call(L)}),b.releaseList=null),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph(),e.title){const L=Oe.getComponent("title");this.internalProps.title=new L(e.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)(I=this.internalProps.emptyTip)===null||I===void 0||I.resetVisible();else{const L=Oe.getComponent("emptyTip");this.internalProps.emptyTip=new L(this.options.emptyTip,this),(T=this.internalProps.emptyTip)===null||T===void 0||T.resetVisible()}return new Promise(L=>{setTimeout(L,0)})}updatePagination(){}refreshHeader(){this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){var e,t,i,r,o,l,s,a;const n=this,{layoutMap:d}=n.internalProps;d&&(n.colCount=(e=d.colCount)!==null&&e!==void 0?e:0,n.rowCount=(t=d.rowCount)!==null&&t!==void 0?t:0,n.internalProps.frozenColCount=(i=d.rowHeaderLevelCount)!==null&&i!==void 0?i:0,n.frozenRowCount=Math.max(d.headerLevelCount,(r=this.options.frozenRowCount)!==null&&r!==void 0?r:0),n.bottomFrozenRowCount!==((o=d==null?void 0:d.bottomFrozenRowCount)!==null&&o!==void 0?o:0)&&(n.bottomFrozenRowCount=(l=d==null?void 0:d.bottomFrozenRowCount)!==null&&l!==void 0?l:0),n.rightFrozenColCount!==((s=d==null?void 0:d.rightFrozenColCount)!==null&&s!==void 0?s:0)&&(n.rightFrozenColCount=(a=d==null?void 0:d.rightFrozenColCount)!==null&&a!==void 0?a:0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount))}_getSortFuncFromHeaderOption(e,t,i){}syncHierarchyState(e,t){var i,r;e.value===t.value&&e.dimensionKey===t.dimensionKey&&(t.hierarchyState=(i=t.hierarchyState)!==null&&i!==void 0?i:t!=null&&t.children?e.hierarchyState:void 0,(r=t==null?void 0:t.children)===null||r===void 0||r.forEach((o,l)=>{var s;!((s=e==null?void 0:e.children)===null||s===void 0)&&s[l]&&o&&this.syncHierarchyState(e.children[l],o)}))}getRecordShowIndexByCell(e,t){}getTableIndexByRecordIndex(e){}getTableIndexByField(e){}getCellAddrByFieldRecord(e,t){}getBodyIndexByRow(e){const{layoutMap:t}=this.internalProps;return t.getBodyIndexByRow(e)}getBodyIndexByCol(e){const{layoutMap:t}=this.internalProps;return t.getBodyIndexByCol(e)}getCellValue(e,t,i){var r,o,l;if(!i){const h=this.getCustomMergeValue(e,t);if(h)return h}if(this.internalProps.layoutMap.isHeader(e,t)){if(this.internalProps.layoutMap.isBottomFrozenRow(e,t)||this.internalProps.layoutMap.isRightFrozenColumn(e,t)){const c=this.internalProps.layoutMap.getIndicatorKeyInChartSpec(e,t);let v;return c==null||c.forEach(f=>{const H=this.internalProps.layoutMap.getIndicatorInfo(f);H&&(v=H)}),(o=(r=v==null?void 0:v.title)!==null&&r!==void 0?r:v==null?void 0:v.indicatorKey)!==null&&o!==void 0?o:""}const{title:h,fieldFormat:u}=this.internalProps.layoutMap.getHeader(e,t);return typeof u=="function"?u(h,e,t,this):h}if(this.dataset){let h;const u=this.internalProps.layoutMap.getCellHeaderPaths(e,t),c=u.colHeaderPaths.map((H,g)=>{var m;return H.indicatorKey&&(h={position:"col",index:g}),(m=H.indicatorKey)!==null&&m!==void 0?m:H.value}),v=u.rowHeaderPaths.map((H,g)=>{var m;return H.indicatorKey&&(h={position:"row",index:g}),(m=H.indicatorKey)!==null&&m!==void 0?m:H.value}),f=this.dataset.getAggregator(v,c,this.internalProps.layoutMap.getIndicatorKey(e,t),!0,h);return f.value?f.value():void 0}const{fieldFormat:s}=this.internalProps.layoutMap.getBody(e,t),a=this.getBodyIndexByRow(t),n=this.getBodyIndexByCol(e),d=(l=this.records[a])===null||l===void 0?void 0:l[n];return typeof s=="function"?s(d,e,t,this):d}getCellOriginValue(e,t){var i,r,o;const l=this;if(l.internalProps.layoutMap.isHeader(e,t)){if(this.internalProps.layoutMap.isBottomFrozenRow(e,t)||this.internalProps.layoutMap.isRightFrozenColumn(e,t)){const d=this.internalProps.layoutMap.getIndicatorKeyInChartSpec(e,t);let h;return d==null||d.forEach(u=>{const c=this.internalProps.layoutMap.getIndicatorInfo(u);c&&(h=c)}),(r=(i=h==null?void 0:h.title)!==null&&i!==void 0?i:h==null?void 0:h.indicatorKey)!==null&&r!==void 0?r:""}const{title:n}=l.internalProps.layoutMap.getHeader(e,t);return typeof n=="function"?n():n}if(this.dataset){let n;const d=this.internalProps.layoutMap.getCellHeaderPaths(e,t),h=d.colHeaderPaths.map((v,f)=>{var H;return v.indicatorKey&&(n={position:"col",index:f}),(H=v.indicatorKey)!==null&&H!==void 0?H:v.value}),u=d.rowHeaderPaths.map((v,f)=>{var H;return v.indicatorKey&&(n={position:"row",index:f}),(H=v.indicatorKey)!==null&&H!==void 0?H:v.value}),c=this.dataset.getAggregator(u,h,this.internalProps.layoutMap.getIndicatorKey(e,t),!0,n);return c.value?c.value():void 0}const s=this.getBodyIndexByRow(t),a=this.getBodyIndexByCol(e);return(o=this.records[s])===null||o===void 0?void 0:o[a]}getCellRawValue(e,t){return this.getCellOriginValue(e,t)}getCellOriginRecord(e,t){if(!this.internalProps.layoutMap.isHeader(e,t)&&this.dataset){let i;const r=this.internalProps.layoutMap.getCellHeaderPaths(e,t),o=r.colHeaderPaths.map((s,a)=>{var n;return s.indicatorKey&&(i={position:"col",index:a}),(n=s.indicatorKey)!==null&&n!==void 0?n:s.value}),l=r.rowHeaderPaths.map((s,a)=>{var n;return s.indicatorKey&&(i={position:"row",index:a}),(n=s.indicatorKey)!==null&&n!==void 0?n:s.value});return this.dataset.getAggregator(l,o,this.internalProps.layoutMap.getIndicatorKey(e,t),!0,i).records}}getCellRawRecord(e,t){return this.getCellOriginRecord(e,t)}getPivotSortState(e,t){if(!this.pivotSortState)return;const i=this.getCellRange(e,t);for(let r=0;r<this.pivotSortState.length;r++){const{col:o,row:l,order:s}=this.pivotSortState[r];if(Jt(i,o,l))return s}}_moveHeaderPosition(e,t){var i,r,o,l;const s=this.internalProps.layoutMap.moveHeaderPosition(e,t);if(s){if(s.moveType==="column"){if(((r=(i=this.options.records)===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.constructor)===Array)for(let a=0;a<this.internalProps.records.length;a++){const n=this.internalProps.records[a].splice(s.sourceIndex-this.rowHeaderLevelCount,s.sourceSize);n.unshift(s.targetIndex-this.rowHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records[a],n)}this.colWidthsMap.adjustOrder(s.sourceIndex,s.targetIndex,s.sourceSize),this.setMinMaxLimitWidth()}else if(s.moveType==="row"){if(((l=(o=this.options.records)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.constructor)===Array){const a=this.internalProps.records.splice(s.sourceIndex-this.columnHeaderLevelCount,s.sourceSize);a.unshift(s.targetIndex-this.columnHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records,a)}this.rowHeightsMap.adjustOrder(s.sourceIndex,s.targetIndex,s.sourceSize)}return s}return null}toggleHierarchyState(e,t,i=!0){}getHeaderCellAddressByPath(e){return this.internalProps.layoutMap.getPivotCellAdress(e)}getCellAddressByHeaderPaths(e){return this.internalProps.layoutMap.getCellAdressByHeaderPath(e)}getHeaderPathByXY(e){let t;return t=e?this.getCellAt(e.x+this.getFrozenColsWidth()+this.scrollLeft+1,e.y+this.getFrozenRowsHeight()+this.scrollTop+1):this.getCellAt(this.getFrozenColsWidth()+this.scrollLeft+1,this.getFrozenRowsHeight()+this.scrollTop+1),this.internalProps.layoutMap.getCellHeaderPaths(t.col,t.row)}getHierarchyState(e,t){var i;return(i=this._getHeaderLayoutMap(e,t))===null||i===void 0?void 0:i.hierarchyState}getMenuInfo(e,t,i){const r=this.internalProps.layoutMap.getPivotDimensionInfo(e,t);return{dimensionKey:r[r.length-1].dimensionKey,value:this.getCellValue(e,t),cellLocation:this.getCellLocation(e,t),isPivotCorner:this.isCornerHeader(e,t),event:void 0}}_generateCollectValuesConfig(e,t){var i,r,o,l,s,a,n,d,h,u,c,v,f,H,g,m,w;e=e.filter(p=>p!==Ne),t=t.filter(p=>p!==Ne);const C=this.internalProps.indicators,_={};for(let p=0,S=C==null?void 0:C.length;p<S;p++)if(typeof C[p]!="string"&&C[p].chartSpec){if(((i=C[p].chartSpec)===null||i===void 0?void 0:i.type)==="pie"||((r=C[p].chartSpec)===null||r===void 0?void 0:r.type)==="rose"||((o=C[p].chartSpec)===null||o===void 0?void 0:o.type)==="radar"||((l=C[p].chartSpec)===null||l===void 0?void 0:l.type)==="gauge"||((s=C[p].chartSpec)===null||s===void 0?void 0:s.type)==="wordCloud")continue;const P=C[p],y=P.chartSpec;if(this.options.indicatorsAsCol===!1)if((y==null?void 0:y.stack)!==!1&&((y==null?void 0:y.type)==="bar"||(y==null?void 0:y.type)==="area")&&(y.stack=!0),_[P.indicatorKey]={by:t,range:!0,sumBy:(y==null?void 0:y.stack)&&e.concat(y==null?void 0:y.xField)},y.series)y.series.forEach(I=>{var T,b,A,F,N,x,M,L,K,J,$,ae,de,he;const ue=typeof I.xField=="string"?I.xField:I.xField[0];_[ue]={by:e,type:I.direction!=="horizontal"?"xField":void 0,range:Ye(I,this._axes,I.direction==="horizontal",!0),sortBy:I.direction!=="horizontal"?(F=(A=(b=(T=I==null?void 0:I.data)===null||T===void 0?void 0:T.fields)===null||b===void 0?void 0:b[ue])===null||A===void 0?void 0:A.domain)!==null&&F!==void 0?F:(M=(x=(N=y==null?void 0:y.data)===null||N===void 0?void 0:N.fields)===null||x===void 0?void 0:x[ue])===null||M===void 0?void 0:M.domain:void 0};const ce=I.yField;I.stack!==!1&&(I.type==="bar"||I.type==="area")&&(I.stack=!0),_[ce]={by:t,range:Ye(I,this._axes,I.direction==="horizontal",!1),sumBy:I.stack&&e.concat(I==null?void 0:I.xField),sortBy:I.direction==="horizontal"?($=(J=(K=(L=I==null?void 0:I.data)===null||L===void 0?void 0:L.fields)===null||K===void 0?void 0:K[ce])===null||J===void 0?void 0:J.domain)!==null&&$!==void 0?$:(he=(de=(ae=y==null?void 0:y.data)===null||ae===void 0?void 0:ae.fields)===null||de===void 0?void 0:de[ce])===null||he===void 0?void 0:he.domain:void 0,extendRange:nt(y.markLine)}});else{const I=typeof y.xField=="string"?y.xField:y.xField[0];_[I]={by:e,type:y.direction!=="horizontal"?"xField":void 0,range:Ye(y,this._axes,y.direction==="horizontal",!0),sortBy:y.direction!=="horizontal"?(d=(n=(a=y==null?void 0:y.data)===null||a===void 0?void 0:a.fields)===null||n===void 0?void 0:n[I])===null||d===void 0?void 0:d.domain:void 0},(y==null?void 0:y.stack)!==!1&&((y==null?void 0:y.type)==="bar"||(y==null?void 0:y.type)==="area")&&(y.stack=!0);const T=y.yField;_[T]={by:t,range:y.direction!=="horizontal",sumBy:y.stack&&e.concat(y==null?void 0:y.xField),sortBy:y.direction==="horizontal"?(c=(u=(h=y==null?void 0:y.data)===null||h===void 0?void 0:h.fields)===null||u===void 0?void 0:u[T])===null||c===void 0?void 0:c.domain:void 0,extendRange:nt(y.markLine)}}else{const I=C[p];if((y==null?void 0:y.stack)!==!1&&((y==null?void 0:y.type)==="bar"||(y==null?void 0:y.type)==="area")&&(y.stack=!0),_[I.indicatorKey]={by:e,range:!0,sumBy:(y==null?void 0:y.stack)&&t.concat(y==null?void 0:y.yField)},y.series)y.series.forEach(T=>{var b,A,F,N,x,M,L,K,J,$,ae,de,he,ue;const ce=typeof T.yField=="string"?T.yField:T.yField[0];_[ce]={by:t,type:T.direction==="horizontal"?"yField":void 0,range:Ye(T,this._axes,T.direction==="horizontal",!1),sortBy:T.direction==="horizontal"?(N=(F=(A=(b=T==null?void 0:T.data)===null||b===void 0?void 0:b.fields)===null||A===void 0?void 0:A[ce])===null||F===void 0?void 0:F.domain)!==null&&N!==void 0?N:(L=(M=(x=y==null?void 0:y.data)===null||x===void 0?void 0:x.fields)===null||M===void 0?void 0:M[ce])===null||L===void 0?void 0:L.domain:void 0};const fe=T.xField;T.stack!==!1&&(T.type==="bar"||T.type==="area")&&(T.stack=!0),_[fe]={by:e,range:Ye(T,this._axes,T.direction==="horizontal",!0),sumBy:T.stack&&t.concat(T==null?void 0:T.yField),sortBy:T.direction!=="horizontal"?(ae=($=(J=(K=T==null?void 0:T.data)===null||K===void 0?void 0:K.fields)===null||J===void 0?void 0:J[fe])===null||$===void 0?void 0:$.domain)!==null&&ae!==void 0?ae:(ue=(he=(de=y==null?void 0:y.data)===null||de===void 0?void 0:de.fields)===null||he===void 0?void 0:he[fe])===null||ue===void 0?void 0:ue.domain:void 0,extendRange:nt(y.markLine)}});else{const T=typeof y.yField=="string"?y.yField:y.yField[0];_[T]={by:t,type:y.direction==="horizontal"?"yField":void 0,range:Ye(y,this._axes,y.direction==="horizontal",!1),sortBy:y.direction==="horizontal"?(H=(f=(v=y==null?void 0:y.data)===null||v===void 0?void 0:v.fields)===null||f===void 0?void 0:f[T])===null||H===void 0?void 0:H.domain:void 0},(y==null?void 0:y.stack)!==!1&&((y==null?void 0:y.type)==="bar"||(y==null?void 0:y.type)==="area")&&(y.stack=!0);const b=y.xField;_[b]={by:e,range:Ye(y,this._axes,y.direction==="horizontal",!0),sumBy:y.stack&&t.concat(y==null?void 0:y.yField),sortBy:y.direction!=="horizontal"?(w=(m=(g=y==null?void 0:y.data)===null||g===void 0?void 0:g.fields)===null||m===void 0?void 0:m[b])===null||w===void 0?void 0:w.domain:void 0,extendRange:nt(y.markLine)}}}}return _}_generateAggregationRules(){var e;const t=[];return(e=this.internalProps.indicators)===null||e===void 0||e.forEach(i=>{var r,o;if(typeof i=="string")t.push({indicatorKey:i,field:i,aggregationType:ee.RECORD});else if(!((r=i.chartSpec)===null||r===void 0)&&r.series){const l=[];(o=i.chartSpec)===null||o===void 0||o.series.forEach(s=>{const a=this.options.indicatorsAsCol===!1?s.yField:s.xField;l.indexOf(a)===-1&&l.push(a)}),t.push({indicatorKey:i.indicatorKey,field:l,aggregationType:ee.RECORD})}else{const l=this.options.indicatorsAsCol===!1?i.chartSpec.yField:i.chartSpec.xField;t.push({indicatorKey:i.indicatorKey,field:l??i.indicatorKey,aggregationType:ee.RECORD})}}),t}setCustomStateNameToSpec(){var e;const t=i=>{var r,o,l,s,a,n,d,h,u,c;!((o=(r=i.bar)===null||r===void 0?void 0:r.state)===null||o===void 0)&&o.selected&&(i.bar.state.vtable_selected=i.bar.state.selected,i.bar.state.vtable_selected_reverse=i.bar.state.selected_reverse,delete i.bar.state.selected,delete i.bar.state.selected_reverse),!((s=(l=i.point)===null||l===void 0?void 0:l.state)===null||s===void 0)&&s.selected&&(i.point.state.vtable_selected=i.point.state.selected,i.point.state.vtable_selected_reverse=i.point.state.selected_reverse,delete i.point.state.selected,delete i.point.state.selected_reverse),!((n=(a=i.line)===null||a===void 0?void 0:a.state)===null||n===void 0)&&n.selected&&(i.line.state.vtable_selected=i.line.state.selected,i.line.state.vtable_selected_reverse=i.line.state.selected_reverse,delete i.line.state.selected,delete i.line.state.selected_reverse),!((h=(d=i.area)===null||d===void 0?void 0:d.state)===null||h===void 0)&&h.selected&&(i.area.state.vtable_selected=i.area.state.selected,i.area.state.vtable_selected_reverse=i.area.state.selected_reverse,delete i.area.state.selected,delete i.area.state.selected_reverse),!((c=(u=i.pie)===null||u===void 0?void 0:u.state)===null||c===void 0)&&c.selected&&(i.pie.state.vtable_selected=i.pie.state.selected,i.pie.state.vtable_selected_reverse=i.pie.state.selected_reverse,delete i.pie.state.selected,delete i.pie.state.selected_reverse)};(e=this.internalProps.indicators)===null||e===void 0||e.forEach(i=>{if(i.chartSpec){const r=i.chartSpec;r.series?r.series.forEach(o=>{t(o)}):t(r)}})}updateFilterRules(e){this.internalProps.dataConfig.filterRules=e,this.dataset.updateFilterRules(e),Vt(this.scenegraph),$i(this.scenegraph),this.render()}clearChartCacheImage(e,t){ht(e)&&ht(t)?Yi(e,t,this.scenegraph):Vt(this.scenegraph)}getLegendSelected(){var e;const t=[];return(e=this.internalProps.legends)===null||e===void 0||e.forEach(i=>{const r=i.legendComponent._getSelectedLegends().map(o=>o.label);t.push(...r)}),t}setLegendSelected(e){var t;(t=this.internalProps.legends)===null||t===void 0||t.forEach(i=>{i.legendComponent.setSelected(e)})}getChartDatumPosition(e,t){const{chartInstance:i,bounds:r}=this.getChartInstance(t);if(i){const o=i.convertDatumToPosition(e);return o?{x:Math.round(o.x+r.x1),y:Math.round(o.y+r.y1)}:null}return null}getCellAddressByRecord(e){const t=[],i=[],r={},o=[];this.dataset.dataConfig.aggregationRules.forEach(l=>{if(typeof l.field=="string")r[l.field]=l.indicatorKey,o.push(l.field);else for(let s=0;s<l.field.length;s++)r[l.field[s]]=l.indicatorKey,o.push(l.field[s])});for(const l in e)this.dataset.rows.indexOf(l)>=0&&t.push({dimensionKey:l,value:e[l]}),this.dataset.columns.indexOf(l)>=0&&i.push({dimensionKey:l,value:e[l]}),o.indexOf(l)>=0&&(this.dataset.indicatorsAsCol?i.push({indicatorKey:r[l]}):t.push({indicatorKey:r[l]}));return this.getCellAddressByHeaderPaths({rowHeaderPaths:t,colHeaderPaths:i,cellLocation:"body"})}getChartInstance(e){var t,i,r,o,l;const s=this.getCellAddressByHeaderPaths(e);if(s){const a=this.getCellRelativeRect(s.col,s.row),n=this.scenegraph.getCell(s.col,s.row);let d;const h=(t=n==null?void 0:n.getChildren())===null||t===void 0?void 0:t[0];if(h.attribute.chartInstance){d=h.attribute.chartInstance;const{dataId:u,data:c,axes:v,spec:f}=h.attribute,H=h.getViewBox();v==null||v.forEach((C,_)=>{var p,S,P,y,I;C.type==="linear"?d.updateModelSpecSync({type:"axes",index:_},{min:(S=(p=C.range)===null||p===void 0?void 0:p.min)!==null&&S!==void 0?S:0,max:(y=(P=C.range)===null||P===void 0?void 0:P.max)!==null&&y!==void 0?y:0,tick:{tickMode:(I=C.tick)===null||I===void 0?void 0:I.tickMode}},!0):C.type==="band"&&d.updateModelSpec({type:"axes",index:_},{domain:C.domain.slice(0)},!0)}),d.updateViewBox({x1:0,x2:H.x2-H.x1,y1:0,y2:H.y2-H.y1},!1,!1);const g=d.getStage(),m=h.globalTransMatrix.clone(),w=h.stage.window.getViewBoxTransform();if(m.multiply(w.a,w.b,w.c,w.d,w.e,w.f),g.window.setViewBoxTransform&&g.window.setViewBoxTransform(m.a,m.b,m.c,m.d,m.e,m.f),typeof u=="string")d.updateDataSync(u,c??[]);else{const C=[];for(const _ in u){const p=u[_],S=f.series.find(P=>{var y;return((y=P==null?void 0:P.data)===null||y===void 0?void 0:y.id)===_});C.push({id:_,values:p?(i=c==null?void 0:c.filter(P=>P.hasOwnProperty(p)))!==null&&i!==void 0?i:[]:c??[],fields:(r=S==null?void 0:S.data)===null||r===void 0?void 0:r.fields}),d.updateFullDataSync||d.updateDataSync(_,p?(o=c==null?void 0:c.filter(P=>P.hasOwnProperty(p)))!==null&&o!==void 0?o:[]:c??[])}(l=d.updateFullDataSync)===null||l===void 0||l.call(d,C)}this.render()}return{chartInstance:d,bounds:a.bounds}}return{}}activateChartInstance(e){var t,i,r,o,l;const s=this.getCellAddressByHeaderPaths(e);if(s){const a=s.col,n=s.row,d=this.scenegraph.getCell(a,n),h=(t=d==null?void 0:d.getChildren())===null||t===void 0?void 0:t[0],u=this.scenegraph.activateChart(a,n),{dataId:c,data:v,axes:f,spec:H}=h.attribute,g=h.getViewBox();f==null||f.forEach((_,p)=>{var S,P,y,I,T;_.type==="linear"?u.updateModelSpecSync({type:"axes",index:p},{min:(P=(S=_.range)===null||S===void 0?void 0:S.min)!==null&&P!==void 0?P:0,max:(I=(y=_.range)===null||y===void 0?void 0:y.max)!==null&&I!==void 0?I:0,tick:{tickMode:(T=_.tick)===null||T===void 0?void 0:T.tickMode}},!0):_.type==="band"&&u.updateModelSpec({type:"axes",index:p},{domain:_.domain.slice(0)},!0)}),u.updateViewBox({x1:0,x2:g.x2-g.x1,y1:0,y2:g.y2-g.y1},!1,!1);const m=u.getStage();m.needRender=!0;const w=h.globalTransMatrix.clone(),C=h.stage.window.getViewBoxTransform().clone();if(C.multiply(w.a,w.b,w.c,w.d,w.e,w.f),m.window.setViewBoxTransform(C.a,C.b,C.c,C.d,C.e,C.f),typeof c=="string")u.updateDataSync(c,v??[]);else{const _=[];for(const p in c){const S=c[p],P=H.series.find(y=>{var I;return((I=y==null?void 0:y.data)===null||I===void 0?void 0:I.id)===p});_.push({id:p,values:S?(i=v==null?void 0:v.filter(y=>y.hasOwnProperty(S)))!==null&&i!==void 0?i:[]:v??[],fields:(r=P==null?void 0:P.data)===null||r===void 0?void 0:r.fields}),u.updateFullDataSync||u.updateDataSync(p,S?(o=v==null?void 0:v.filter(y=>y.hasOwnProperty(S)))!==null&&o!==void 0?o:[]:v??[])}(l=u.updateFullDataSync)===null||l===void 0||l.call(u,_)}return u}}replaceChartCacheImage(e,t){var i;const r=this.getCellAddressByHeaderPaths(e);if(r){const o=this.scenegraph.getCell(r.col,r.row),l=(i=o==null?void 0:o.getChildren())===null||i===void 0?void 0:i[0];Xi(t.getStage(),l)}}_getDimensionSortArray(){var e,t;if(!((t=(e=this.options)===null||e===void 0?void 0:e.axes)===null||t===void 0)&&t.length){const i=this.options.indicatorsAsCol?"left":"bottom",r=this.options.axes.find(o=>o.orient===i);if(r&&Be(r.domain))return r.domain}}setRecords(e){var t,i;const r={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.options.records=this.internalProps.records=e;const o=this.options,l=this.internalProps;let s,a;this.dataset.setRecords(e),s=o.columnTree?l.layoutMap.columnDimensionTree:new ge((t=this.dataset.colHeaderTree)!==null&&t!==void 0?t:[],this.layoutNodeId),a=o.rowTree?l.layoutMap.rowDimensionTree:new ge((i=this.dataset.rowHeaderTree)!==null&&i!==void 0?i:[],this.layoutNodeId),l.layoutMap=new ze(this,this.dataset,s,a),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(r.col,r.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.eventManager.updateEventBinder()}_hasCustomRenderOrLayout(){if(this.options.customRender)return!0;const{columnsDefine:e,rowsDefine:t,indicatorsDefine:i}=this.internalProps.layoutMap;for(let r=0;r<e.length;r++){const o=e[r];if(typeof o!="string"&&(o.headerCustomLayout||o.headerCustomRender))return!0}for(let r=0;r<t.length;r++){const o=t[r];if(typeof o!="string"&&(o.headerCustomLayout||o.headerCustomRender))return!0}for(let r=0;r<i.length;r++){const o=i[r];if(typeof o!="string"&&(o.customLayout||o.headerCustomLayout||o.customRender||o.headerCustomRender))return!0}return!1}changeRecordOrder(e,t){}getLayoutColumnTree(){return this.internalProps.layoutMap.getLayoutColumnTree()}getLayoutColumnTreeCount(){return this.internalProps.layoutMap.getLayoutColumnTreeCount()}getLayoutRowTree(){return this.internalProps.layoutMap.getLayoutRowTree()}getLayoutRowTreeCount(){return this.internalProps.layoutMap.getLayoutRowTreeCount()}getCellHeaderTreeNodes(e,t){return this.internalProps.layoutMap.getCellHeaderPathsWithTreeNode(e,t)}}let go=class extends Zi{constructor(e){var t,i,r,o,l,s,a,n,d,h;e.src&&(e.image=e.src),e.shape==="circle"&&(e.cornerRadius=e.width/2);const u=Be(e.boundsPadding),c=[(i=(t=e.marginTop)!==null&&t!==void 0?t:u?e.boundsPadding[0]:e.boundsPadding)!==null&&i!==void 0?i:0,(o=(r=e.marginRight)!==null&&r!==void 0?r:u?e.boundsPadding[1]:e.boundsPadding)!==null&&o!==void 0?o:0,(a=(l=e.marginBottom)!==null&&l!==void 0?l:u?(s=e.boundsPadding[2])!==null&&s!==void 0?s:e.boundsPadding[0]:e.boundsPadding)!==null&&a!==void 0?a:0,(h=(n=e.marginLeft)!==null&&n!==void 0?n:u?(d=e.boundsPadding[3])!==null&&d!==void 0?d:e.boundsPadding[1]:e.boundsPadding)!==null&&h!==void 0?h:0];e.boundsPadding=c,super(e)}},Co=class extends eo{constructor(e){var t,i,r,o,l,s,a,n,d,h,u;e.textBaseline||(e.textBaseline="top");const c=Be(e.boundsPadding),v=[(i=(t=e.marginTop)!==null&&t!==void 0?t:c?e.boundsPadding[0]:e.boundsPadding)!==null&&i!==void 0?i:0,(o=(r=e.marginRight)!==null&&r!==void 0?r:c?e.boundsPadding[1]:e.boundsPadding)!==null&&o!==void 0?o:0,(a=(l=e.marginBottom)!==null&&l!==void 0?l:c?(s=e.boundsPadding[2])!==null&&s!==void 0?s:e.boundsPadding[0]:e.boundsPadding)!==null&&a!==void 0?a:0,(h=(n=e.marginLeft)!==null&&n!==void 0?n:c?(d=e.boundsPadding[3])!==null&&d!==void 0?d:e.boundsPadding[1]:e.boundsPadding)!==null&&h!==void 0?h:0];e.boundsPadding=v,e.fill=(u=e.fill)!==null&&u!==void 0?u:"#000",super(e)}getSize(e){this.AABBBounds.width()}},fo=class extends to{constructor(e){var t,i,r,o,l,s,a,n,d,h;const u=Be(e.boundsPadding),c=[(i=(t=e.marginTop)!==null&&t!==void 0?t:u?e.boundsPadding[0]:e.boundsPadding)!==null&&i!==void 0?i:0,(o=(r=e.marginRight)!==null&&r!==void 0?r:u?e.boundsPadding[1]:e.boundsPadding)!==null&&o!==void 0?o:0,(a=(l=e.marginBottom)!==null&&l!==void 0?l:u?(s=e.boundsPadding[2])!==null&&s!==void 0?s:e.boundsPadding[0]:e.boundsPadding)!==null&&a!==void 0?a:0,(h=(n=e.marginLeft)!==null&&n!==void 0?n:u?(d=e.boundsPadding[3])!==null&&d!==void 0?d:e.boundsPadding[1]:e.boundsPadding)!==null&&h!==void 0?h:0];e.boundsPadding=c,super(e)}getSize(e){this.AABBBounds.width()}},yo=class extends io{constructor(e){var t,i,r,o,l,s,a,n,d,h;const u=Be(e.boundsPadding),c=[(i=(t=e.marginTop)!==null&&t!==void 0?t:u?e.boundsPadding[0]:e.boundsPadding)!==null&&i!==void 0?i:0,(o=(r=e.marginRight)!==null&&r!==void 0?r:u?e.boundsPadding[1]:e.boundsPadding)!==null&&o!==void 0?o:0,(a=(l=e.marginBottom)!==null&&l!==void 0?l:u?(s=e.boundsPadding[2])!==null&&s!==void 0?s:e.boundsPadding[0]:e.boundsPadding)!==null&&a!==void 0?a:0,(h=(n=e.marginLeft)!==null&&n!==void 0?n:u?(d=e.boundsPadding[3])!==null&&d!==void 0?d:e.boundsPadding[1]:e.boundsPadding)!==null&&h!==void 0?h:0];e.boundsPadding=c,super(e)}};function ct(R){return R.flatMap(e=>Array.isArray(e.children)?ct(e.children):e)}function hi(R){return R.replace(/-([a-z])/g,e=>e[1].toUpperCase())}function Lt(R){const e={};for(const t in R)if(R.hasOwnProperty(t)){const i=hi(t);e[i]=R[t]}return e}function mo(R,e){return R.startsWith("on")&&lo(e[R])}function po(R){const e={Group:yo,Image:go,Text:Co,Tag:fo,Radio:ro,CheckBox:oo};function t(o){if(!o)return null;const{type:l,children:s}=o,a=Lt(o.props),n=(l==null?void 0:l.symbol)||(l==null?void 0:l.name),d=e[n];if(!d)return null;const h=new d(Object.assign({},a));return r(h,a),i(s).forEach(c=>{const v=t(c);v?h.add(v):c.type===Symbol.for("v-fgt")&&c.children.forEach(f=>{const H=t(f);H&&h.add(H)})}),h}function i(o){var l;return((l=o==null?void 0:o.default)===null||l===void 0?void 0:l.call(o))||o||[]}function r(o,l){Object.keys(l).forEach(s=>{if(mo(s,l)){let a;s.startsWith("on")?a=s.slice(2).toLowerCase():a=hi(s.slice(2)).toLowerCase(),o.addEventListener(a,l[s])}})}return{rootComponent:t(R)}}function _o(R){return e=>{const{table:t,row:i,col:r,rect:o}=e,l=t.getCellOriginRecord(r,i),{height:s,width:a}=o??t.getCellRect(r,i),n=R.customLayout({table:t,row:i,col:r,rect:o,record:l,height:s,width:a})[0],{rootComponent:d}=po(n);return{rootContainer:d,renderDefault:!1}}}function ui(R){const e={columns:[],columnHeaderTitle:[],rows:[],rowHeaderTitle:[],indicators:[],corner:{},tooltip:{},menu:{}},t={PivotColumnDimension:"columns",PivotColumnHeaderTitle:"columnHeaderTitle",PivotRowDimension:"rows",PivotRowHeaderTitle:"rowHeaderTitle",PivotCorner:"corner",PivotIndicator:"indicators",Tooltip:"tooltip",Menu:"menu"};return R.forEach(i=>{var r,o;i.props=Lt(i.props);const l=((r=i.type)===null||r===void 0?void 0:r.symbol)||((o=i.type)===null||o===void 0?void 0:o.name),s=t[l];s&&(Array.isArray(e[s])?i.props.hasOwnProperty("objectHandler")?e[s].push(i.props.objectHandler):e[s].push(i.props):e[s]=i.props)}),e}function wo(R){const e={columns:[],tooltip:{},menu:{}},t={ListColumn:"columns",Tooltip:"tooltip",Menu:"menu"};return R.forEach(i=>{var r,o;i.props=Lt(i.props);const l=((r=i.type)===null||r===void 0?void 0:r.symbol)||((o=i.type)===null||o===void 0?void 0:o.name),s=t[l];s&&(s==="columns"&&i.children&&(i.props.customLayout=_o(i.children)),Array.isArray(e[s])?e[s].push(i.props):e[s]=i.props)}),e}function At(R,e){return Object.assign(Object.assign({},R),{columns:e.columns&&e.columns.length?e.columns:R.columns,columnHeaderTitle:e.columnHeaderTitle&&e.columnHeaderTitle.length?e.columnHeaderTitle:R.columnHeaderTitle,rows:e.rows&&e.rows.length?e.rows:R.rows,rowHeaderTitle:e.rowHeaderTitle&&e.rowHeaderTitle.length?e.rowHeaderTitle:R.rowHeaderTitle,indicators:e.indicators&&e.indicators.length?e.indicators:R.indicators,corner:Object.keys(R.corner||{}).length?R.corner:e.corner,tooltip:Object.keys(e.tooltip||{}).length?e.tooltip:R.tooltip,menu:Object.keys(e.menu||{}).length?e.menu:R.menu})}const j=Object.assign(Object.assign(Object.assign({},Ht.EVENT_TYPE),Tt.EVENT_TYPE),Pt.EVENT_TYPE),ci={onClickCell:j.CLICK_CELL,onDblClickCell:j.DBLCLICK_CELL,onMouseDownCell:j.MOUSEDOWN_CELL,onMouseUpCell:j.MOUSEUP_CELL,onSelectedCell:j.SELECTED_CELL,onKeyDown:j.KEYDOWN,onMouseEnterTable:j.MOUSEENTER_TABLE,onMouseLeaveTable:j.MOUSELEAVE_TABLE,onMouseDownTable:j.MOUSEDOWN_TABLE,onMouseMoveCell:j.MOUSEMOVE_CELL,onMouseEnterCell:j.MOUSEENTER_CELL,onMouseLeaveCell:j.MOUSELEAVE_CELL,onContextMenuCell:j.CONTEXTMENU_CELL,onResizeColumn:j.RESIZE_COLUMN,onResizeColumnEnd:j.RESIZE_COLUMN_END,onChangeHeaderPosition:j.CHANGE_HEADER_POSITION,onChangeHeaderPositionStart:j.CHANGE_HEADER_POSITION_START,onChangeHeaderPositionFail:j.CHANGE_HEADER_POSITION_FAIL,onSortClick:j.SORT_CLICK,onFreezeClick:j.FREEZE_CLICK,onScroll:j.SCROLL,onDropdownMenuClick:j.DROPDOWN_MENU_CLICK,onMouseOverChartSymbol:j.MOUSEOVER_CHART_SYMBOL,onDragSelectEnd:j.DRAG_SELECT_END,onDropdownIconClick:j.DROPDOWN_ICON_CLICK,onDropdownMenuClear:j.DROPDOWN_MENU_CLEAR,onTreeHierarchyStateChange:j.TREE_HIERARCHY_STATE_CHANGE,onShowMenu:j.SHOW_MENU,onHideMenu:j.HIDE_MENU,onIconClick:j.ICON_CLICK,onLegendItemClick:j.LEGEND_ITEM_CLICK,onLegendItemHover:j.LEGEND_ITEM_HOVER,onLegendItemUnHover:j.LEGEND_ITEM_UNHOVER,onLegendChange:j.LEGEND_CHANGE,onMouseEnterAxis:j.MOUSEENTER_AXIS,onMouseLeaveAxis:j.MOUSELEAVE_AXIS,onCheckboxStateChange:j.CHECKBOX_STATE_CHANGE,onRadioStateChange:j.RADIO_STATE_CHANGE,onAfterRender:j.AFTER_RENDER,onInitialized:j.INITIALIZED,onPivotSortClick:j.PIVOT_SORT_CLICK,onDrillMenuClick:j.DRILLMENU_CLICK,onVChartEventType:j.VCHART_EVENT_TYPE,onChangeCellValue:j.CHANGE_CELL_VALUE,onMousedownFillHandle:j.MOUSEDOWN_FILL_HANDLE,onDragFillHandleEnd:j.DRAG_FILL_HANDLE_END,onDblclickFillHandle:j.DBLCLICK_FILL_HANDLE,onScrollVerticalEnd:j.SCROLL_VERTICAL_END,onScrollHorizontalEnd:j.SCROLL_HORIZONTAL_END,onChangCellValue:j.CHANGE_CELL_VALUE},Ut=Object.keys(ci);var xt=lt({__name:"base-table",props:{type:{type:String,required:!1},options:{type:null,required:!1},records:{type:Array,required:!1},width:{type:[Number,String],required:!1,default:"100%"},height:{type:[Number,String],required:!1,default:"100%"},onReady:{type:Function,required:!1},onError:{type:Function,required:!1},keepColumnWidthChange:{type:Boolean,required:!1},onClickCell:{type:null,required:!1},onDblClickCell:{type:null,required:!1},onMouseDownCell:{type:null,required:!1},onMouseUpCell:{type:null,required:!1},onSelectedCell:{type:null,required:!1},onKeyDown:{type:null,required:!1},onMouseEnterTable:{type:null,required:!1},onMouseLeaveTable:{type:null,required:!1},onMouseDownTable:{type:null,required:!1},onMouseMoveCell:{type:null,required:!1},onMouseEnterCell:{type:null,required:!1},onMouseLeaveCell:{type:null,required:!1},onContextMenuCell:{type:null,required:!1},onResizeColumn:{type:null,required:!1},onResizeColumnEnd:{type:null,required:!1},onChangeHeaderPosition:{type:null,required:!1},onChangeHeaderPositionStart:{type:null,required:!1},onChangeHeaderPositionFail:{type:null,required:!1},onSortClick:{type:null,required:!1},onFreezeClick:{type:null,required:!1},onScroll:{type:null,required:!1},onDropdownMenuClick:{type:null,required:!1},onMouseOverChartSymbol:{type:null,required:!1},onDragSelectEnd:{type:null,required:!1},onDropdownIconClick:{type:null,required:!1},onDropdownMenuClear:{type:null,required:!1},onTreeHierarchyStateChange:{type:null,required:!1},onShowMenu:{type:null,required:!1},onHideMenu:{type:null,required:!1},onIconClick:{type:null,required:!1},onLegendItemClick:{type:null,required:!1},onLegendItemHover:{type:null,required:!1},onLegendItemUnHover:{type:null,required:!1},onLegendChange:{type:null,required:!1},onMouseEnterAxis:{type:null,required:!1},onMouseLeaveAxis:{type:null,required:!1},onCheckboxStateChange:{type:null,required:!1},onRadioStateChange:{type:null,required:!1},onAfterRender:{type:null,required:!1},onInitialized:{type:null,required:!1},onPivotSortClick:{type:null,required:!1},onDrillMenuClick:{type:null,required:!1},onVChartEventType:{type:null,required:!1},onChangeCellValue:{type:null,required:!1},onMousedownFillHandle:{type:null,required:!1},onDragFillHandleEnd:{type:null,required:!1},onDblclickFillHandle:{type:null,required:!1},onScrollVerticalEnd:{type:null,required:!1},onScrollHorizontalEnd:{type:null,required:!1}},emits:Ut,setup(R,{expose:e,emit:t}){const i=R,r=_e(null),o=It(null),l=_e(new Map),s=_e([]),a=_e([]);e({vTableInstance:o});const n=Le(()=>typeof i.width=="number"?`${i.width}px`:i.width),d=Le(()=>typeof i.height=="number"?`${i.height}px`:i.height),h=t,u=g=>{Ut.forEach(m=>{const w=C=>{h(m,C)};g.on(ci[m],w)})},c=(g,m)=>{const w=new g(r.value,m);o.value=w,l.value.clear(),s.value=[],a.value=[],w.on("resize_column_end",C=>{if(!i.keepColumnWidthChange)return;const{col:_,colWidths:p}=C,S=p[_];if(w.isPivotTable()){const P=w.getCellHeaderPaths(_,w.columnHeaderLevelCount);let y=null;P.cellLocation==="rowHeader"?y=P.rowHeaderPaths:y=P.colHeaderPaths;let I=!1;for(let T=0;T<s.value.length;T++){const b=s.value[T];JSON.stringify(b.dimensions)===JSON.stringify(y)&&(b.width=S,I=!0)}I||s.value.push({dimensions:y,width:S})}else{const P=w.getBodyColumnDefine(_,0);P!=null&&P.key&&l.value.set(P.key,S)}})},v=()=>{var g,m;if(!r.value)return;o.value&&o.value.release();const w=()=>i.records!==void 0&&i.records!==null&&i.records.length>0?i.records:i.options.records;try{switch(i.type){case"list":c(Ht,Object.assign(Object.assign({},i.options),{records:w()}));break;case"pivot":c(Tt,Object.assign(Object.assign({},i.options),{records:w()}));break;case"chart":c(Pt,Object.assign(Object.assign({},i.options),{records:w()}));break}u(o.value),(g=i.onReady)===null||g===void 0||g.call(i,o.value,!0)}catch(C){(m=i.onError)===null||m===void 0||m.call(i,C)}},f=g=>{var m;if(o.value)try{if(i.keepColumnWidthChange){const w=H(l.value,s.value,o.value);g=Object.assign(Object.assign({},g),{columnWidthConfig:w,columnWidthConfigForRowHeader:w})}switch(i.type){case"list":o.value instanceof Ht&&o.value.updateOption(g);break;case"pivot":o.value instanceof Tt&&o.value.updateOption(g);break;case"chart":o.value instanceof Pt&&o.value.updateOption(g);break}}catch(w){(m=i.onError)===null||m===void 0||m.call(i,w)}};Gt(v),wi(()=>{var g;return(g=o.value)===null||g===void 0?void 0:g.release()}),Kt(()=>i.options,g=>{o.value?f(g):v()}),Kt(()=>i.records,(g,m)=>{o.value?f(Object.assign(Object.assign({},i.options),{records:g})):v()},{deep:!0});function H(g,m,w){if(w.isPivotTable())return m;const C=[];return g.forEach((_,p)=>{C.push({key:p,width:_})}),C}return(g,m)=>(Ke(),Ve("div",{ref_key:"vTableContainer",ref:r,style:rt([{width:n.value,height:d.value},{position:"relative"}])},null,4))}}),_t=lt({__name:"list-table",props:{options:{type:Object,required:!0},records:{type:Array,required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1}},setup(R,{expose:e}){const t=R,i=_e(null),r=Rt(),o=Le(()=>{var l;const s=ct(((l=r.default)===null||l===void 0?void 0:l.call(r))||[]),a=wo(s);return At(t.options,a)});return e({vTableInstance:Le(()=>{var l;return((l=i.value)===null||l===void 0?void 0:l.vTableInstance)||null})}),(l,s)=>(Ke(),Ve(et,null,[E(xt,Ft({type:"list",options:o.value,records:l.records,width:l.width,height:l.height,ref_key:"baseTableRef",ref:i},l.$attrs),null,16,["options","records","width","height"]),Dt(l.$slots,"default")],64))}}),Ho=lt({__name:"pivot-table",props:{options:{type:Object,required:!0},records:{type:Array,required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1}},setup(R,{expose:e}){const t=R,i=It(null),r=Rt(),o=Le(()=>{var l;const s=ct(((l=r.default)===null||l===void 0?void 0:l.call(r))||[]),a=ui(s);return At(t.options,a)});return e({vTableInstance:Le(()=>{var l;return((l=i.value)===null||l===void 0?void 0:l.vTableInstance)||null})}),(l,s)=>(Ke(),Ve(et,null,[E(xt,Ft({type:"pivot",options:o.value,records:l.records,width:l.width,height:l.height,ref_key:"baseTableRef",ref:i},l.$attrs),null,16,["options","records","width","height"]),Dt(l.$slots,"default")],64))}}),To=lt({__name:"pivot-chart",props:{options:{type:Object,required:!0},records:{type:Array,required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1}},setup(R,{expose:e}){const t=R,i=It(null),r=Rt(),o=Le(()=>{var l;const s=ct(((l=r.default)===null||l===void 0?void 0:l.call(r))||[]),a=ui(s);return At(t.options,a)});return e({vTableInstance:Le(()=>{var l;return((l=i.value)===null||l===void 0?void 0:l.vTableInstance)||null})}),(l,s)=>(Ke(),Ve(et,null,[E(xt,Ft({type:"chart",options:o.value,records:l.records,width:l.width,height:l.height,ref_key:"baseTableRef",ref:i},l.$attrs),null,16,["options","records","width","height"]),Dt(l.$slots,"default")],64))}});const Po=(R,e)=>{so(R,e)};function Z(R){return null}Z.symbol="ListColumn";function vi(R){return null}vi.symbol="PivotColumnDimension";function gi(R){return null}gi.symbol="PivotRowDimension";function Ci(R){return null}Ci.symbol="PivotIndicator";function fi(R){return null}fi.symbol="PivotCorner";function yi(R){return null}yi.symbol="Menu";function Ze(){return null}Ze.symbol="Group";function St(){return null}St.symbol="Image";function bt(){return null}bt.symbol="Text";function mi(R){return null}mi.symbol="Tag";const qt=[{"Row ID":"7981","Order ID":"CA-2015-103800","Order Date":"2015/1/3","Ship Date":"2015/1/7","Ship Mode":"Standard Class","Customer ID":"DP-13000","Customer Name":"Darren Powers",Segment:"Consumer",Country:"United States",City:"Houston",State:"Texas","Postal Code":"77095",Region:"Central","Product ID":"OFF-PA-10000174",Category:"Office Supplies","Sub-Category":"Paper","Product Name":'Message Book, Wirebound, Four 5 1/2" X 4" Forms/Pg., 200 Dupl. Sets/Book',Sales:"16.448",Quantity:"2",Discount:"0.2",Profit:"5.5512"},{"Row ID":"740","Order ID":"CA-2015-112326","Order Date":"2015/1/4","Ship Date":"2015/1/8","Ship Mode":"Standard Class","Customer ID":"PO-19195","Customer Name":"Phillina Ober",Segment:"Home Office",Country:"United States",City:"Naperville",State:"Illinois","Postal Code":"60540",Region:"Central","Product ID":"OFF-LA-10003223",Category:"Office Supplies","Sub-Category":"Labels","Product Name":"Avery 508",Sales:"11.784",Quantity:"3",Discount:"0.2",Profit:"4.2717"},{"Row ID":"741","Order ID":"CA-2015-112326","Order Date":"2015/1/4","Ship Date":"2015/1/8","Ship Mode":"Standard Class","Customer ID":"PO-19195","Customer Name":"Phillina Ober",Segment:"Home Office",Country:"United States",City:"Naperville",State:"Illinois","Postal Code":"60540",Region:"Central","Product ID":"OFF-ST-10002743",Category:"Office Supplies","Sub-Category":"Storage","Product Name":"SAFCO Boltless Steel Shelving",Sales:"272.736",Quantity:"3",Discount:"0.2",Profit:"-64.7748"},{"Row ID":"742","Order ID":"CA-2015-112326","Order Date":"2015/1/4","Ship Date":"2015/1/8","Ship Mode":"Standard Class","Customer ID":"PO-19195","Customer Name":"Phillina Ober",Segment:"Home Office",Country:"United States",City:"Naperville",State:"Illinois","Postal Code":"60540",Region:"Central","Product ID":"OFF-BI-10004094",Category:"Office Supplies","Sub-Category":"Binders","Product Name":"GBC Standard Plastic Binding Systems Combs",Sales:"3.54",Quantity:"2",Discount:"0.8",Profit:"-5.487"},{"Row ID":"1760","Order ID":"CA-2015-141817","Order Date":"2015/1/5","Ship Date":"2015/1/12","Ship Mode":"Standard Class","Customer ID":"MB-18085","Customer Name":"Mick Brown",Segment:"Consumer",Country:"United States",City:"Philadelphia",State:"Pennsylvania","Postal Code":"19143",Region:"East","Product ID":"OFF-AR-10003478",Category:"Office Supplies","Sub-Category":"Art","Product Name":"Avery Hi-Liter EverBold Pen Style Fluorescent Highlighters, 4/Pack",Sales:"19.536",Quantity:"3",Discount:"0.2",Profit:"4.884"},{"Row ID":"5328","Order ID":"CA-2015-130813","Order Date":"2015/1/6","Ship Date":"2015/1/8","Ship Mode":"Second Class","Customer ID":"LS-17230","Customer Name":"Lycoris Saunders",Segment:"Consumer",Country:"United States",City:"Los Angeles",State:"California","Postal Code":"90049",Region:"West","Product ID":"OFF-PA-10002005",Category:"Office Supplies","Sub-Category":"Paper","Product Name":"Xerox 225",Sales:"19.44",Quantity:"3",Discount:"0",Profit:"9.3312"},{"Row ID":"7181","Order ID":"CA-2015-106054","Order Date":"2015/1/6","Ship Date":"2015/1/7","Ship Mode":"First Class","Customer ID":"JO-15145","Customer Name":"Jack O'Briant",Segment:"Corporate",Country:"United States",City:"Athens",State:"Georgia","Postal Code":"30605",Region:"South","Product ID":"OFF-AR-10002399",Category:"Office Supplies","Sub-Category":"Art","Product Name":"Dixon Prang Watercolor Pencils, 10-Color Set with Brush",Sales:"12.78",Quantity:"3",Discount:"0",Profit:"5.2398"},{"Row ID":"7475","Order ID":"CA-2015-167199","Order Date":"2015/1/6","Ship Date":"2015/1/10","Ship Mode":"Standard Class","Customer ID":"ME-17320","Customer Name":"Maria Etezadi",Segment:"Home Office",Country:"United States",City:"Henderson",State:"Kentucky","Postal Code":"42420",Region:"South","Product ID":"FUR-CH-10004063",Category:"Furniture","Sub-Category":"Chairs","Product Name":"Global Deluxe High-Back Manager's Chair",Sales:"2573.82",Quantity:"9",Discount:"0",Profit:"746.4078"},{"Row ID":"7476","Order ID":"CA-2015-167199","Order Date":"2015/1/6","Ship Date":"2015/1/10","Ship Mode":"Standard Class","Customer ID":"ME-17320","Customer Name":"Maria Etezadi",Segment:"Home Office",Country:"United States",City:"Henderson",State:"Kentucky","Postal Code":"42420",Region:"South","Product ID":"OFF-BI-10004632",Category:"Office Supplies","Sub-Category":"Binders","Product Name":"Ibico Hi-Tech Manual Binding System",Sales:"609.98",Quantity:"2",Discount:"0",Profit:"274.491"},{"Row ID":"7477","Order ID":"CA-2015-167199","Order Date":"2015/1/6","Ship Date":"2015/1/10","Ship Mode":"Standard Class","Customer ID":"ME-17320","Customer Name":"Maria Etezadi",Segment:"Home Office",Country:"United States",City:"Henderson",State:"Kentucky","Postal Code":"42420",Region:"South","Product ID":"OFF-AR-10001662",Category:"Office Supplies","Sub-Category":"Art","Product Name":"Rogers Handheld Barrel Pencil Sharpener",Sales:"5.48",Quantity:"2",Discount:"0",Profit:"1.4796"},{"Row ID":"7478","Order ID":"CA-2015-167199","Order Date":"2015/1/6","Ship Date":"2015/1/10","Ship Mode":"Standard Class","Customer ID":"ME-17320","Customer Name":"Maria Etezadi",Segment:"Home Office",Country:"United States",City:"Henderson",State:"Kentucky","Postal Code":"42420",Region:"South","Product ID":"TEC-PH-10004977",Category:"Technology","Sub-Category":"Phones","Product Name":"GE 30524EE4",Sales:"391.98",Quantity:"2",Discount:"0",Profit:"113.6742"},{"Row ID":"7479","Order ID":"CA-2015-167199","Order Date":"2015/1/6","Ship Date":"2015/1/10","Ship Mode":"Standard Class","Customer ID":"ME-17320","Customer Name":"Maria Etezadi",Segment:"Home Office",Country:"United States",City:"Henderson",State:"Kentucky","Postal Code":"42420",Region:"South","Product ID":"TEC-PH-10004539",Category:"Technology","Sub-Category":"Phones","Product Name":"Wireless Extenders zBoost YX545 SOHO Signal Booster",Sales:"755.96",Quantity:"4",Discount:"0",Profit:"204.1092"},{"Row ID":"7480","Order ID":"CA-2015-167199","Order Date":"2015/1/6","Ship Date":"2015/1/10","Ship Mode":"Standard Class","Customer ID":"ME-17320","Customer Name":"Maria Etezadi",Segment:"Home Office",Country:"United States",City:"Henderson",State:"Kentucky","Postal Code":"42420",Region:"South","Product ID":"OFF-FA-10001883",Category:"Office Supplies","Sub-Category":"Fasteners","Product Name":"Alliance Super-Size Bands, Assorted Sizes",Sales:"31.12",Quantity:"4",Discount:"0",Profit:"0.3112"},{"Row ID":"7481","Order ID":"CA-2015-167199","Order Date":"2015/1/6","Ship Date":"2015/1/10","Ship Mode":"Standard Class","Customer ID":"ME-17320","Customer Name":"Maria Etezadi",Segment:"Home Office",Country:"United States",City:"Henderson",State:"Kentucky","Postal Code":"42420",Region:"South","Product ID":"OFF-PA-10000955",Category:"Office Supplies","Sub-Category":"Paper","Product Name":"Southworth 25% Cotton Granite Paper & Envelopes",Sales:"6.54",Quantity:"1",Discount:"0",Profit:"3.0084"},{"Row ID":"7661","Order ID":"CA-2015-105417","Order Date":"2015/1/7","Ship Date":"2015/1/12","Ship Mode":"Standard Class","Customer ID":"VS-21820","Customer Name":"Vivek Sundaresam",Segment:"Consumer",Country:"United States",City:"Huntsville",State:"Texas","Postal Code":"77340",Region:"Central","Product ID":"FUR-FU-10004864",Category:"Furniture","Sub-Category":"Furnishings","Product Name":'Howard Miller 14-1/2" Diameter Chrome Round Wall Clock',Sales:"76.728",Quantity:"3",Discount:"0.6",Profit:"-53.7096"},{"Row ID":"7662","Order ID":"CA-2015-105417","Order Date":"2015/1/7","Ship Date":"2015/1/12","Ship Mode":"Standard Class","Customer ID":"VS-21820","Customer Name":"Vivek Sundaresam",Segment:"Consumer",Country:"United States",City:"Huntsville",State:"Texas","Postal Code":"77340",Region:"Central","Product ID":"OFF-BI-10003708",Category:"Office Supplies","Sub-Category":"Binders","Product Name":'Acco Four Pocket Poly Ring Binder with Label Holder, Smoke, 1"',Sales:"10.43",Quantity:"7",Discount:"0.8",Profit:"-18.2525"},{"Row ID":"593","Order ID":"CA-2015-135405","Order Date":"2015/1/9","Ship Date":"2015/1/13","Ship Mode":"Standard Class","Customer ID":"MS-17830","Customer Name":"Melanie Seite",Segment:"Consumer",Country:"United States",City:"Laredo",State:"Texas","Postal Code":"78041",Region:"Central","Product ID":"OFF-AR-10004078",Category:"Office Supplies","Sub-Category":"Art","Product Name":"Newell 312",Sales:"9.344",Quantity:"2",Discount:"0.2",Profit:"1.168"},{"Row ID":"594","Order ID":"CA-2015-135405","Order Date":"2015/1/9","Ship Date":"2015/1/13","Ship Mode":"Standard Class","Customer ID":"MS-17830","Customer Name":"Melanie Seite",Segment:"Consumer",Country:"United States",City:"Laredo",State:"Texas","Postal Code":"78041",Region:"Central","Product ID":"TEC-AC-10001266",Category:"Technology","Sub-Category":"Accessories","Product Name":"Memorex Micro Travel Drive 8 GB",Sales:"31.2",Quantity:"3",Discount:"0.2",Profit:"9.75"},{"Row ID":"866","Order ID":"CA-2015-149020","Order Date":"2015/1/10","Ship Date":"2015/1/15","Ship Mode":"Standard Class","Customer ID":"AJ-10780","Customer Name":"Anthony Jacobs",Segment:"Corporate",Country:"United States",City:"Springfield",State:"Virginia","Postal Code":"22153",Region:"South","Product ID":"OFF-LA-10004272",Category:"Office Supplies","Sub-Category":"Labels","Product Name":"Avery 482",Sales:"2.89",Quantity:"1",Discount:"0",Profit:"1.3583"},{"Row ID":"867","Order ID":"CA-2015-149020","Order Date":"2015/1/10","Ship Date":"2015/1/15","Ship Mode":"Standard Class","Customer ID":"AJ-10780","Customer Name":"Anthony Jacobs",Segment:"Corporate",Country:"United States",City:"Springfield",State:"Virginia","Postal Code":"22153",Region:"South","Product ID":"FUR-FU-10000965",Category:"Furniture","Sub-Category":"Furnishings","Product Name":'Howard Miller 11-1/2" Diameter Ridgewood Wall Clock',Sales:"51.94",Quantity:"1",Discount:"0",Profit:"21.2954"},{"Row ID":"717","Order ID":"CA-2015-130092","Order Date":"2015/1/11","Ship Date":"2015/1/14","Ship Mode":"First Class","Customer ID":"SV-20365","Customer Name":"Seth Vernon",Segment:"Consumer",Country:"United States",City:"Dover",State:"Delaware","Postal Code":"19901",Region:"East","Product ID":"FUR-FU-10000010",Category:"Furniture","Sub-Category":"Furnishings","Product Name":"DAX Value U-Channel Document Frames, Easel Back",Sales:"9.94",Quantity:"2",Discount:"0",Profit:"3.0814"},{"Row ID":"764","Order ID":"CA-2015-162775","Order Date":"2015/1/13","Ship Date":"2015/1/15","Ship Mode":"Second Class","Customer ID":"CS-12250","Customer Name":"Chris Selesnick",Segment:"Corporate",Country:"United States",City:"Bossier City",State:"Louisiana","Postal Code":"71111",Region:"South","Product ID":"OFF-EN-10001990",Category:"Office Supplies","Sub-Category":"Envelopes","Product Name":"Staple envelope",Sales:"11.36",Quantity:"2",Discount:"0",Profit:"5.3392"},{"Row ID":"765","Order ID":"CA-2015-162775","Order Date":"2015/1/13","Ship Date":"2015/1/15","Ship Mode":"Second Class","Customer ID":"CS-12250","Customer Name":"Chris Selesnick",Segment:"Corporate",Country:"United States",City:"Bossier City",State:"Louisiana","Postal Code":"71111",Region:"South","Product ID":"OFF-EN-10001532",Category:"Office Supplies","Sub-Category":"Envelopes","Product Name":"Brown Kraft Recycled Envelopes",Sales:"50.94",Quantity:"3",Discount:"0",Profit:"25.47"},{"Row ID":"766","Order ID":"CA-2015-162775","Order Date":"2015/1/13","Ship Date":"2015/1/15","Ship Mode":"Second Class","Customer ID":"CS-12250","Customer Name":"Chris Selesnick",Segment:"Corporate",Country:"United States",City:"Bossier City",State:"Louisiana","Postal Code":"71111",Region:"South","Product ID":"TEC-AC-10003174",Category:"Technology","Sub-Category":"Accessories","Product Name":"Plantronics S12 Corded Telephone Headset System",Sales:"646.74",Quantity:"6",Discount:"0",Profit:"258.696"},{"Row ID":"767","Order ID":"CA-2015-162775","Order Date":"2015/1/13","Ship Date":"2015/1/15","Ship Mode":"Second Class","Customer ID":"CS-12250","Customer Name":"Chris Selesnick",Segment:"Corporate",Country:"United States",City:"Bossier City",State:"Louisiana","Postal Code":"71111",Region:"South","Product ID":"OFF-BI-10004187",Category:"Office Supplies","Sub-Category":"Binders","Product Name":"3-ring staple pack",Sales:"5.64",Quantity:"3",Discount:"0",Profit:"2.7072"},{"Row ID":"768","Order ID":"CA-2015-162775","Order Date":"2015/1/13","Ship Date":"2015/1/15","Ship Mode":"Second Class","Customer ID":"CS-12250","Customer Name":"Chris Selesnick",Segment:"Corporate",Country:"United States",City:"Bossier City",State:"Louisiana","Postal Code":"71111",Region:"South","Product ID":"OFF-ST-10000025",Category:"Office Supplies","Sub-Category":"Storage","Product Name":"Fellowes Stor/Drawer Steel Plus Storage Drawers",Sales:"572.58",Quantity:"6",Discount:"0",Profit:"34.3548"},{"Row ID":"2979","Order ID":"CA-2015-109232","Order Date":"2015/1/13","Ship Date":"2015/1/16","Ship Mode":"Second Class","Customer ID":"ND-18370","Customer Name":"Natalie DeCherney",Segment:"Consumer",Country:"United States",City:"Mount Pleasant",State:"South Carolina","Postal Code":"29464",Region:"South","Product ID":"FUR-CH-10000422",Category:"Furniture","Sub-Category":"Chairs","Product Name":"Global Highback Leather Tilter in Burgundy",Sales:"545.94",Quantity:"6",Discount:"0",Profit:"87.3504"},{"Row ID":"4938","Order ID":"CA-2015-157147","Order Date":"2015/1/13","Ship Date":"2015/1/18","Ship Mode":"Standard Class","Customer ID":"BD-11605","Customer Name":"Brian Dahlen",Segment:"Consumer",Country:"United States",City:"San Francisco",State:"California","Postal Code":"94109",Region:"West","Product ID":"OFF-ST-10000078",Category:"Office Supplies","Sub-Category":"Storage","Product Name":"Tennsco 6- and 18-Compartment Lockers",Sales:"1325.85",Quantity:"5",Discount:"0",Profit:"238.653"},{"Row ID":"4939","Order ID":"CA-2015-157147","Order Date":"2015/1/13","Ship Date":"2015/1/18","Ship Mode":"Standard Class","Customer ID":"BD-11605","Customer Name":"Brian Dahlen",Segment:"Consumer",Country:"United States",City:"San Francisco",State:"California","Postal Code":"94109",Region:"West","Product ID":"FUR-BO-10003034",Category:"Furniture","Sub-Category":"Bookcases","Product Name":"O'Sullivan Elevations Bookcase, Cherry Finish",Sales:"333.999",Quantity:"3",Discount:"0.15",Profit:"3.9294"},{"Row ID":"4940","Order ID":"CA-2015-157147","Order Date":"2015/1/13","Ship Date":"2015/1/18","Ship Mode":"Standard Class","Customer ID":"BD-11605","Customer Name":"Brian Dahlen",Segment:"Consumer",Country:"United States",City:"San Francisco",State:"California","Postal Code":"94109",Region:"West","Product ID":"OFF-AR-10003514",Category:"Office Supplies","Sub-Category":"Art","Product Name":"4009 Highlighters by Sanford",Sales:"19.9",Quantity:"5",Discount:"0",Profit:"6.567"}],So=[{bloggerId:1,bloggerName:"Virtual Anchor Xiaohua",bloggerAvatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/flower.jpg",introduction:"Hi everyone, I am Xiaohua, the virtual host. I am a little fairy who likes games, animation and food. I hope to share happy moments with you through live broadcast.",fansCount:400,worksCount:10,viewCount:5,city:"Dream City",tags:["game","anime","food"]},{bloggerId:2,bloggerName:"Virtual anchor little wolf",bloggerAvatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/wolf.jpg",introduction:"Hello everyone, I am the virtual anchor Little Wolf. I like music, travel and photography, and I hope to explore the beauty of the world with you through live broadcast.",fansCount:800,worksCount:20,viewCount:15,city:"City of Music",tags:["music","travel","photography"]},{bloggerId:3,bloggerName:"Virtual anchor bunny",bloggerAvatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/rabbit.jpg",introduction:"Hello everyone, I am the virtual anchor Xiaotu. I like painting, handicrafts and beauty makeup. I hope to share creativity and fashion with you through live broadcast.",fansCount:600,worksCount:15,viewCount:10,city:"City of Art",tags:["painting","handmade","beauty makeup"]},{bloggerId:4,bloggerName:"Virtual anchor kitten",bloggerAvatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/cat.jpg",introduction:"Hello everyone, I am the virtual host Kitty. I am a lazy cat who likes dancing, fitness and cooking. I hope to live a healthy and happy life with everyone through the live broadcast.",fansCount:1e3,worksCount:30,viewCount:20,city:"Health City",tags:["dance","fitness","cooking"]},{bloggerId:5,bloggerName:"Virtual anchor Bear",bloggerAvatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/bear.jpg",introduction:"Hello everyone, I am the virtual host Xiaoxiong. A little wise man who likes movies, reading and philosophy, I hope to explore the meaning of life with you through live broadcast.",fansCount:1200,worksCount:25,viewCount:18,city:"City of Wisdom",tags:["Movie","Literature"]},{bloggerId:6,bloggerName:"Virtual anchor bird",bloggerAvatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/bird.jpeg",introduction:"Hello everyone, I am the virtual anchor Xiaoniao. I like singing, acting and variety shows. I hope to be happy with everyone through the live broadcast.",fansCount:900,worksCount:12,viewCount:8,city:"Happy City",tags:["music","performance","variety"]}],bo=[{dimensionKey:"Region",title:"Region",headerStyle:{textStick:!0}},"Category"],Io=[{dimensionKey:"Order Year",title:"Order Year",headerStyle:{textStick:!0}},"Ship Mode"],Ro=[{indicatorKey:"Quantity",title:"Quantity",width:"auto",cellType:"chart",chartModule:"vchart",chartSpec:{stack:!0,type:"bar",data:{id:"data",fields:{"Sub-Category":{sortIndex:0,domain:["Chairs","Tables","Bookcases","Furnishings","Binders","Art","Storage","Appliances","Envelopes","Fasteners","Paper","Labels","Supplies","Accessories","Phones","Copiers","Machines"]},"Segment-Indicator":{sortIndex:1,domain:["Consumer-Quantity","Corporate-Quantity","Home Office-Quantity","Consumer-Sales","Corporate-Sales","Home Office-Sales","Consumer-Profit","Corporate-Profit","Home Office-Profit"]}}},xField:["Sub-Category"],yField:"Quantity",seriesField:"Segment-Indicator",axes:[{orient:"left",visible:!0,label:{visible:!0}},{orient:"bottom",visible:!0}],bar:{state:{selected:{fill:"yellow"},selected_reverse:{opacity:.2}}},scales:[{id:"color",type:"ordinal",domain:["Consumer-Quantity","Corporate-Quantity","Home Office-Quantity","Consumer-Sales","Corporate-Sales","Home Office-Sales","Consumer-Profit","Corporate-Profit","Home Office-Profit"],range:["#2E62F1","#4DC36A","#FF8406","#FFCC00","#4F44CF","#5AC8FA","#003A8C","#B08AE2","#FF6341","#98DD62","#07A199","#87DBDD"]}]},style:{padding:1}},{indicatorKey:"Sales",title:"Sales & Profit",cellType:"chart",chartModule:"vchart",chartSpec:{type:"common",series:[{type:"bar",data:{id:"data1",fields:{"Sub-Category":{sortIndex:0,domain:["Chairs","Tables","Bookcases","Furnishings","Binders","Art","Storage","Appliances","Envelopes","Fasteners","Paper","Labels","Supplies","Accessories","Phones","Copiers","Machines"]},"Segment-Indicator":{sortIndex:1,domain:["Consumer-Quantity","Corporate-Quantity","Home Office-Quantity","Consumer-Sales","Corporate-Sales","Home Office-Sales","Consumer-Profit","Corporate-Profit","Home Office-Profit"]}}},stack:!0,xField:["Sub-Category"],yField:"Sales",seriesField:"Segment-Indicator",bar:{state:{selected:{fill:"yellow"},selected_reverse:{opacity:.2}}}},{type:"line",data:{id:"data2",fields:{"Sub-Category":{sortIndex:0,domain:["Chairs","Tables","Bookcases","Furnishings","Binders","Art","Storage","Appliances","Envelopes","Fasteners","Paper","Labels","Supplies","Phones","Accessories","Machines","Copiers"]},"Segment-Indicator":{sortIndex:1,domain:["Consumer-Quantity","Corporate-Quantity","Home Office-Quantity","Consumer-Sales","Corporate-Sales","Home Office-Sales","Consumer-Profit","Corporate-Profit","Home Office-Profit"]}}},stack:!1,xField:["Sub-Category"],yField:"Profit",seriesField:"Segment-Indicator",line:{state:{selected:{lineWidth:3},selected_reverse:{lineWidth:1}}},point:{state:{selected:{fill:"yellow"},selected_reverse:{fill:"#ddd"}}}}],scales:[{id:"color",type:"ordinal",domain:["Consumer-Quantity","Corporate-Quantity","Home Office-Quantity","Consumer-Sales","Corporate-Sales","Home Office-Sales","Consumer-Profit","Corporate-Profit","Home Office-Profit"],range:["#2E62F1","#4DC36A","#FF8406","#FFCC00","#4F44CF","#5AC8FA","#003A8C","#B08AE2","#FF6341","#98DD62","#07A199","#87DBDD"]}]},style:{padding:1}}],Do={class:"h-full"},ko=lt({name:"plugin_tables_vtable",__name:"index",setup(R){Po("vchart",_i);const e=["#3370ff","#34c724","#ff9f1a","#ff4050","#1f2329"],t=Hi(),i=_e(null),r=Le(()=>({theme:t.darkMode?it:ot})),o=_e(qt),l=_e(null),s=Le(()=>({groupBy:["Category","Sub-Category"],theme:(t.darkMode?it:ot).extends({groupTitleStyle:{fontWeight:"bold",bgColor:S=>{const{col:P,row:y,table:I}=S,T=I.getGroupTitleLevel(P,y);return T!==void 0?e[T%e.length]:"white"}}})})),a=_e(qt),n=_e(null),d=Le(()=>({tooltip:{isShowOverflowTextTooltip:!0},dataConfig:{sortRules:[{sortField:"Category",sortBy:["Office Supplies","Technology","Furniture"]}]},widthMode:"standard",theme:t.darkMode?it:ot,emptyTip:{text:"no data records"}})),h=_e([{indicatorKey:"Quantity",title:"Quantity",width:"auto",showSort:!1,headerStyle:{fontWeight:"normal"},style:{padding:[16,28,16,28],color(p){return p.dataValue>=0?"black":"red"}}},{indicatorKey:"Sales",title:"Sales",width:"auto",showSort:!1,headerStyle:{fontWeight:"normal"},format:p=>`$${Number(p).toFixed(2)}`,style:{padding:[16,28,16,28],color(p){return p.dataValue>=0?"black":"red"}}},{indicatorKey:"Profit",title:"Profit",width:"auto",showSort:!1,headerStyle:{fontWeight:"normal"},format:p=>`$${Number(p).toFixed(2)}`,style:{padding:[16,28,16,28],color(p){return p.dataValue>=0?"black":"red"}}}]),u=_e([{dimensionKey:"City",title:"City",headerStyle:{textStick:!0},width:"auto"}]),c=_e([]),v=_e(null),f=Le(()=>({rows:Io,columns:bo,indicators:Ro,indicatorsAsCol:!1,defaultRowHeight:200,defaultHeaderRowHeight:50,defaultColWidth:280,defaultHeaderColWidth:100,indicatorTitle:"指标",autoWrapText:!0,corner:{titleOnDimension:"row",headerStyle:{autoWrapText:!0}},legends:{orient:"bottom",type:"discrete",data:[{label:"Consumer-Quantity",shape:{fill:"#2E62F1",symbolType:"circle"}},{label:"Consumer-Quantity",shape:{fill:"#4DC36A",symbolType:"square"}},{label:"Home Office-Quantity",shape:{fill:"#FF8406",symbolType:"square"}},{label:"Consumer-Sales",shape:{fill:"#FFCC00",symbolType:"square"}},{label:"Consumer-Sales",shape:{fill:"#4F44CF",symbolType:"square"}},{label:"Home Office-Sales",shape:{fill:"#5AC8FA",symbolType:"square"}},{label:"Consumer-Profit",shape:{fill:"#003A8C",symbolType:"square"}},{label:"Consumer-Profit",shape:{fill:"#B08AE2",symbolType:"square"}},{label:"Home Office-Profit",shape:{fill:"#FF6341",symbolType:"square"}}]},theme:(t.darkMode?it:ot).extends({bodyStyle:{borderColor:"gray",borderLineWidth:[1,0,0,1]},headerStyle:{borderColor:"gray",borderLineWidth:[0,0,1,1],hover:{cellBgColor:"#CCE0FF"}},rowHeaderStyle:{borderColor:"gray",borderLineWidth:[1,1,0,0],hover:{cellBgColor:"#CCE0FF"}},cornerHeaderStyle:{borderColor:"gray",borderLineWidth:[0,1,1,0],hover:{cellBgColor:""}},cornerRightTopCellStyle:{borderColor:"gray",borderLineWidth:[0,0,1,1],hover:{cellBgColor:""}},cornerLeftBottomCellStyle:{borderColor:"gray",borderLineWidth:[1,1,0,0],hover:{cellBgColor:""}},cornerRightBottomCellStyle:{borderColor:"gray",borderLineWidth:[1,0,0,1],hover:{cellBgColor:""}},rightFrozenStyle:{borderColor:"gray",borderLineWidth:[1,0,1,1],hover:{cellBgColor:""}},bottomFrozenStyle:{borderColor:"gray",borderLineWidth:[1,1,0,1],hover:{cellBgColor:""}},selectionStyle:{cellBgColor:"",cellBorderColor:""},frameStyle:{borderLineWidth:0}}),emptyTip:{text:"no data records"}})),H=_e([]),g=p=>{var S;(S=v==null?void 0:v.value)==null||S.vTableInstance.updateFilterRules([{filterKey:"Segment-Indicator",filteredValues:p.value}])},m=_e(null),w=Le(()=>({defaultRowHeight:80,theme:t.darkMode?it:ot})),C=_e(So),_=_e({fontFamily:"Arial",fontSize:12,fontWeight:"bold"});return Gt(()=>{fetch("https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/North_American_Superstore_Pivot_data.json").then(p=>p.json()).then(p=>{c.value=p}),fetch("https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/North_American_Superstore_Pivot_Chart_data.json").then(p=>p.json()).then(p=>{H.value=p})}),(p,S)=>{const P=Ti,y=pi,I=Pi;return Ke(),Ve("div",Do,[E(I,{fill:"",direction:"vertical",class:"mb-16px w-full",size:16},{default:we(()=>[E(P,{header:"List Table",class:"h-full w-2/3 card-wrapper"},{default:we(()=>[E(U(_t),{ref_key:"listTableRef",ref:i,options:r.value,records:o.value,height:"400px"},{default:we(()=>[E(U(Z),{field:"Order ID",title:"Order ID",width:"auto"}),E(U(Z),{field:"Customer ID",title:"Customer ID",width:"auto"}),E(U(Z),{field:"Product Name",title:"Product Name",width:"auto"}),E(U(Z),{field:"Category",title:"Category",width:"auto"}),E(U(Z),{field:"Sub-Category",title:"Sub-Category",width:"auto"}),E(U(Z),{field:"Region",title:"Region",width:"auto"}),E(U(Z),{field:"City",title:"City",width:"auto"}),E(U(Z),{field:"Order Date",title:"Order Date",width:"auto"}),E(U(Z),{field:"Quantity",title:"Quantity",width:"auto"}),E(U(Z),{field:"Sales",title:"Sales",width:"auto"}),E(U(Z),{field:"Profit",title:"Profit",width:"auto"})]),_:1},8,["options","records"])]),_:1}),E(P,{header:"Group Table",class:"h-full w-2/3 card-wrapper"},{default:we(()=>[E(U(_t),{ref_key:"groupTableRef",ref:l,options:s.value,records:a.value,height:"400px"},{default:we(()=>[E(U(Z),{field:"Order ID",title:"Order ID",width:"auto"}),E(U(Z),{field:"Customer ID",title:"Customer ID",width:"auto"}),E(U(Z),{field:"Product Name",title:"Product Name",width:"auto"}),E(U(Z),{field:"Category",title:"Category",width:"auto"}),E(U(Z),{field:"Sub-Category",title:"Sub-Category",width:"auto"}),E(U(Z),{field:"Region",title:"Region",width:"auto"}),E(U(Z),{field:"City",title:"City",width:"auto"}),E(U(Z),{field:"Order Date",title:"Order Date",width:"auto"}),E(U(Z),{field:"Quantity",title:"Quantity",width:"auto"}),E(U(Z),{field:"Sales",title:"Sales",width:"auto"}),E(U(Z),{field:"Profit",title:"Profit",width:"auto"})]),_:1},8,["options","records"])]),_:1}),E(P,{header:"Pivot Table",class:"h-full w-2/3 card-wrapper"},{default:we(()=>[E(U(Ho),{ref_key:"pivotTableRef",ref:n,options:d.value,records:c.value,height:"400px"},{default:we(()=>[E(U(vi),{title:"Category","dimension-key":"Category","header-style":{textStick:!0},width:"auto"}),(Ke(!0),Ve(et,null,vt(u.value,(T,b)=>(Ke(),gt(U(gi),{key:b,"dimension-key":T.dimensionKey,title:T.title,"header-style":T.headerStyle,width:T.width},null,8,["dimension-key","title","header-style","width"]))),128)),(Ke(!0),Ve(et,null,vt(h.value,(T,b)=>(Ke(),gt(U(Ci),{key:b,"indicator-key":T.indicatorKey,title:T.title,width:T.width,"show-sort":T.showSort,"header-style":T.headerStyle,format:T.format,style:rt(T.style)},null,8,["indicator-key","title","width","show-sort","header-style","format","style"]))),128)),E(U(fi),{"title-on-dimension":"row"}),E(U(yi),{"menu-type":"html","context-menu-items":["copy","paste","delete","..."]})]),_:1},8,["options","records"])]),_:1}),E(P,{header:"Pivot Chart",class:"h-full w-2/3 card-wrapper"},{default:we(()=>[E(U(To),{ref_key:"pivotChartRef",ref:v,options:f.value,records:H.value,height:"800px",onOnLegendItemClick:g},null,8,["options","records"])]),_:1}),E(P,{header:"Custom Component",class:"h-full w-2/3 card-wrapper"},{default:we(()=>[E(U(_t),{ref_key:"customLayoutListTableRef",ref:m,options:w.value,records:C.value,height:"400px"},{default:we(()=>[E(U(Z),{field:"bloggerId",title:"Order Number",width:"100"}),E(U(Z),{field:"bloggerName",title:"Anchor Nickname",width:330},{customLayout:we(({record:T,height:b,width:A})=>[E(U(Ze),{height:b,width:A,display:"flex","flex-direction":"row","flex-wrap":"nowrap"},{default:we(()=>[E(U(Ze),{height:b,width:60,display:"flex","flex-direction":"column","align-items":"center","justify-content":"space-around",fill:"red",opacity:.1},{default:we(()=>[E(U(St),{id:"icon0",width:50,height:50,image:T.bloggerAvatar,"corner-radius":25},null,8,["image"])]),_:2},1032,["height"]),E(U(Ze),{height:b,width:A-60,display:"flex","flex-direction":"column","flex-wrap":"nowrap"},{default:we(()=>[E(U(Ze),{height:b/2,width:A-60,display:"flex","flex-wrap":"wrap","align-items":"center",fill:"orange",opacity:.1},{default:we(()=>[E(U(bt),{text:T.bloggerName,"font-size":13,"font-family":"sans-serif",fill:"black","bounds-padding":[0,0,0,10]},null,8,["text"]),E(U(St),{id:"location",image:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/location.svg",width:15,height:15,"bounds-padding":[0,0,0,10],cursor:"pointer"}),E(U(bt),{text:T.city,"font-size":11,"font-family":"sans-serif",fill:"#6f7070"},null,8,["text"])]),_:2},1032,["height","width"]),E(U(Ze),{height:b/2,width:A-60,display:"flex","align-items":"center",fill:"yellow",opacity:.1},{default:we(()=>[(Ke(!0),Ve(et,null,vt(T==null?void 0:T.tags,F=>(Ke(),gt(U(mi),{key:F,text:F,"text-style":{fontSize:10,fontFamily:"sans-serif",fill:"rgb(51, 101, 238)"},panel:{visible:!0,fill:"#f4f4f2",cornerRadius:5},space:5,"bounds-padding":[0,0,0,5]},null,8,["text"]))),128))]),_:2},1032,["height","width"])]),_:2},1032,["height","width"])]),_:2},1032,["height","width"])]),_:1}),E(U(Z),{field:"fansCount",title:"Fans Count",width:"120","field-format":T=>T.fansCount+"w",style:rt(_.value)},null,8,["field-format","style"]),E(U(Z),{field:"worksCount",title:"Works Count",style:rt(_.value),width:"135"},null,8,["style"]),E(U(Z),{field:"viewCount",title:"View Count",width:"120","field-format":T=>T.viewCount+"w",style:rt(_.value)},null,8,["field-format","style"])]),_:1},8,["options","records"])]),_:1}),E(P,{class:"h-full w-2/3 card-wrapper"},{default:we(()=>[E(y,{label:"More VTable Demos: ",link:"https://www.visactor.com/vtable/example"})]),_:1})]),_:1})])}}});export{ko as default};
