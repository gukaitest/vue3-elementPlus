import{r as O,R as i,aH as P,bP as x,t as g,v as n,z as f,F as S,al as z,y as R,C as K,ae as B,D as E,K as U,P as y,J as H,aP as X,aO as Z}from"./vue-vendor-DLKW-W3j.js";import{j as k}from"./index-C1YnPq5G.js";const M="/assets/jpg/001-Bg3uSwIK.jpg",V="/assets/jpg/002-CQfIn_Jg.jpg",$="/assets/jpg/003-BQJ3SB9i.jpg",J="/assets/jpg/004-D_CqIUBy.jpg",F="/assets/jpg/005-B44vLpON.jpg",Q="/assets/jpg/006-XFl_NOhH.jpg",q="/assets/jpg/007-2OPtZVUF.jpg",A="/assets/jpg/008-z0s8QBQE.jpg",D="/assets/jpg/009-6TAqM2n1.jpg",G="/assets/jpg/soybean-JC38yUrs.jpg",W={class:"scroll-container"},Y=["src","onLoad"],ee={key:0,class:"loading-indicator"},se={key:0,class:"loading-more"},te={key:1,class:"no-more"},ae=O({__name:"image-load-new",setup(C){let t=null;const h=Object.assign({"../../assets/imgs/001.jpg":M,"../../assets/imgs/002.jpg":V,"../../assets/imgs/003.jpg":$,"../../assets/imgs/004.jpg":J,"../../assets/imgs/005.jpg":F,"../../assets/imgs/006.jpg":Q,"../../assets/imgs/007.jpg":q,"../../assets/imgs/008.jpg":A,"../../assets/imgs/009.jpg":D,"../../assets/imgs/soybean.jpg":G}),p=[new URL("../../assets/imgs/001.webp",import.meta.url).href,new URL("../../assets/imgs/002.webp",import.meta.url).href,new URL("../../assets/imgs/003.webp",import.meta.url).href,new URL("../../assets/imgs/004.webp",import.meta.url).href,new URL("../../assets/imgs/005.webp",import.meta.url).href,new URL("../../assets/imgs/006.webp",import.meta.url).href,new URL("../../assets/imgs/007.webp",import.meta.url).href,new URL("../../assets/imgs/008.webp",import.meta.url).href,new URL("../../assets/imgs/009.webp",import.meta.url).href];Object.entries(h).sort(([s],[a])=>s.localeCompare(a)).map(([,s])=>s);const m=p;m.length;const r={pageSize:3,allImages:m,observerOptions:{root:null,rootMargin:"0px 0px 200px 0px",threshold:.1}},c=i([]),u=i(1),l=i(!1),_=i(!0),v=i([]),w=i([]),j=s=>{if(!s)return;const a=s.$el??s;a instanceof HTMLElement&&(w.value.includes(a)||w.value.push(a))},e=s=>{console.log("Intersection Observer triggered,entries:",s),s.forEach(a=>{a.isIntersecting&&!l.value&&(b(),t==null||t.unobserve(a.target))})},o=()=>{t==null||t.disconnect(),B(()=>{t=new IntersectionObserver(e,r.observerOptions);const s=w.value.filter(I=>I.isConnected&&I.offsetParent!==null),a=s[s.length-1];a?(console.log("添加观察元素Observing element:",a),t.observe(a)):console.warn("No valid elements to observe")})},d=s=>{v.value[s]=!0},b=async()=>{if(l.value||!_.value)return;l.value=!0;const s=(u.value-1)*r.pageSize,a=s+r.pageSize;c.value=[...c.value,...r.allImages.slice(s,a)],v.value=[...v.value,...Array.from({length:Math.min(r.pageSize,r.allImages.length-s)})],_.value=a<r.allImages.length,u.value+=1,l.value=!1,B(()=>o())};return P(async()=>{await b()}),x(()=>{t==null||t.disconnect(),t=null}),(s,a)=>(n(),g("div",W,[(n(!0),g(S,null,z(c.value,(I,L)=>(n(),g("div",{key:L,ref_for:!0,ref:T=>j(T),class:"image-item"},[R("img",{src:I,alt:"Gallery Image",class:K({loaded:v.value[L]}),onLoad:T=>d(L)},null,42,Y),v.value[L]?f("",!0):(n(),g("div",ee,a[0]||(a[0]=[R("div",{class:"loader"},null,-1)])))]))),128)),l.value?(n(),g("div",se,"加载中...")):f("",!0),_.value?f("",!0):(n(),g("div",te,"已加载全部内容"))]))}}),oe=k(ae,[["__scopeId","data-v-7803f176"]]),ne=["src"],le={key:0,class:"loading"},re={key:1,class:"no-more"},N=3,ie=O({name:"ImageLoadOld",__name:"image-load-old",setup(C){const t=Object.assign({"../../assets/imgs/001.jpg":M,"../../assets/imgs/002.jpg":V,"../../assets/imgs/003.jpg":$,"../../assets/imgs/004.jpg":J,"../../assets/imgs/005.jpg":F,"../../assets/imgs/006.jpg":Q,"../../assets/imgs/007.jpg":q,"../../assets/imgs/008.jpg":A,"../../assets/imgs/009.jpg":D,"../../assets/imgs/soybean.jpg":G}),h=[new URL("../../assets/imgs/001.webp",import.meta.url).href,new URL("../../assets/imgs/002.webp",import.meta.url).href,new URL("../../assets/imgs/003.webp",import.meta.url).href,new URL("../../assets/imgs/004.webp",import.meta.url).href,new URL("../../assets/imgs/005.webp",import.meta.url).href,new URL("../../assets/imgs/006.webp",import.meta.url).href,new URL("../../assets/imgs/007.webp",import.meta.url).href,new URL("../../assets/imgs/008.webp",import.meta.url).href,new URL("../../assets/imgs/009.webp",import.meta.url).href];Object.entries(t).sort(([e],[o])=>e.localeCompare(o)).map(([,e])=>e);const p=h;p.length;const m=i([]),r=i(1),c=i(!1),u=i(!0),l=i(null),_=async()=>{if(c.value||!u.value)return;c.value=!0;const e=(r.value-1)*N,o=e+N;m.value.push(...p.slice(e,o)),u.value=o<p.length,r.value+=1,c.value=!1},v=(e,o=100)=>(console.log("isNearBottom:el.scrollTop, el.clientHeight, el.scrollHeight, threshold",e.scrollTop+e.clientHeight>=e.scrollHeight-o,e.scrollTop,e.clientHeight,e.scrollHeight,o),e.scrollTop+e.clientHeight>=e.scrollHeight-o),j=((e,o)=>{let d;return(...b)=>{clearTimeout(d),d=setTimeout(()=>e(...b),o)}})(()=>{l.value&&v(l.value)&&_()},300);return P(async()=>{await _()}),x(()=>{l.value&&l.value.removeEventListener("scroll",j)}),(e,o)=>(n(),g("div",{ref_key:"scrollContainer",ref:l,class:"scroll-container",onScroll:o[0]||(o[0]=(...d)=>E(j)&&E(j)(...d))},[(n(!0),g(S,null,z(m.value,(d,b)=>(n(),g("div",{key:b,class:"image-item"},[R("img",{src:d,alt:"图片"},null,8,ne)]))),128)),c.value?(n(),g("div",le,"加载中...")):f("",!0),u.value?f("",!0):(n(),g("div",re,"没有更多了~"))],544))}}),ce=k(ie,[["__scopeId","data-v-c1c47abd"]]),ge=O({name:"personal-content_image-loading-optimization",__name:"index",setup(C){const t=i("first"),h=(p,m)=>{console.log(p,m)};return(p,m)=>{const r=ce,c=X,u=oe,l=Z;return n(),U(l,{modelValue:t.value,"onUpdate:modelValue":m[0]||(m[0]=_=>t.value=_),class:"demo-tabs",onTabClick:h},{default:y(()=>[H(c,{label:"传统实现方式",name:"first"},{default:y(()=>[t.value==="first"?(n(),U(r,{key:0})):f("",!0)]),_:1}),H(c,{label:"IntersectionObserver实现方式",name:"second"},{default:y(()=>[t.value==="second"?(n(),U(u,{key:0})):f("",!0)]),_:1})]),_:1},8,["modelValue"])}}}),ue=k(ge,[["__scopeId","data-v-ca423d0c"]]);export{ue as default};
