import{bD as w,bE as T,bF as m,bG as p,bH as M,bI as y}from"./vue-vendor-DLKW-W3j.js";import{a as E,k as h,n as A,$ as g}from"./index-CE1BUwf_.js";const C="BACKEND_ERROR",R=(e,t)=>{const{tokenRefresher:r}=t,{onAuthRequired:a,onResponseRefreshToken:c}=T({refreshTokenOnSuccess:{isExpired:(s,n)=>(r==null?void 0:r.isExpired(s,n))||!1,handler:async(s,n)=>r==null?void 0:r.handler(s,n)},refreshTokenOnError:{isExpired:(s,n)=>(r==null?void 0:r.isExpired(s,n))||!1,handler:async(s,n)=>r==null?void 0:r.handler(s,n)}});return w({...e,timeout:e.timeout??10*1e3,requestAdapter:e.requestAdapter??m(),statesHook:p,beforeRequest:a(t.onRequest),responded:c({onSuccess:async(s,n)=>{var u;let o=null,i=null;try{await t.isBackendSuccess(s)?i=await t.transformBackendResponse(s):(o=new Error("the backend request error"),o.code=C)}catch(S){o=S}if(o)throw await((u=t.onError)==null?void 0:u.call(t,o,s,n)),o;return i},onComplete:t.onComplete,onError:(s,n)=>{var o;return(o=t.onError)==null?void 0:o.call(t,s,null,n)}})})},_=M({"[POST]/systemManage/addUser":()=>({code:"0000",msg:"success",data:null}),"[POST]/systemManage/updateUser":()=>({code:"0000",msg:"success",data:null}),"[DELETE]/systemManage/deleteUser":()=>({code:"0000",msg:"success",data:null}),"[DELETE]/systemManage/batchDeleteUser":()=>({code:"0000",msg:"success",data:null}),"[POST]/auth/sendCaptcha":()=>({code:"0000",msg:"success",data:null}),"[POST]/auth/verifyCaptcha":()=>({code:"0000",msg:"success",data:null}),"/mock/getLastTime":()=>({code:"0000",msg:"success",data:{time:new Date().toLocaleTimeString()}})});function v(){const e=h.get("token");return e?`Bearer ${e}`:null}async function x(){const{resetStore:e}=E(),t=h.get("refreshToken")||"",r=O(t);r.meta.authRole="refreshToken";try{const a=await r;h.set("token",a.token),h.set("refreshToken",a.refreshToken)}catch(a){throw e(),a}}function k(e,t){var a;(a=e.errMsgStack)!=null&&a.length||(e.errMsgStack=[]),e.errMsgStack.includes(t)||(e.errMsgStack.push(t),window.$message&&window.$message({type:"error",message:t,onClose:()=>{e.errMsgStack=e.errMsgStack.filter(c=>c!==t),setTimeout(()=>{e.errMsgStack=[]},5e3)}}))}const L={VITE_OTHER_SERVICE_BASE_URL:`{
  "demo": "http://localhost:9529"
}`,VITE_SERVICE_BASE_URL:"http://47.103.169.121:8084"},b=!1,{baseURL:B}=A(L,b),d={errMsgStack:[]};y([_],{httpAdapter:m(),delay:1e3,enable:!0,matchMode:"methodurl"});const f=R({baseURL:B,requestAdapter:m()},{onRequest({config:e}){const t=v();e.headers.Authorization=t,e.headers.apifoxToken="XL299LiMEDZ0H5h3A29PxwQXdMJqWyY2"},tokenRefresher:{async isExpired(e){const t="9999,9998,3333".split(",")||[],{code:r}=await e.clone().json();return t.includes(String(r))},async handler(){await x()}},async isBackendSuccess(e){const r=await e.clone().json();return String(r.code)==="0000"},async transformBackendResponse(e){return(await e.clone().json()).data},async onError(e,t){var i;const r=E();let a=e.message,c="";if(t){const u=await(t==null?void 0:t.clone().json());a=u.msg,c=String(u.code)}function l(){k(d,a),r.resetStore()}function s(){l(),window.removeEventListener("beforeunload",l),d.errMsgStack=d.errMsgStack.filter(u=>u!==a)}throw("8888,8889".split(",")||[]).includes(c)?(l(),e):("7777,7778".split(",")||[]).includes(c)&&!((i=d.errMsgStack)!=null&&i.includes(a))?(d.errMsgStack=[...d.errMsgStack||[],a],window.addEventListener("beforeunload",l),window.$messageBox&&window.$messageBox({type:"error",title:g("common.error"),message:a,confirmButtonText:g("common.confirm"),closeOnClickModal:!1,closeOnPressEscape:!1,callback(){s()}}),e):(k(d,a),e)}});function P(e){return f.Post("/auth/sendCaptcha",{phone:e})}function U(e,t){return f.Post("/auth/verifyCaptcha",{phone:e,code:t})}function O(e){return f.Post("/auth/refreshToken",{refreshToken:e},{meta:{authRole:"refreshToken"}})}function $(e,t){return f.Get("/auth/error",{params:{code:e,msg:t},shareRequest:!1})}export{f as a,$ as f,P as s,U as v};
