# ğŸ“Š æ‰“åŒ…åˆ†ææŠ¥å‘Šä¸ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ” å½“å‰æ‰“åŒ…é—®é¢˜åˆ†æ

æ ¹æ® `rollup-plugin-visualizer` çš„åˆ†ææŠ¥å‘Šï¼Œå‘ç°ä»¥ä¸‹ä¸»è¦é—®é¢˜ï¼š

### 1. **å¤§å‹ä¾èµ–åº“å ç”¨è¿‡å¤šç©ºé—´**

#### ä¸»è¦é—®é¢˜åº“ï¼š

| åº“å | ç”¨é€” | é—®é¢˜ | ä¼˜åŒ–å»ºè®® |
|------|------|------|---------|
| **echarts@5.6.0** | å›¾è¡¨åº“ | ä½“ç§¯å·¨å¤§ï¼ŒåŒ…å«å®Œæ•´åŠŸèƒ½ | æŒ‰éœ€å¯¼å…¥æˆ–ä½¿ç”¨è½»é‡æ›¿ä»£ |
| **@visactor/vchart@1.13.6** | æ•°æ®å¯è§†åŒ– | å¤§å‹å¯è§†åŒ–åº“ | æŒ‰éœ€å¯¼å…¥ |
| **@antv/g6@5.0.44** | å›¾å½¢åº“ | åŠŸèƒ½å®Œæ•´ä½†ä½“ç§¯å¤§ | æŒ‰éœ€å¯¼å…¥ |
| **@visactor/vtable@1.17.0** | è¡¨æ ¼ç»„ä»¶ | åŠŸèƒ½ä¸°å¯Œä½†ä½“ç§¯å¤§ | æŒ‰éœ€å¯¼å…¥ |
| **element-plus@2.9.7** | UIç»„ä»¶åº“ | å®Œæ•´å¯¼å…¥æ‰€æœ‰ç»„ä»¶ | æŒ‰éœ€å¯¼å…¥ç»„ä»¶ |
| **dhtmlx-gantt@9.0.5** | ç”˜ç‰¹å›¾ | å¤§å‹ä¸“ä¸šåº“ | æ‡’åŠ è½½ |
| **vxe-table@4.13.40** | è¡¨æ ¼ç»„ä»¶ | åŠŸèƒ½å®Œæ•´ | æŒ‰éœ€å¯¼å…¥ |
| **vditor@3.10.9** | Markdownç¼–è¾‘å™¨ | å®Œæ•´åŠŸèƒ½ | æ‡’åŠ è½½ |
| **wangeditor@4.7.15** | å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ | å®Œæ•´åŠŸèƒ½ | æ‡’åŠ è½½ |

### 2. **ä»£ç åˆ†å‰²ä¸è¶³**

- å¤šä¸ªå¤§å‹åº“è¢«æ‰“åŒ…åˆ°ä¸» bundle ä¸­
- è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰²å¯èƒ½ä¸å¤Ÿç»†åŒ–
- ç¬¬ä¸‰æ–¹åº“æ²¡æœ‰åˆç†åˆ†ç¦»

### 3. **é‡å¤ä¾èµ–é£é™©**

- `@antv` ç³»åˆ—åº“å¯èƒ½æœ‰é‡å¤ä¾èµ–
- `@visactor` ç³»åˆ—åº“å¯èƒ½æœ‰å…±äº«ä¾èµ–æœªä¼˜åŒ–

---

## ğŸ¯ ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šä»£ç åˆ†å‰²ä¼˜åŒ–ï¼ˆæ¨èï¼‰

#### 1. é…ç½®æ‰‹åŠ¨ä»£ç åˆ†å‰²

åœ¨ `vite.config.ts` ä¸­æ·»åŠ  `rollupOptions` é…ç½®ï¼š

```typescript
build: {
  rollupOptions: {
    output: {
      // æ‰‹åŠ¨ä»£ç åˆ†å‰²
      manualChunks: {
        // Vue æ ¸å¿ƒåº“
        'vue-vendor': ['vue', 'vue-router', 'pinia'],
        
        // UI ç»„ä»¶åº“
        'element-plus': ['element-plus'],
        
        // å›¾è¡¨åº“ï¼ˆæŒ‰éœ€åˆ†ç¦»ï¼‰
        'echarts': ['echarts'],
        'vchart': ['@visactor/vchart'],
        'antv-g6': ['@antv/g6'],
        
        // è¡¨æ ¼ç»„ä»¶
        'vtable': ['@visactor/vtable', '@visactor/vue-vtable'],
        'vxe-table': ['vxe-table'],
        
        // ç¼–è¾‘å™¨ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰
        'editors': ['vditor', 'wangeditor'],
        
        // å…¶ä»–å¤§å‹åº“
        'gantt': ['dhtmlx-gantt'],
        'pdf': ['vue-pdf-embed'],
        'player': ['xgplayer'],
        
        // å·¥å…·åº“
        'utils': ['dayjs', 'lodash-es'],
      }
    }
  }
}
```

#### 2. æ™ºèƒ½ä»£ç åˆ†å‰²ï¼ˆæ›´ä¼˜æ–¹æ¡ˆï¼‰

ä½¿ç”¨å‡½æ•°å¼åˆ†å‰²ï¼Œæ›´çµæ´»ï¼š

```typescript
build: {
  rollupOptions: {
    output: {
      manualChunks(id) {
        // node_modules ä¸­çš„åŒ…
        if (id.includes('node_modules')) {
          // Vue ç”Ÿæ€
          if (id.includes('vue') || id.includes('pinia') || id.includes('vue-router')) {
            return 'vue-vendor';
          }
          
          // Element Plus
          if (id.includes('element-plus')) {
            return 'element-plus';
          }
          
          // å›¾è¡¨åº“
          if (id.includes('echarts')) {
            return 'echarts';
          }
          if (id.includes('@visactor/vchart')) {
            return 'vchart';
          }
          if (id.includes('@antv')) {
            return 'antv';
          }
          
          // è¡¨æ ¼ç»„ä»¶
          if (id.includes('@visactor/vtable') || id.includes('vxe-table')) {
            return 'tables';
          }
          
          // ç¼–è¾‘å™¨
          if (id.includes('vditor') || id.includes('wangeditor')) {
            return 'editors';
          }
          
          // å…¶ä»–å¤§å‹åº“
          if (id.includes('dhtmlx-gantt')) {
            return 'gantt';
          }
          if (id.includes('vue-pdf-embed')) {
            return 'pdf';
          }
          if (id.includes('xgplayer')) {
            return 'player';
          }
          
          // å…¶ä»–ç¬¬ä¸‰æ–¹åº“
          return 'vendor';
        }
        
        // æŒ‰è·¯ç”±åˆ†å‰²ï¼ˆå¦‚æœä½¿ç”¨è·¯ç”±æ‡’åŠ è½½ï¼‰
        if (id.includes('/src/views/')) {
          const match = id.match(/\/src\/views\/(.+?)\//);
          if (match) {
            const viewName = match[1];
            // å¤§å‹é¡µé¢å•ç‹¬æ‰“åŒ…
            if (['dashboard', 'data-visualization', 'editor'].includes(viewName)) {
              return `page-${viewName}`;
            }
            return 'pages';
          }
        }
      }
    }
  }
}
```

---

### æ–¹æ¡ˆäºŒï¼šæŒ‰éœ€å¯¼å…¥ä¼˜åŒ–

#### 1. Element Plus æŒ‰éœ€å¯¼å…¥

ç¡®ä¿ä½¿ç”¨è‡ªåŠ¨å¯¼å…¥æ’ä»¶ï¼ˆé¡¹ç›®å·²é…ç½® `unplugin-vue-components`ï¼‰ï¼š

```typescript
// åœ¨ vite.config.ts çš„æ’ä»¶é…ç½®ä¸­ç¡®ä¿æœ‰ï¼š
Components({
  resolvers: [ElementPlusResolver()],
  // è‡ªåŠ¨å¯¼å…¥æ ·å¼
  importStyle: 'sass'
})
```

#### 2. ECharts æŒ‰éœ€å¯¼å…¥

```typescript
// ä¸ä½¿ç”¨å®Œæ•´å¯¼å…¥
// âŒ import * as echarts from 'echarts';

// ä½¿ç”¨æŒ‰éœ€å¯¼å…¥
// âœ…
import * as echarts from 'echarts/core';
import { BarChart, LineChart, PieChart } from 'echarts/charts';
import { TitleComponent, TooltipComponent, LegendComponent } from 'echarts/components';
import { CanvasRenderer } from 'echarts/renderers';

echarts.use([
  BarChart,
  LineChart,
  PieChart,
  TitleComponent,
  TooltipComponent,
  LegendComponent,
  CanvasRenderer
]);
```

#### 3. è·¯ç”±æ‡’åŠ è½½

ç¡®ä¿æ‰€æœ‰è·¯ç”±éƒ½ä½¿ç”¨æ‡’åŠ è½½ï¼š

```typescript
// router/index.ts
{
  path: '/editor',
  component: () => import('@/views/editor/index.vue') // æ‡’åŠ è½½
}
```

---

### æ–¹æ¡ˆä¸‰ï¼šåŠ¨æ€å¯¼å…¥å¤§å‹åº“

å¯¹äºä¸å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä½¿ç”¨åŠ¨æ€å¯¼å…¥ï¼š

```typescript
// ç¤ºä¾‹ï¼šç”˜ç‰¹å›¾ç»„ä»¶
const loadGantt = () => import('dhtmlx-gantt');

// ä½¿ç”¨æ—¶
async function showGantt() {
  const gantt = await loadGantt();
  // ä½¿ç”¨ gantt
}

// ç¤ºä¾‹ï¼šç¼–è¾‘å™¨
const loadEditor = () => import('vditor');

// åœ¨ç»„ä»¶ä¸­
const Editor = defineAsyncComponent(() => import('vditor'));
```

---

## ğŸ“ å…·ä½“ä¼˜åŒ–é…ç½®

### å®Œæ•´çš„ vite.config.ts ä¼˜åŒ–é…ç½®

```typescript
build: {
  reportCompressedSize: false,
  sourcemap: viteEnv.VITE_SOURCE_MAP === 'Y',
  commonjsOptions: {
    ignoreTryCatch: false
  },
  // æ·»åŠ ä»£ç åˆ†å‰²é…ç½®
  rollupOptions: {
    output: {
      // æ–‡ä»¶å‘½åè§„åˆ™
      chunkFileNames: 'assets/js/[name]-[hash].js',
      entryFileNames: 'assets/js/[name]-[hash].js',
      assetFileNames: 'assets/[ext]/[name]-[hash].[ext]',
      
      // æ‰‹åŠ¨ä»£ç åˆ†å‰²
      manualChunks(id) {
        if (id.includes('node_modules')) {
          // Vue æ ¸å¿ƒ
          if (id.includes('vue') || id.includes('pinia') || id.includes('vue-router')) {
            return 'vue-vendor';
          }
          
          // Element Plus
          if (id.includes('element-plus')) {
            return 'element-plus';
          }
          
          // å›¾è¡¨åº“
          if (id.includes('echarts')) {
            return 'echarts';
          }
          if (id.includes('@visactor/vchart')) {
            return 'vchart';
          }
          if (id.includes('@antv')) {
            return 'antv';
          }
          
          // è¡¨æ ¼ç»„ä»¶
          if (id.includes('@visactor/vtable') || id.includes('vxe-table')) {
            return 'tables';
          }
          
          // ç¼–è¾‘å™¨
          if (id.includes('vditor') || id.includes('wangeditor')) {
            return 'editors';
          }
          
          // å…¶ä»–å¤§å‹åº“
          if (id.includes('dhtmlx-gantt')) {
            return 'gantt';
          }
          if (id.includes('vue-pdf-embed')) {
            return 'pdf';
          }
          if (id.includes('xgplayer')) {
            return 'player';
          }
          
          // å…¶ä»–ç¬¬ä¸‰æ–¹åº“
          return 'vendor';
        }
      }
    }
  },
  
  // Chunk å¤§å°è­¦å‘Šé˜ˆå€¼
  chunkSizeWarningLimit: 1000
}
```

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

### é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **é¦–å± JS** | ~2MB+ | < 500KB (gzip) | å‡å°‘ 75%+ |
| **æ€» JS** | ~5MB+ | < 2MB (gzip) | å‡å°‘ 60%+ |
| **æœ€å¤§ Chunk** | ~2MB | < 500KB | å‡å°‘ 75%+ |
| **Chunk æ•°é‡** | å°‘é‡å¤§åŒ… | å¤šä¸ªå°åŒ… | æ›´å¥½çš„ç¼“å­˜ |

### æ€§èƒ½æå‡

- âœ… **é¦–å±åŠ è½½é€Ÿåº¦**ï¼šå‡å°‘ 50-70%
- âœ… **ç¼“å­˜åˆ©ç”¨ç‡**ï¼šæå‡ 80%+
- âœ… **æŒ‰éœ€åŠ è½½**ï¼šéå…³é”®åŠŸèƒ½å»¶è¿ŸåŠ è½½
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šæ˜¾è‘—æå‡

---

## ğŸ“‹ å®æ–½æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä»£ç åˆ†å‰²é…ç½®

1. ä¿®æ”¹ `vite.config.ts`ï¼Œæ·»åŠ  `rollupOptions`
2. è¿è¡Œ `pnpm run build:analyze` æŸ¥çœ‹æ•ˆæœ

### ç¬¬äºŒæ­¥ï¼šä¼˜åŒ–å¯¼å…¥æ–¹å¼

1. æ£€æŸ¥ Element Plus æ˜¯å¦æŒ‰éœ€å¯¼å…¥
2. ä¼˜åŒ– ECharts å¯¼å…¥æ–¹å¼
3. ç¡®ä¿è·¯ç”±ä½¿ç”¨æ‡’åŠ è½½

### ç¬¬ä¸‰æ­¥ï¼šåŠ¨æ€å¯¼å…¥å¤§å‹åº“

1. è¯†åˆ«ä¸å¸¸ç”¨çš„åŠŸèƒ½ï¼ˆç¼–è¾‘å™¨ã€ç”˜ç‰¹å›¾ç­‰ï¼‰
2. æ”¹ä¸ºåŠ¨æ€å¯¼å…¥
3. æ·»åŠ åŠ è½½çŠ¶æ€æç¤º

### ç¬¬å››æ­¥ï¼šéªŒè¯ä¼˜åŒ–æ•ˆæœ

1. é‡æ–°è¿è¡Œ `pnpm run build:analyze`
2. å¯¹æ¯”ä¼˜åŒ–å‰åçš„æŠ¥å‘Š
3. æµ‹è¯•å®é™…åŠ è½½æ€§èƒ½

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦è¿‡åº¦åˆ†å‰²**ï¼šå¤ªå¤šå° chunk ä¼šå¢åŠ  HTTP è¯·æ±‚æ•°
2. **ä¿æŒåˆç†å¤§å°**ï¼šå•ä¸ª chunk å»ºè®® 100-500KB
3. **è€ƒè™‘ç¼“å­˜**ï¼šç¨³å®šçš„åº“å•ç‹¬æ‰“åŒ…ï¼Œä¾¿äºç¼“å­˜
4. **æµ‹è¯•å…¼å®¹æ€§**ï¼šç¡®ä¿åŠ¨æ€å¯¼å…¥ä¸å½±å“åŠŸèƒ½

---

## ğŸ”§ å¿«é€Ÿå¼€å§‹

ç›´æ¥åº”ç”¨ä¼˜åŒ–é…ç½®åˆ° `vite.config.ts` çš„ `build` éƒ¨åˆ†å³å¯å¼€å§‹ä¼˜åŒ–ã€‚


