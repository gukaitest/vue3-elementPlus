import{a9 as I,p as O,R as C,s as T,a2 as L,a5 as N,a6 as $}from"./vue-vendor-DLKW-W3j.js";import{b as A,i as j,c as Y,$ as E}from"./index-BBz38mVY.js";function R(o){const{loading:p,startLoading:P,endLoading:l}=A(),{bool:w,setBool:d}=j(),{apiFn:_,apiParams:u,transformer:b,immediate:m=!0,getColumnChecks:k,getColumns:v}=o,s=I(O({...u})),h=C(o.columns()),S=C([]),f=C(k(o.columns())),y=T(()=>v(h.value,f.value));function z(){h.value=o.columns();const r=new Map(f.value.map(e=>[e.prop,e.checked])),i=k(h.value);f.value=i.map(e=>({...e,checked:r.get(e.prop)??e.checked}))}async function g(){var a;P();const r=D(s),i=await _(r),e=b(i);S.value=e.data,d(e.data.length===0),await((a=o.onFetched)==null?void 0:a.call(o,e)),l()}function D(r){const i={};return Object.entries(r).forEach(([e,a])=>{a!=null&&(i[e]=a)}),i}function c(r){Object.assign(s,r)}function M(){Object.assign(s,O(u))}return m&&g(),{loading:p,empty:w,data:S,columns:y,columnChecks:f,reloadColumns:z,getData:g,searchParams:s,updateSearchParams:c,resetSearchParams:M}}function V(o){const p=L(),P=Y(),l=T(()=>P.isMobile),{apiFn:w,apiParams:d,immediate:_}=o,u="__selection__",b="__expand__",m="__index__",{loading:k,empty:v,data:s,columns:h,columnChecks:S,reloadColumns:f,getData:y,searchParams:z,updateSearchParams:g,resetSearchParams:D}=R({apiFn:w,apiParams:d,columns:o.columns,transformer:e=>{const{records:a=[],current:t=1,size:x=10,total:n=0}=e.data||{},F=x<=0?10:x;return{data:a.map((B,K)=>({...B,index:(t-1)*F+K+1})),pageNum:t,pageSize:F,total:n}},getColumnChecks:e=>{const a=[];return e.forEach(t=>{t.type==="selection"?a.push({prop:u,label:E("common.check"),checked:!0}):t.type==="expand"?a.push({prop:b,label:E("common.expandColumn"),checked:!0}):t.type==="index"?a.push({prop:m,label:E("common.index"),checked:!0}):a.push({prop:t.prop,label:t.label,checked:!0})}),a},getColumns:(e,a)=>{const t=new Map;return e.forEach(n=>{n.type==="selection"?t.set(u,n):n.type==="expand"?t.set(b,n):n.type==="index"?t.set(m,n):t.set(n.prop,n)}),a.filter(n=>n.checked).map(n=>t.get(n.prop))},onFetched:async e=>{const{pageNum:a,pageSize:t,total:x}=e;r({currentPage:a,pageSize:t,total:x})},immediate:_}),c=I({currentPage:1,pageSize:10,pageSizes:[10,15,20,25,30],"current-change":e=>(c.currentPage=e,g({current:e,size:c.pageSize}),y(),!0),"size-change":e=>(c.currentPage=1,c.pageSize=e,g({current:c.currentPage,size:e}),y(),!0)}),M=T(()=>({...c,pagerCount:l.value?3:9}));function r(e){Object.assign(c,e)}async function i(e=1){r({currentPage:e}),g({current:e,size:c.pageSize}),await y()}return p.run(()=>{N(()=>P.locale,()=>{f()})}),$(()=>{p.stop()}),{loading:k,empty:v,data:s,columns:h,columnChecks:S,reloadColumns:f,pagination:c,mobilePagination:M,updatePagination:r,getData:y,getDataByPage:i,searchParams:z,updateSearchParams:g,resetSearchParams:D}}function q(o,p){const{bool:P,setTrue:l,setFalse:w}=j(),d=C("add");function _(){d.value="add",l()}const u=C(null);function b(s){d.value="edit";const h=o.value.find(S=>S.id===s)||null;u.value=O(h),l()}const m=C([]);async function k(){var s;(s=window.$message)==null||s.success(E("common.deleteSuccess")),m.value=[],await p()}async function v(){var s;(s=window.$message)==null||s.success(E("common.deleteSuccess")),await p()}return{drawerVisible:P,openDrawer:l,closeDrawer:w,operateType:d,handleAdd:_,editingData:u,handleEdit:b,checkedRowKeys:m,onBatchDeleted:k,onDeleted:v}}export{q as a,V as u};
