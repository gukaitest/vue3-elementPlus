server {
    listen 80;
    server_name http://47.103.169.121;

    # Gzip 压缩配置
    gzip on;                                    # 启用 gzip 压缩
    gzip_vary on;                               # 启用 Vary: Accept-Encoding 响应头
    gzip_min_length 1024;                      # 最小压缩文件大小，小于此值不压缩（1KB）
    gzip_proxied any;                           # 对所有代理请求启用压缩
    gzip_comp_level 6;                         # 压缩级别 1-9，6 是平衡压缩率和 CPU 使用的最佳选择
    gzip_types                                 # 需要压缩的 MIME 类型
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/xml+rss
        application/atom+xml
        image/svg+xml
        application/x-font-ttf
        application/vnd.ms-fontobject
        font/opentype
        font/woff
        font/woff2;
    gzip_disable "msie6";                      # 禁用 IE6 的 gzip（IE6 不支持）

    # Brotli 压缩配置（已注释）
    # brotli on;                                    # 启用 brotli 压缩
    # brotli_comp_level 6;                          # 压缩级别 1-11，6 是平衡压缩率和 CPU 使用的最佳选择
    # brotli_types                                 # 需要压缩的 MIME 类型
    #     text/plain
    #     text/css
    #     text/xml
    #     text/javascript
    #     application/json
    #     application/javascript
    #     application/xml+rss
    #     application/atom+xml
    #     image/svg+xml
    #     application/x-font-ttf
    #     application/vnd.ms-fontobject
    #     font/opentype
    #     font/woff
    #     font/woff2;

    # 静态资源缓存配置
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        root /usr/share/nginx/html;
        expires 1y;                             # 缓存 1 年
        add_header Cache-Control "public, immutable";
        access_log off;                         # 关闭访问日志
    }

    # 预压缩文件支持（优先使用构建时生成的 .gz 文件）
    location ~* \.(js|css|json|html)$ {
        root /usr/share/nginx/html;
        gzip_static on;                         # 启用静态 gzip 文件支持
        # brotli_static on;                       # 启用静态 brotli 文件支持（已注释）
    }

    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;

        # HTML 文件不缓存
        location ~* \.html$ {
            add_header Cache-Control "no-cache, no-store, must-revalidate";
            add_header Pragma "no-cache";
            add_header Expires "0";
        }
    }
}
