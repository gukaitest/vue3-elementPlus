import{_ as re}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Gq_CIUH0.js";import{p as G,f as de}from"./business-Dnq1J6Fs.js";import{$ as t,t as H,j as se}from"./index-C1YnPq5G.js";import{a as ce,b as pe,c as ue,d as ie,f as me}from"./product-qbMYeVa3.js";import{u as _e,a as fe}from"./table-DZiYh2Mz.js";import{u as J,a as ge}from"./form-DfJhM0nL.js";import{r as N,av as A,aw as Z,s as Q,R as be,a5 as ve,K as P,v,P as a,J as e,i as X,be as Y,D as o,aW as ye,aA as ee,aU as oe,t as O,F as L,al as W,aV as te,bf as ae,E as F,an as $,ao as B,aZ as he,bt as we,bu as Ce,bv as Ee,bw as Ve,g as le,aE as j,y as I,A as Me,f as ke,bz as De,O as q,bA as xe,z as Se,bB as Pe,by as Re,bC as Ue}from"./vue-vendor-DLKW-W3j.js";import{_ as Te,a as ze}from"./round-refresh-B3482ack.js";const Be=N({name:"ProductOperateDrawer",__name:"user-operate-drawer",props:A({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:A(["submitted"],["update:visible"]),setup(w,{emit:z}){const p=w,k=z,f=Z(w,"visible"),{formRef:R,validate:i,restoreValidation:U}=J(),{defaultRequiredRule:V}=ge(),D=Q(()=>({add:t("page.personalContent.productManege.addProduct"),edit:t("page.personalContent.productManege.editProduct")})[p.operateType]),d=be(u());function u(){return{product_id:0,product_name:"",category:"",price:0,stock:0,description:""}}const C={product_name:V};function y(){d.value=u(),p.operateType==="edit"&&p.rowData&&Object.assign(d.value,{product_id:p.rowData.product_id,product_name:p.rowData.product_name,category:p.rowData.category,price:p.rowData.price,stock:p.rowData.stock,description:p.rowData.description||""})}function _(){f.value=!1}async function x(){var E,r,g;await i();try{p.operateType==="add"?(await ce(d.value),(E=window.$message)==null||E.success(t("common.addSuccess"))):p.operateType==="edit"&&p.rowData&&(await pe(p.rowData._id,d.value),(r=window.$message)==null||r.success(t("common.updateSuccess"))),_(),k("submitted")}catch{(g=window.$message)==null||g.error("操作失败，请重试")}}return ve(f,()=>{f.value&&(y(),U())}),(E,r)=>{const g=ye,b=Y,T=ee,n=te,l=oe,m=X,M=F,S=ae,s=he;return v(),P(s,{modelValue:f.value,"onUpdate:modelValue":r[6]||(r[6]=c=>f.value=c),title:D.value,size:360},{footer:a(()=>[e(S,{size:16},{default:a(()=>[e(M,{onClick:_},{default:a(()=>[$(B(o(t)("common.cancel")),1)]),_:1}),e(M,{type:"primary",onClick:x},{default:a(()=>[$(B(o(t)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(m,{ref_key:"formRef",ref:R,model:d.value,rules:C,"label-position":"top"},{default:a(()=>[e(b,{label:o(t)("page.personalContent.productManege.product_id"),prop:"product_id"},{default:a(()=>[e(g,{modelValue:d.value.product_id,"onUpdate:modelValue":r[0]||(r[0]=c=>d.value.product_id=c),placeholder:o(t)("page.personalContent.productManege.form.product_id"),class:"w-full",min:0,disabled:E.operateType==="edit"},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),e(b,{label:o(t)("page.personalContent.productManege.product_name"),prop:"product_name"},{default:a(()=>[e(T,{modelValue:d.value.product_name,"onUpdate:modelValue":r[1]||(r[1]=c=>d.value.product_name=c),placeholder:o(t)("page.personalContent.productManege.form.product_name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(b,{label:o(t)("page.personalContent.productManege.category"),prop:"category"},{default:a(()=>[e(l,{modelValue:d.value.category,"onUpdate:modelValue":r[2]||(r[2]=c=>d.value.category=c),clearable:"",placeholder:o(t)("page.personalContent.productManege.form.category"),class:"w-full"},{default:a(()=>[(v(!0),O(L,null,W(o(H)(o(G)),c=>(v(),P(n,{key:c.value,label:c.label,value:c.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(b,{label:o(t)("page.personalContent.productManege.price"),prop:"price"},{default:a(()=>[e(g,{modelValue:d.value.price,"onUpdate:modelValue":r[3]||(r[3]=c=>d.value.price=c),placeholder:o(t)("page.personalContent.productManege.form.price"),class:"w-full",min:0,precision:2},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(b,{label:o(t)("page.personalContent.productManege.stock"),prop:"stock"},{default:a(()=>[e(g,{modelValue:d.value.stock,"onUpdate:modelValue":r[4]||(r[4]=c=>d.value.stock=c),placeholder:o(t)("page.personalContent.productManege.form.stock"),class:"w-full",min:0},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(b,{label:"描述",prop:"description"},{default:a(()=>[e(T,{modelValue:d.value.description,"onUpdate:modelValue":r[5]||(r[5]=c=>d.value.description=c),type:"textarea",rows:3,placeholder:"请输入产品描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Ie=N({name:"ProductSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:A(["reset","search"],["update:model"]),setup(w,{emit:z}){const p=z,{formRef:k,validate:f,restoreValidation:R}=J(),i=Z(w,"model"),U=Q(()=>({}));async function V(){await R(),p("reset")}async function D(){await f(),p("search")}return(d,u)=>{const C=ee,y=Y,_=Ve,x=te,E=oe,r=Te,g=F,b=ze,T=ae,n=Ee,l=X,m=Ce,M=we,S=le;return v(),P(S,{class:"card-wrapper"},{default:a(()=>[e(M,null,{default:a(()=>[e(m,{title:o(t)("common.search"),name:"product-search"},{default:a(()=>[e(l,{ref_key:"formRef",ref:k,model:i.value,rules:U.value,"label-position":"right","label-width":80},{default:a(()=>[e(n,{gutter:24},{default:a(()=>[e(_,{lg:6,md:8,sm:12},{default:a(()=>[e(y,{label:o(t)("page.personalContent.productManege.product_id"),prop:"product_id"},{default:a(()=>[e(C,{modelValue:i.value.product_id,"onUpdate:modelValue":u[0]||(u[0]=s=>i.value.product_id=s),placeholder:o(t)("page.personalContent.productManege.form.product_id")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(_,{lg:6,md:8,sm:12},{default:a(()=>[e(y,{label:o(t)("page.personalContent.productManege.product_name"),prop:"product_name"},{default:a(()=>[e(C,{modelValue:i.value.product_name,"onUpdate:modelValue":u[1]||(u[1]=s=>i.value.product_name=s),placeholder:o(t)("page.personalContent.productManege.form.product_name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(_,{lg:6,md:8,sm:12},{default:a(()=>[e(y,{label:o(t)("page.personalContent.productManege.category"),prop:"category"},{default:a(()=>[e(E,{modelValue:i.value.category,"onUpdate:modelValue":u[2]||(u[2]=s=>i.value.category=s),clearable:"",placeholder:o(t)("page.personalContent.productManege.form.category")},{default:a(()=>[(v(!0),O(L,null,W(o(H)(o(G)),s=>(v(),P(x,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(_,{lg:6,md:8,sm:12},{default:a(()=>[e(y,{label:o(t)("page.personalContent.productManege.price"),prop:"price"},{default:a(()=>[e(C,{modelValue:i.value.price,"onUpdate:modelValue":u[3]||(u[3]=s=>i.value.price=s),placeholder:o(t)("page.personalContent.productManege.form.price")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(_,{lg:6,md:8,sm:12},{default:a(()=>[e(y,{label:o(t)("page.personalContent.productManege.stock"),prop:"stock"},{default:a(()=>[e(C,{modelValue:i.value.stock,"onUpdate:modelValue":u[4]||(u[4]=s=>i.value.stock=s),placeholder:o(t)("page.personalContent.productManege.form.stock")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(_,{lg:6,md:8,sm:12}),e(_,{lg:12,md:24,sm:24},{default:a(()=>[e(T,{class:"w-full justify-end",alignment:"end"},{default:a(()=>[e(g,{onClick:V},{icon:a(()=>[e(r,{class:"text-icon"})]),default:a(()=>[$(" "+B(o(t)("common.reset")),1)]),_:1}),e(g,{type:"primary",plain:"",onClick:D},{icon:a(()=>[e(b,{class:"text-icon"})]),default:a(()=>[$(" "+B(o(t)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Fe={class:"flex items-center justify-between"},$e={class:"h-[calc(100%-50px)]"},je={class:"mt-20px flex justify-end"};function K(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!Ue(w)}const Ae=N({name:"personal-content_product-manege",__name:"index",setup(w){function z(n){return me(n).then(l=>{const{products:m=[],total:M=0}=l.data||{},S=(n==null?void 0:n.current)||1,s=(n==null?void 0:n.size)||10;return{...l,data:{records:m,current:S,size:s,total:M}}})}const{columns:p,columnChecks:k,data:f,getData:R,getDataByPage:i,loading:U,mobilePagination:V,searchParams:D,resetSearchParams:d}=_e({apiFn:z,apiParams:{current:1,size:10,product_id:void 0,product_name:void 0,category:void 0,price:void 0,stock:void 0},columns:()=>[{type:"selection",width:48},{prop:"index",label:t("common.index"),width:64},{prop:"product_id",label:t("page.personalContent.productManege.product_id"),width:100},{prop:"product_name",label:t("page.personalContent.productManege.product_name"),minWidth:150},{prop:"category",label:t("page.personalContent.productManege.category"),width:120,formatter:n=>n.category?t(de[n.category]||"")||n.category:""},{prop:"price",label:t("page.personalContent.productManege.price"),width:100},{prop:"stock",label:t("page.personalContent.productManege.stock"),width:100},{prop:"description",label:"描述",minWidth:200,showOverflowTooltip:!0},{prop:"operate",label:t("common.operate"),minWidth:120,align:"center",formatter:n=>{let l;return e("div",{class:"flex-center"},[e(F,{type:"primary",plain:!0,size:"small",onClick:()=>T(n._id)},K(l=t("common.edit"))?l:{default:()=>[l]}),e(Re,{title:t("common.confirmDelete"),onConfirm:()=>b(n._id)},{reference:()=>{let m;return e(F,{type:"danger",plain:!0,size:"small"},K(m=t("common.delete"))?m:{default:()=>[m]})}})])}}]}),{drawerVisible:u,operateType:C,editingData:y,handleAdd:_,checkedRowKeys:x,onBatchDeleted:E,onDeleted:r}=fe(f,R);async function g(){var n;try{const{error:l}=await ue(x.value);l||E()}catch{(n=window.$message)==null||n.error("批量删除失败，请重试")}}async function b(n){var l;try{const{error:m}=await ie(n);m||r()}catch{(l=window.$message)==null||l.error("删除失败，请重试")}}function T(n){const l=f.value.find(m=>m._id===n);l&&(C.value="edit",y.value=l,u.value=!0)}return(n,l)=>{const m=re,M=De,S=ke,s=Pe,c=le,ne=xe;return v(),O("div",Oe,[e(Ie,{model:o(D),"onUpdate:model":l[0]||(l[0]=h=>j(D)?D.value=h:null),onReset:o(d),onSearch:o(i)},null,8,["model","onReset","onSearch"]),e(c,{class:"sm:flex-1-hidden card-wrapper","body-class":"ht50"},{header:a(()=>[I("div",Fe,[I("p",null,B(o(t)("page.personalContent.productManege.title")),1),e(m,{columns:o(k),"onUpdate:columns":l[1]||(l[1]=h=>j(k)?k.value=h:null),"disabled-delete":o(x).length===0,loading:o(U),onAdd:o(_),onDelete:g,onRefresh:o(R)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])])]),default:a(()=>[I("div",$e,[Me((v(),P(S,{height:"100%",border:"",class:"sm:h-full",data:o(f),"row-key":"_id",onSelectionChange:l[2]||(l[2]=h=>x.value=h)},{default:a(()=>[(v(!0),O(L,null,W(o(p),h=>(v(),P(M,q({key:h.prop,ref_for:!0},h),null,16))),128))]),_:1},8,["data"])),[[ne,o(U)]])]),I("div",je,[o(V).total?(v(),P(s,q({key:0,layout:"total,prev,pager,next,sizes"},o(V),{onCurrentChange:o(V)["current-change"],onSizeChange:o(V)["size-change"]}),null,16,["onCurrentChange","onSizeChange"])):Se("",!0)]),e(Be,{visible:o(u),"onUpdate:visible":l[3]||(l[3]=h=>j(u)?u.value=h:null),"operate-type":o(C),"row-data":o(y),onSubmitted:o(i)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}}),Ze=se(Ae,[["__scopeId","data-v-81dd00e0"]]);export{Ze as default};
