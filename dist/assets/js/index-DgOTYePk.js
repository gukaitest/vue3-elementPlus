import{_ as be}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Gq_CIUH0.js";import{R as A,s as W,p as he,r as ee,av as Q,aw as oe,bm as ve,bq as Ee,a5 as ye,K as G,v as b,P as t,J as a,i as se,D as e,be as re,aA as ue,br as Ve,t as F,F as M,al as I,bs as we,aU as de,aV as me,bf as ie,E as q,an as Y,ao as j,aZ as ke,bt as Ce,bu as Ne,bv as De,bw as Re,g as pe,bx as Ue,bj as le,by as xe,y as K,A as Se,f as Pe,bz as Ge,O as Te,bA as Oe,z as Be,bB as Fe,aE as te,bC as Me}from"./vue-vendor-DLKW-W3j.js";import{u as ce,e as fe,a as Ie,b as ze}from"./business-Dnq1J6Fs.js";import{a as z}from"./auth-B6pJzlnZ.js";import{$ as l,i as Z,t as ne,j as Ae}from"./index-C1YnPq5G.js";import{u as ge,a as _e}from"./form-DfJhM0nL.js";import{_ as je,a as $e}from"./round-refresh-B3482ack.js";function Ke(){return z.Get("/systemManage/getAllRoles")}function Le(i){return z.Get("/systemManage/getUserList",{params:i})}function We(i){return z.Post("/systemManage/addUser",i)}function qe(i){return z.Post("/systemManage/updateUser",i)}function Ye(i){return z.Delete("/systemManage/deleteUser",{id:i})}function Xe(i){return z.Delete("/systemManage/batchDeleteUser",{ids:i})}function He(i){const _="__selection__",h="__expand__",C="__index__",P=A((N=>{const f=[];return N.forEach(v=>{v.type==="selection"?f.push({prop:_,label:l("common.check"),checked:!0}):v.type==="expand"?f.push({prop:h,label:l("common.expandColumn"),checked:!0}):v.type==="index"?f.push({prop:C,label:l("common.index"),checked:!0}):f.push({prop:v.prop,label:v.label,checked:!0})}),f})(i())),s=W(()=>{const N=i(),f=new Map;return N.forEach(p=>{p.type==="selection"?f.set(_,p):p.type==="expand"?f.set(h,p):p.type==="index"?f.set(C,p):f.set(p.prop,p)}),P.value.filter(p=>p.checked).map(p=>f.get(p.prop))});return{columnChecks:P,columns:s}}function Je(i,_){const{bool:h,setTrue:C,setFalse:V}=Z(),{bool:P,setTrue:s,setFalse:N}=Z(),{bool:f,setTrue:v,setFalse:p}=Z(),R=A("add"),c=y=>i.value.find(w=>w.id===y)||null;function r(){R.value="add",C()}const E=A(null);function D(y){R.value="edit",E.value=he(c(y)),C()}const x=A([]);async function O(){var y,w;v();try{const S=x.value.map(g=>c(g)).filter(Boolean);await((y=_.batchDelete)==null?void 0:y.call(_,S)),(w=window.$message)==null||w.success(l("common.deleteSuccess")),x.value=[]}finally{p()}}async function B(y){var S,g;s();const w=c(y);if(w)try{await((S=_.delete)==null?void 0:S.call(_,w)),(g=window.$message)==null||g.success(l("common.deleteSuccess")),x.value=[]}finally{N()}}return{drawerVisible:h,openDrawer:C,closeDrawer:V,operateType:R,handleAdd:r,editingData:E,handleEdit:D,checkedRowKeys:x,deleting:P,handleDelete:B,batchDeleting:f,handleBatchDelete:O}}const Ze=ee({name:"UserOperateDrawer",__name:"user-operate-drawer",props:Q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Q(["submitted"],["update:visible"]),setup(i,{emit:_}){const h=i,C=_,V=oe(i,"visible"),{formRef:P,validate:s,restoreValidation:N}=ge(),{defaultRequiredRule:f}=_e(),v=W(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[h.operateType]),{loading:p,reset:R,send:c,form:r,updateForm:E}=ve(g=>h.operateType==="add"?We(g):qe(g),{initialForm:{userName:"",userGender:void 0,nickName:"",userPhone:"",userEmail:"",userRoles:[],status:void 0},resetAfterSubmiting:!0}),D={userName:f,status:f},{data:x,loading:O}=Ee(Ke,[V],{initialData:[],middleware(g,u){return V.value?u():void 0}}),B=W(()=>{const g=x.value.map(k=>({label:k.roleName,value:k.roleCode}));return[...r.value.userRoles.map(k=>({label:k,value:k})),...g]});function y(){h.operateType==="edit"&&h.rowData?E(h.rowData):h.operateType==="add"&&R()}function w(){V.value=!1}async function S(){var g;await s(),await c(),(g=window.$message)==null||g.success(l("common.updateSuccess")),w(),C("submitted")}return ye(V,()=>{V.value&&(N(),y())}),(g,u)=>{const k=ue,n=re,d=we,o=Ve,T=me,X=de,H=se,$=q,J=ie,U=ke;return b(),G(U,{modelValue:V.value,"onUpdate:modelValue":u[7]||(u[7]=m=>V.value=m),title:v.value,"display-directive":"show",size:360},{footer:t(()=>[a(J,{size:16},{default:t(()=>[a($,{onClick:w},{default:t(()=>[Y(j(e(l)("common.cancel")),1)]),_:1}),a($,{type:"primary",loading:e(p),onClick:S},{default:t(()=>[Y(j(e(l)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(H,{ref_key:"formRef",ref:P,model:e(r),rules:D,"label-position":"top"},{default:t(()=>[a(n,{label:e(l)("page.manage.user.userName"),prop:"userName"},{default:t(()=>[a(k,{modelValue:e(r).userName,"onUpdate:modelValue":u[0]||(u[0]=m=>e(r).userName=m),placeholder:e(l)("page.manage.user.form.userName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.userGender"),prop:"userGender"},{default:t(()=>[a(o,{modelValue:e(r).userGender,"onUpdate:modelValue":u[1]||(u[1]=m=>e(r).userGender=m)},{default:t(()=>[(b(!0),F(M,null,I(e(ce),m=>(b(),G(d,{key:m.value,value:m.value,label:e(l)(m.label)},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.nickName"),prop:"nickName"},{default:t(()=>[a(k,{modelValue:e(r).nickName,"onUpdate:modelValue":u[2]||(u[2]=m=>e(r).nickName=m),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.userPhone"),prop:"userPhone"},{default:t(()=>[a(k,{modelValue:e(r).userPhone,"onUpdate:modelValue":u[3]||(u[3]=m=>e(r).userPhone=m),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.userEmail"),prop:"email"},{default:t(()=>[a(k,{modelValue:e(r).userEmail,"onUpdate:modelValue":u[4]||(u[4]=m=>e(r).userEmail=m),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.userStatus"),prop:"status"},{default:t(()=>[a(o,{modelValue:e(r).status,"onUpdate:modelValue":u[5]||(u[5]=m=>e(r).status=m)},{default:t(()=>[(b(!0),F(M,null,I(e(fe),m=>(b(),G(d,{key:m.value,value:m.value,label:e(l)(m.label)},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(n,{label:e(l)("page.manage.user.userRole"),prop:"roles"},{default:t(()=>[a(X,{modelValue:e(r).userRoles,"onUpdate:modelValue":u[6]||(u[6]=m=>e(r).userRoles=m),multiple:"",loading:e(O),placeholder:e(l)("page.manage.user.form.userRole")},{default:t(()=>[(b(!0),F(M,null,I(B.value,({label:m,value:ae})=>(b(),G(T,{key:ae,label:m,value:ae},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Qe=ee({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["search"],["update:model"]),setup(i,{emit:_}){const h=_,{formRef:C,validate:V,restoreValidation:P}=ge(),s=oe(i,"model"),N={...s.value},f=W(()=>{const{patternRules:R}=_e();return{userEmail:R.email,userPhone:R.phone}});async function v(){await P(),Object.assign(s.value,N)}async function p(){await V(),h("search")}return(R,c)=>{const r=ue,E=re,D=Re,x=me,O=de,B=je,y=q,w=$e,S=ie,g=De,u=se,k=Ne,n=Ce,d=pe;return b(),G(d,{class:"card-wrapper"},{default:t(()=>[a(n,null,{default:t(()=>[a(k,{title:e(l)("common.search"),name:"user-search"},{default:t(()=>[a(u,{ref_key:"formRef",ref:C,model:s.value,rules:f.value,"label-position":"right","label-width":80},{default:t(()=>[a(g,{gutter:24},{default:t(()=>[a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.userName"),prop:"userName"},{default:t(()=>[a(r,{modelValue:s.value.userName,"onUpdate:modelValue":c[0]||(c[0]=o=>s.value.userName=o),placeholder:e(l)("page.manage.user.form.userName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.userGender"),prop:"userGender"},{default:t(()=>[a(O,{modelValue:s.value.userGender,"onUpdate:modelValue":c[1]||(c[1]=o=>s.value.userGender=o),placeholder:e(l)("page.manage.user.form.userGender"),clearable:""},{default:t(()=>[(b(!0),F(M,null,I(e(ne)(e(ce)),({label:o,value:T})=>(b(),G(x,{key:T,label:o,value:T},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.nickName"),prop:"nickName"},{default:t(()=>[a(r,{modelValue:s.value.nickName,"onUpdate:modelValue":c[2]||(c[2]=o=>s.value.nickName=o),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.userPhone"),prop:"userPhone"},{default:t(()=>[a(r,{modelValue:s.value.userPhone,"onUpdate:modelValue":c[3]||(c[3]=o=>s.value.userPhone=o),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.userEmail"),prop:"userEmail"},{default:t(()=>[a(r,{modelValue:s.value.userEmail,"onUpdate:modelValue":c[4]||(c[4]=o=>s.value.userEmail=o),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:6,md:8,sm:12},{default:t(()=>[a(E,{label:e(l)("page.manage.user.userGender"),prop:"userStatus"},{default:t(()=>[a(O,{modelValue:s.value.status,"onUpdate:modelValue":c[5]||(c[5]=o=>s.value.status=o),placeholder:e(l)("page.manage.user.form.userStatus"),clearable:""},{default:t(()=>[(b(!0),F(M,null,I(e(ne)(e(fe)),({label:o,value:T})=>(b(),G(x,{key:T,label:o,value:T},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{lg:12,md:24,sm:24},{default:t(()=>[a(S,{class:"w-full justify-end",alignment:"end"},{default:t(()=>[a(y,{onClick:v},{icon:t(()=>[a(B,{class:"text-icon"})]),default:t(()=>[Y(" "+j(e(l)("common.reset")),1)]),_:1}),a(y,{type:"primary",plain:"",onClick:p},{icon:t(()=>[a(w,{class:"text-icon"})]),default:t(()=>[Y(" "+j(e(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),ea={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},aa={class:"flex items-center justify-between"},la={class:"h-[calc(100%-50px)]"},ta={class:"mt-20px flex justify-end"};function L(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!Me(i)}const na=ee({name:"alova_user",__name:"index",setup(i){const _=A({status:void 0,userName:void 0,userGender:void 0,nickName:void 0,userPhone:void 0,userEmail:void 0}),{loading:h,data:C,refresh:V,reload:P,page:s,pageSize:N,pageCount:f,send:v,remove:p,total:R}=Ue((n,d)=>Le({..._.value,current:n,size:d}),{data:({records:n})=>n,watchingStates:[_.value],debounce:[1e3]}),c=(n=1)=>{s.value=n,v(s.value,N.value)},r=n=>{N.value=n,v(s.value,n)},{drawerVisible:E,operateType:D,editingData:x,handleAdd:O,handleEdit:B,handleDelete:y,handleBatchDelete:w,checkedRowKeys:S}=Je(C,{async delete(n){await Ye(n.id),p(n)},async batchDelete(n){await Xe(n.map(({id:d})=>d)),p(...n)}});function g(n){B(n)}const{columnChecks:u,columns:k}=He(()=>[{type:"selection",width:48},{prop:"userName",label:l("page.manage.user.userName"),minWidth:100},{prop:"userGender",label:l("page.manage.user.userGender"),width:100,formatter:n=>{if(n.userGender===void 0)return"";const d={1:"primary",2:"danger"},o=l(Ie[n.userGender]);return a(le,{type:d[n.userGender]},L(o)?o:{default:()=>[o]})}},{prop:"nickName",label:l("page.manage.user.nickName"),minWidth:100},{prop:"userPhone",label:l("page.manage.user.userPhone"),width:120},{prop:"userEmail",label:l("page.manage.user.userEmail"),minWidth:200},{prop:"status",label:l("page.manage.user.userStatus"),width:100,formatter:n=>{if(n.status===void 0)return"";const d={1:"success",2:"warning"},o=l(ze[n.status]);return a(le,{type:d[n.status]},L(o)?o:{default:()=>[o]})}},{prop:"operate",label:l("common.operate"),width:130,formatter:n=>{let d;return a("div",{class:"flex-center gap-8px"},[a(q,{type:"primary",plain:!0,size:"small",onClick:()=>g(n.id)},L(d=l("common.edit"))?d:{default:()=>[d]}),a(xe,{title:l("common.confirmDelete"),onConfirm:()=>y(n.id)},{reference:()=>{let o;return a(q,{type:"danger",plain:!0,size:"small"},L(o=l("common.delete"))?o:{default:()=>[o]})}})])}}]);return(n,d)=>{const o=be,T=Ge,X=Pe,H=Fe,$=pe,J=Oe;return b(),F("div",ea,[a(Qe,{model:_.value,"onUpdate:model":d[0]||(d[0]=U=>_.value=U),onSearch:c},null,8,["model"]),a($,{class:"sm:flex-1-hidden card-wrapper","body-class":"ht50"},{header:t(()=>[K("div",aa,[K("p",null,j(e(l)("page.manage.user.title")),1),a(o,{columns:e(u),"onUpdate:columns":d[1]||(d[1]=U=>te(u)?u.value=U:null),"disabled-delete":e(S).length===0,loading:e(h),onAdd:e(O),onDelete:e(w),onRefresh:e(V)},null,8,["columns","disabled-delete","loading","onAdd","onDelete","onRefresh"])])]),default:t(()=>[K("div",la,[Se((b(),G(X,{height:"100%",border:"",class:"sm:h-full",data:e(C),"row-key":"id",onSelectionChange:d[2]||(d[2]=U=>S.value=U)},{default:t(()=>[(b(!0),F(M,null,I(e(k),U=>(b(),G(T,Te({key:U.prop,ref_for:!0},U),null,16))),128))]),_:1},8,["data"])),[[J,e(h)]]),K("div",ta,[e(R)?(b(),G(H,{key:0,layout:"total,prev,pager,next,sizes","current-page":e(s),total:e(R),"page-size":e(N),"page-sizes":[10,15,20,25,30],"page-count":e(f),onCurrentChange:c,onSizeChange:r},null,8,["current-page","total","page-size","page-count"])):Be("",!0)])]),a(Ze,{visible:e(E),"onUpdate:visible":d[3]||(d[3]=U=>te(E)?E.value=U:null),"operate-type":e(D),"row-data":e(x),onSubmitted:e(P)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}}),pa=Ae(na,[["__scopeId","data-v-1d21a4df"]]);export{pa as default};
