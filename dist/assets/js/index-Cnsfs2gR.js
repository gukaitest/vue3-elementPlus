import{r as T,R as c,aH as N,bP as H,t as g,v as o,z as f,F as $,al as z,y as O,C as K,ae as w,D as x,K as y,P as k,J as E,aP as X,aO as Z}from"./vue-vendor-DLKW-W3j.js";import{j as B}from"./index-BBz38mVY.js";const P="/assets/jpg/001-Bg3uSwIK.jpg",U="/assets/jpg/002-CQfIn_Jg.jpg",V="/assets/jpg/003-BQJ3SB9i.jpg",M="/assets/jpg/004-D_CqIUBy.jpg",F="/assets/jpg/005-B44vLpON.jpg",R="/assets/jpg/006-XFl_NOhH.jpg",A="/assets/jpg/007-2OPtZVUF.jpg",J="/assets/jpg/008-z0s8QBQE.jpg",Q="/assets/png/008-B-VbXvwN.png",q="/assets/jpg/009-6TAqM2n1.jpg",D="/assets/jpg/soybean-JC38yUrs.jpg",W={class:"scroll-container"},Y=["src","onLoad"],ee={key:0,class:"loading-indicator"},se={key:0,class:"loading-more"},te={key:1,class:"no-more"},ae=T({__name:"image-load-new",setup(C){let s=null;const i={totalImages:9,pageSize:3,pathTemplate:t=>{const e="webp";return new URL(Object.assign({"../../assets/imgs/001.jpg":P,"../../assets/imgs/002.jpg":U,"../../assets/imgs/003.jpg":V,"../../assets/imgs/004.jpg":M,"../../assets/imgs/005.jpg":F,"../../assets/imgs/006.jpg":R,"../../assets/imgs/007.jpg":A,"../../assets/imgs/008.jpg":J,"../../assets/imgs/008.png":Q,"../../assets/imgs/009.jpg":q,"../../assets/imgs/soybean.jpg":D})[`../../assets/imgs/${t}.${e}`],import.meta.url).href},observerOptions:{root:null,rootMargin:"0px 0px 200px 0px",threshold:.1}},p=c([]),_=c(1),r=c(!1),u=c(!0),l=c([]),d=c([]),b=t=>{if(!t)return;const e=t.$el??t;e instanceof HTMLElement&&(d.value.includes(e)||d.value.push(e))},v=Array.from({length:i.totalImages},(t,e)=>{const h=(e+1).toString().padStart(3,"0");return i.pathTemplate(h)}),a=t=>{console.log("Intersection Observer triggered,entries:",t),t.forEach(e=>{e.isIntersecting&&!r.value&&(j(),s==null||s.unobserve(e.target))})},n=()=>{s==null||s.disconnect(),w(()=>{s=new IntersectionObserver(a,i.observerOptions);const t=d.value.filter(h=>h.isConnected&&h.offsetParent!==null),e=t[t.length-1];e?(console.log("添加观察元素Observing element:",e),s.observe(e)):console.warn("No valid elements to observe")})},m=t=>{l.value[t]=!0},j=async()=>{if(r.value||!u.value)return;r.value=!0;const t=(_.value-1)*i.pageSize,e=t+i.pageSize;p.value=[...p.value,...v.slice(t,e)],l.value=[...l.value,...Array.from({length:Math.min(i.pageSize,v.length-t)})],u.value=e<v.length,_.value+=1,r.value=!1,w(()=>n())};return N(async()=>{await j()}),H(()=>{s==null||s.disconnect(),s=null}),(t,e)=>(o(),g("div",W,[(o(!0),g($,null,z(p.value,(h,I)=>(o(),g("div",{key:I,ref_for:!0,ref:S=>b(S),class:"image-item"},[O("img",{src:h,alt:"Gallery Image",class:K({loaded:l.value[I]}),onLoad:S=>m(I)},null,42,Y),l.value[I]?f("",!0):(o(),g("div",ee,e[0]||(e[0]=[O("div",{class:"loader"},null,-1)])))]))),128)),r.value?(o(),g("div",se,"加载中...")):f("",!0),u.value?f("",!0):(o(),g("div",te,"已加载全部内容"))]))}}),ne=B(ae,[["__scopeId","data-v-760fcd96"]]),oe=["src"],le={key:0,class:"loading"},re={key:1,class:"no-more"},ce=9,L=3,ie=T({name:"ImageLoadOld",__name:"image-load-old",setup(C){const s="webp",i=Array.from({length:ce},(a,n)=>{const m=(n+1).toString().padStart(3,"0");return new URL(Object.assign({"../../assets/imgs/001.jpg":P,"../../assets/imgs/002.jpg":U,"../../assets/imgs/003.jpg":V,"../../assets/imgs/004.jpg":M,"../../assets/imgs/005.jpg":F,"../../assets/imgs/006.jpg":R,"../../assets/imgs/007.jpg":A,"../../assets/imgs/008.jpg":J,"../../assets/imgs/008.png":Q,"../../assets/imgs/009.jpg":q,"../../assets/imgs/soybean.jpg":D})[`../../assets/imgs/${m}.${s}`],import.meta.url).href}),p=c([]),_=c(1),r=c(!1),u=c(!0),l=c(null),d=async()=>{if(r.value||!u.value)return;r.value=!0;const a=(_.value-1)*L,n=a+L;p.value.push(...i.slice(a,n)),u.value=n<i.length,_.value+=1,r.value=!1},b=(a,n=100)=>(console.log("isNearBottom:el.scrollTop, el.clientHeight, el.scrollHeight, threshold",a.scrollTop+a.clientHeight>=a.scrollHeight-n,a.scrollTop,a.clientHeight,a.scrollHeight,n),a.scrollTop+a.clientHeight>=a.scrollHeight-n),v=((a,n)=>{let m;return(...j)=>{clearTimeout(m),m=setTimeout(()=>a(...j),n)}})(()=>{l.value&&b(l.value)&&d()},300);return N(async()=>{await d()}),H(()=>{l.value&&l.value.removeEventListener("scroll",v)}),(a,n)=>(o(),g("div",{ref_key:"scrollContainer",ref:l,class:"scroll-container",onScroll:n[0]||(n[0]=(...m)=>x(v)&&x(v)(...m))},[(o(!0),g($,null,z(p.value,(m,j)=>(o(),g("div",{key:j,class:"image-item"},[O("img",{src:m,alt:"图片"},null,8,oe)]))),128)),r.value?(o(),g("div",le,"加载中...")):f("",!0),u.value?f("",!0):(o(),g("div",re,"没有更多了~"))],544))}}),ge=B(ie,[["__scopeId","data-v-63cd1a47"]]),_e=T({name:"personal-content_image-loading-optimization",__name:"index",setup(C){const s=c("first"),i=(p,_)=>{console.log(p,_)};return(p,_)=>{const r=ge,u=X,l=ne,d=Z;return o(),y(d,{modelValue:s.value,"onUpdate:modelValue":_[0]||(_[0]=b=>s.value=b),class:"demo-tabs",onTabClick:i},{default:k(()=>[E(u,{label:"传统实现方式",name:"first"},{default:k(()=>[s.value==="first"?(o(),y(r,{key:0})):f("",!0)]),_:1}),E(u,{label:"IntersectionObserver实现方式",name:"second"},{default:k(()=>[s.value==="second"?(o(),y(l,{key:0})):f("",!0)]),_:1})]),_:1},8,["modelValue"])}}}),pe=B(_e,[["__scopeId","data-v-ca423d0c"]]);export{pe as default};
